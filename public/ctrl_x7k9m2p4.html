<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… - Red Strong</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;900&family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary: #0f0f1a;
            --secondary: #1a1a2e;
            --tertiary: #252542;
            --accent: #e94560;
            --accent-light: #ff6b8a;
            --gold: #ffd700;
            --success: #00d9a5;
            --warning: #ffc107;
            --danger: #dc3545;
            --info: #17a2b8;
            --text: #eaeaea;
            --text-muted: #8892b0;
            --sidebar-width: 260px;
            --header-height: 60px;
        }
        
        /* Light Theme */
        [data-theme="light"] {
            --primary: #f5f7fa;
            --secondary: #ffffff;
            --tertiary: #e8ecf1;
            --text: #1a1a2e;
            --text-muted: #6b7280;
        }
        [data-theme="light"] .sidebar { border-left-color: rgba(0,0,0,0.1); box-shadow: -2px 0 10px rgba(0,0,0,0.05); }
        [data-theme="light"] .card { box-shadow: 0 2px 10px rgba(0,0,0,0.08); }
        [data-theme="light"] .header { border-bottom-color: rgba(0,0,0,0.1); box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        [data-theme="light"] th { background: rgba(0,0,0,0.05); }
        [data-theme="light"] th, [data-theme="light"] td { border-bottom-color: rgba(0,0,0,0.1); }
        [data-theme="light"] .form-control { border-color: rgba(0,0,0,0.15); }
        [data-theme="light"] .btn-secondary { background: #e8ecf1; border-color: rgba(0,0,0,0.1); }
        [data-theme="light"] .menu-item:hover { background: rgba(0,0,0,0.05); }
        [data-theme="light"] .menu-item.active { background: rgba(233,69,96,0.1); }
        [data-theme="light"] .stat-card { box-shadow: 0 2px 10px rgba(0,0,0,0.08); }
        [data-theme="light"] .modal { box-shadow: 0 25px 50px rgba(0,0,0,0.2); }
        [data-theme="light"] .login-card { box-shadow: 0 25px 50px rgba(0,0,0,0.15); }
        [data-theme="light"] .toast { box-shadow: 0 5px 20px rgba(0,0,0,0.15); }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Cairo', sans-serif; background: var(--primary); min-height: 100vh; color: var(--text); transition: background 0.3s, color 0.3s; }
        
        /* Login Page */
        .login-page { min-height: 100vh; display: flex; align-items: center; justify-content: center; background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%); padding: 20px; }
        .login-card { max-width: 420px; width: 100%; background: var(--secondary); border: 1px solid rgba(255,255,255,0.1); border-radius: 24px; padding: 40px; box-shadow: 0 25px 50px rgba(0,0,0,0.5); }
        .login-logo { text-align: center; margin-bottom: 30px; }
        .login-logo img { height: 80px; margin-bottom: 15px; }
        .login-logo h1 { font-size: 1.5rem; background: linear-gradient(135deg, var(--gold), var(--accent)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .login-card .form-group { margin-bottom: 20px; }
        .login-card label { display: block; margin-bottom: 8px; font-weight: 600; color: var(--text-muted); }
        .login-card input { width: 100%; padding: 14px 16px; border: 2px solid rgba(255,255,255,0.1); border-radius: 12px; background: var(--primary); color: var(--text); font-family: inherit; font-size: 1rem; transition: all 0.3s; }
        .login-card input:focus { outline: none; border-color: var(--accent); box-shadow: 0 0 0 4px rgba(233,69,96,0.1); }
        .login-btn { width: 100%; padding: 14px; background: linear-gradient(135deg, var(--accent), var(--accent-light)); border: none; border-radius: 12px; color: white; font-family: inherit; font-size: 1.1rem; font-weight: 700; cursor: pointer; transition: all 0.3s; }
        .login-btn:hover { transform: translateY(-2px); box-shadow: 0 10px 30px rgba(233,69,96,0.3); }
        
        /* Admin Layout */
        .admin-layout { display: none; min-height: 100vh; }
        .admin-layout.active { display: flex; }
        
        /* Sidebar */
        .sidebar { width: var(--sidebar-width); background: var(--secondary); border-left: 1px solid rgba(255,255,255,0.1); position: fixed; top: 0; right: 0; height: 100vh; overflow-y: auto; z-index: 100; transition: transform 0.3s; }
        .sidebar-header { padding: 20px; border-bottom: 1px solid rgba(255,255,255,0.1); display: flex; align-items: center; gap: 12px; }
        .sidebar-header img { height: 40px; }
        .sidebar-header h2 { font-size: 1rem; color: var(--gold); }
        
        .sidebar-menu { padding: 15px 0; }
        .menu-section { margin-bottom: 10px; }
        .menu-section-title { padding: 10px 20px; font-size: 0.7rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 1px; }
        .menu-item { display: flex; align-items: center; gap: 12px; padding: 12px 20px; color: var(--text-muted); cursor: pointer; transition: all 0.2s; border-right: 3px solid transparent; }
        .menu-item:hover { background: rgba(255,255,255,0.05); color: var(--text); }
        .menu-item.active { background: rgba(233,69,96,0.1); color: var(--accent); border-right-color: var(--accent); }
        .menu-item .icon { font-size: 1.1rem; width: 24px; text-align: center; }
        .menu-item .label { font-size: 0.9rem; font-weight: 500; }
        .menu-item .badge { margin-right: auto; background: var(--accent); color: white; font-size: 0.7rem; padding: 2px 8px; border-radius: 10px; }
        
        .submenu { display: none; background: rgba(0,0,0,0.2); }
        .submenu.open { display: block; }
        .submenu .menu-item { padding-right: 50px; font-size: 0.85rem; }
        .submenu .menu-item .icon { font-size: 0.9rem; }
        
        .menu-item.has-submenu::after { content: 'â—€'; margin-right: auto; font-size: 0.7rem; transition: transform 0.2s; }
        .menu-item.has-submenu.open::after { transform: rotate(-90deg); }
        
        /* Main Content */
        .main-content { flex: 1; margin-right: var(--sidebar-width); min-height: 100vh; display: flex; flex-direction: column; }
        
        /* Header */
        .main-header { height: var(--header-height); background: var(--secondary); border-bottom: 1px solid rgba(255,255,255,0.1); padding: 0 25px; display: flex; align-items: center; justify-content: space-between; position: sticky; top: 0; z-index: 50; }
        .header-title { font-size: 1.2rem; font-weight: 700; }
        .header-actions { display: flex; align-items: center; gap: 15px; }
        
        .notification-btn { position: relative; width: 40px; height: 40px; border-radius: 10px; background: var(--tertiary); border: none; color: var(--text); cursor: pointer; font-size: 1.1rem; }
        .notification-btn .count { position: absolute; top: -5px; left: -5px; width: 20px; height: 20px; background: var(--accent); border-radius: 50%; font-size: 0.7rem; display: flex; align-items: center; justify-content: center; }
        
        .user-menu { display: flex; align-items: center; gap: 10px; padding: 8px 15px; background: var(--tertiary); border-radius: 12px; cursor: pointer; }
        .user-menu .avatar { width: 32px; height: 32px; background: linear-gradient(135deg, var(--accent), var(--gold)); border-radius: 8px; display: flex; align-items: center; justify-content: center; font-weight: 700; }
        .user-menu .info { text-align: right; }
        .user-menu .name { font-size: 0.85rem; font-weight: 600; }
        .user-menu .role { font-size: 0.7rem; color: var(--text-muted); }
        
        .lang-switch { display: flex; gap: 5px; }
        .theme-btn { width: 40px; height: 40px; border: 1px solid rgba(255,255,255,0.1); background: var(--tertiary); border-radius: 10px; cursor: pointer; font-size: 1.2rem; display: flex; align-items: center; justify-content: center; transition: all 0.3s; }
        .theme-btn:hover { background: var(--accent); transform: rotate(20deg); }
        [data-theme="light"] .theme-btn { border-color: rgba(0,0,0,0.1); }
        
        /* Page Content */
        .page-content { flex: 1; padding: 25px; overflow-y: auto; }
        .page { display: none; animation: fadeIn 0.3s; }
        .page.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes pulse { 0%, 100% { opacity: 1; transform: scale(1); } 50% { opacity: 0.5; transform: scale(1.2); } }
        
        /* Levels Grid */
        .levels-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; }
        .level-card { background: var(--tertiary); border-radius: 12px; padding: 20px; text-align: center; border: 2px solid transparent; transition: all 0.3s; }
        .level-card .badge { font-size: 2.5rem; display: block; margin-bottom: 10px; }
        .level-card .name { font-weight: 700; font-size: 1.1rem; margin-bottom: 5px; }
        .level-card .range { font-size: 0.8rem; color: var(--text-muted); margin-bottom: 10px; }
        .level-card .count { font-size: 1.5rem; font-weight: 700; }
        .level-card.bronze { border-color: #cd7f32; } .level-card.bronze .count { color: #cd7f32; }
        .level-card.silver { border-color: #c0c0c0; } .level-card.silver .count { color: #c0c0c0; }
        .level-card.gold { border-color: #ffd700; } .level-card.gold .count { color: #ffd700; }
        .level-card.diamond { border-color: #b9f2ff; } .level-card.diamond .count { color: #b9f2ff; }
        
        /* Cards */
        .card { background: var(--secondary); border: 1px solid rgba(255,255,255,0.1); border-radius: 16px; margin-bottom: 20px; overflow: hidden; }
        .card-header { padding: 18px 20px; border-bottom: 1px solid rgba(255,255,255,0.1); display: flex; justify-content: space-between; align-items: center; }
        .card-header h3 { font-size: 1rem; font-weight: 600; display: flex; align-items: center; gap: 10px; }
        .card-body { padding: 20px; }
        
        /* Stats Grid */
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 25px; }
        .stat-card { background: var(--secondary); border: 1px solid rgba(255,255,255,0.1); border-radius: 16px; padding: 20px; position: relative; overflow: hidden; }
        .stat-card::before { content: ''; position: absolute; top: 0; right: 0; width: 100px; height: 100px; background: radial-gradient(circle, var(--accent) 0%, transparent 70%); opacity: 0.1; }
        .stat-card .icon { width: 50px; height: 50px; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; margin-bottom: 15px; }
        .stat-card .icon.blue { background: rgba(23,162,184,0.2); color: var(--info); }
        .stat-card .icon.green { background: rgba(0,217,165,0.2); color: var(--success); }
        .stat-card .icon.gold { background: rgba(255,215,0,0.2); color: var(--gold); }
        .stat-card .icon.red { background: rgba(233,69,96,0.2); color: var(--accent); }
        .stat-card .number { font-size: 2rem; font-weight: 900; margin-bottom: 5px; }
        .stat-card .label { color: var(--text-muted); font-size: 0.85rem; }
        .stat-card .change { font-size: 0.75rem; margin-top: 10px; }
        .stat-card .change.up { color: var(--success); }
        .stat-card .change.down { color: var(--danger); }
        
        /* Charts */
        .charts-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 20px; margin-bottom: 25px; }
        .chart-container { height: 300px; position: relative; }
        
        /* Provinces Map */
        .provinces-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 15px; }
        .province-card { background: var(--secondary); border-radius: 12px; padding: 15px; text-align: center; border: 2px solid transparent; transition: all 0.3s; position: relative; overflow: hidden; }
        .province-card:hover { transform: translateY(-3px); border-color: var(--accent); }
        .province-card .name { font-weight: 700; font-size: 0.95rem; margin-bottom: 10px; }
        .province-card .stats { display: flex; justify-content: space-around; font-size: 0.8rem; }
        .province-card .stat { text-align: center; }
        .province-card .stat .value { font-size: 1.2rem; font-weight: 700; color: var(--gold); }
        .province-card .stat .label { color: var(--text-muted); font-size: 0.7rem; }
        .province-card .bar { position: absolute; bottom: 0; left: 0; height: 4px; background: linear-gradient(90deg, var(--accent), var(--gold)); border-radius: 0 0 12px 12px; }
        .province-card.top { border-color: var(--gold); box-shadow: 0 0 20px rgba(255,215,0,0.2); }
        .province-card.top::before { content: 'ğŸ‘‘'; position: absolute; top: -5px; right: -5px; font-size: 1.5rem; }
        
        /* Tables */
        .table-container { overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; font-size: 0.85rem; }
        th, td { padding: 12px 15px; text-align: right; border-bottom: 1px solid rgba(255,255,255,0.1); }
        th { background: rgba(0,0,0,0.3); font-weight: 600; color: var(--text-muted); font-size: 0.75rem; text-transform: uppercase; }
        tr:hover { background: rgba(255,255,255,0.02); }
        
        /* Buttons */
        .btn { padding: 10px 20px; border: none; border-radius: 10px; font-family: inherit; font-size: 0.85rem; font-weight: 600; cursor: pointer; transition: all 0.2s; display: inline-flex; align-items: center; gap: 8px; }
        .btn:hover { transform: translateY(-1px); }
        .btn-primary { background: linear-gradient(135deg, var(--accent), var(--accent-light)); color: white; }
        .btn-success { background: var(--success); color: var(--primary); }
        .btn-warning { background: var(--warning); color: var(--primary); }
        .btn-danger { background: var(--danger); color: white; }
        .btn-secondary { background: var(--tertiary); color: var(--text); border: 1px solid rgba(255,255,255,0.1); }
        .btn-sm { padding: 6px 12px; font-size: 0.75rem; }
        .btn-icon { width: 36px; height: 36px; padding: 0; justify-content: center; }
        
        /* Forms */
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; margin-bottom: 8px; font-weight: 600; color: var(--text-muted); font-size: 0.85rem; }
        .form-control { width: 100%; padding: 12px 15px; border: 2px solid rgba(255,255,255,0.1); border-radius: 10px; background: var(--primary); color: var(--text); font-family: inherit; font-size: 0.9rem; transition: all 0.2s; }
        .form-control:focus { outline: none; border-color: var(--accent); }
        select.form-control { cursor: pointer; }
        
        .form-row { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; }
        
        .switch { position: relative; width: 50px; height: 26px; display: inline-block; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .switch .slider { position: absolute; cursor: pointer; inset: 0; background: var(--tertiary); border-radius: 26px; transition: 0.3s; }
        .switch .slider::before { position: absolute; content: ""; height: 20px; width: 20px; right: 3px; bottom: 3px; background: var(--text-muted); border-radius: 50%; transition: 0.3s; }
        .switch input:checked + .slider { background: var(--success); }
        .switch input:checked + .slider::before { transform: translateX(-24px); background: white; }
        
        .setting-row { display: flex; justify-content: space-between; align-items: center; padding: 15px; background: var(--tertiary); border-radius: 10px; margin-bottom: 10px; }
        .setting-row .info h4 { font-size: 0.9rem; margin-bottom: 3px; }
        .setting-row .info p { font-size: 0.75rem; color: var(--text-muted); }
        
        /* Status Badges */
        .status { padding: 4px 12px; border-radius: 20px; font-size: 0.7rem; font-weight: 600; }
        .status-registered { background: rgba(136,146,176,0.2); color: var(--text-muted); }
        .status-winner { background: rgba(255,215,0,0.2); color: var(--gold); }
        .status-claimed { background: rgba(0,217,165,0.2); color: var(--success); }
        .status-active { background: rgba(0,217,165,0.2); color: var(--success); }
        .status-inactive { background: rgba(220,53,69,0.2); color: var(--danger); }
        
        .role-badge { padding: 4px 12px; border-radius: 20px; font-size: 0.7rem; font-weight: 600; }
        .role-admin { background: linear-gradient(135deg, var(--gold), #b8860b); color: var(--primary); }
        .role-moderator { background: linear-gradient(135deg, var(--accent), var(--accent-light)); color: white; }
        .role-staff { background: linear-gradient(135deg, var(--success), #00b894); color: var(--primary); }
        
        /* Modal */
        .modal-overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.8); z-index: 1000; align-items: center; justify-content: center; padding: 20px; }
        .modal-overlay.active { display: flex; }
        .modal { background: var(--secondary); border: 1px solid rgba(255,255,255,0.1); border-radius: 20px; max-width: 500px; width: 100%; max-height: 90vh; overflow-y: auto; animation: modalIn 0.3s; }
        @keyframes modalIn { from { opacity: 0; transform: scale(0.9); } to { opacity: 1; transform: scale(1); } }
        .modal-header { padding: 20px; border-bottom: 1px solid rgba(255,255,255,0.1); display: flex; justify-content: space-between; align-items: center; }
        .modal-header h3 { font-size: 1.1rem; }
        .modal-close { width: 36px; height: 36px; border-radius: 10px; background: var(--tertiary); border: none; color: var(--text); cursor: pointer; font-size: 1.2rem; }
        .modal-body { padding: 20px; }
        .modal-footer { padding: 20px; border-top: 1px solid rgba(255,255,255,0.1); display: flex; gap: 10px; justify-content: flex-end; }
        
        /* Toast */
        .toast-container { position: fixed; bottom: 20px; left: 20px; z-index: 2000; display: flex; flex-direction: column; gap: 10px; }
        .toast { padding: 15px 20px; border-radius: 12px; display: flex; align-items: center; gap: 12px; animation: toastIn 0.3s; min-width: 300px; }
        @keyframes toastIn { from { opacity: 0; transform: translateX(-50px); } to { opacity: 1; transform: translateX(0); } }
        .toast-success { background: var(--success); color: var(--primary); }
        .toast-error { background: var(--danger); color: white; }
        .toast-warning { background: var(--warning); color: var(--primary); }
        .toast-info { background: var(--info); color: white; }
        
        /* Notifications Panel */
        .notifications-panel { position: fixed; top: var(--header-height); left: 0; width: 350px; max-height: calc(100vh - var(--header-height)); background: var(--secondary); border: 1px solid rgba(255,255,255,0.1); border-radius: 0 0 16px 0; box-shadow: 5px 5px 30px rgba(0,0,0,0.3); z-index: 90; display: none; overflow-y: auto; }
        .notifications-panel.active { display: block; }
        .notifications-header { padding: 15px 20px; border-bottom: 1px solid rgba(255,255,255,0.1); display: flex; justify-content: space-between; align-items: center; }
        .notification-item { padding: 15px 20px; border-bottom: 1px solid rgba(255,255,255,0.05); cursor: pointer; transition: background 0.2s; }
        .notification-item:hover { background: rgba(255,255,255,0.02); }
        .notification-item.unread { background: rgba(233,69,96,0.05); border-right: 3px solid var(--accent); }
        .notification-item .title { font-weight: 600; font-size: 0.85rem; margin-bottom: 5px; }
        .notification-item .text { font-size: 0.75rem; color: var(--text-muted); }
        .notification-item .time { font-size: 0.7rem; color: var(--text-muted); margin-top: 8px; }
        
        /* Filters */
        .filters { display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 20px; }
        .filters .form-control { width: auto; min-width: 150px; }
        
        /* Province Grid */
        .province-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 10px; }
        .province-item { background: var(--tertiary); border-radius: 10px; padding: 12px 15px; display: flex; justify-content: space-between; align-items: center; }
        .province-item .name { font-size: 0.85rem; }
        .province-item .count { font-weight: 700; color: var(--gold); }
        
        /* Checkbox Grid */
        .checkbox-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px; }
        .checkbox-item { display: flex; align-items: center; gap: 10px; padding: 10px 15px; background: var(--tertiary); border-radius: 10px; cursor: pointer; }
        .checkbox-item input { width: 18px; height: 18px; accent-color: var(--accent); }
        .checkbox-item.checked { background: rgba(220,53,69,0.2); border: 1px solid var(--danger); }
        
        /* Roulette */
        .roulette-section { text-align: center; padding: 30px; }
        .roulette-wheel { width: 280px; height: 280px; margin: 0 auto 30px; border-radius: 50%; border: 6px solid var(--gold); position: relative; background: conic-gradient(var(--accent) 0deg 60deg, var(--gold) 60deg 120deg, var(--success) 120deg 180deg, var(--accent) 180deg 240deg, var(--gold) 240deg 300deg, var(--success) 300deg 360deg); box-shadow: 0 0 50px rgba(255,215,0,0.3); }
        .roulette-wheel::before { content: ''; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 60px; height: 60px; background: var(--primary); border-radius: 50%; border: 4px solid var(--gold); z-index: 2; }
        .roulette-wheel::after { content: 'ğŸ°'; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 1.5rem; z-index: 3; }
        .roulette-pointer { position: absolute; top: -15px; left: 50%; transform: translateX(-50%); width: 0; height: 0; border-left: 15px solid transparent; border-right: 15px solid transparent; border-top: 30px solid var(--gold); z-index: 4; filter: drop-shadow(0 3px 5px rgba(0,0,0,0.3)); }
        .roulette-wheel.spinning { animation: spin 4s cubic-bezier(0.17, 0.67, 0.12, 0.99) forwards; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(var(--spin-deg, 1800deg)); } }
        
        /* Responsive */
        @media (max-width: 1024px) {
            .sidebar { transform: translateX(100%); }
            .sidebar.open { transform: translateX(0); }
            .main-content { margin-right: 0; }
            .menu-toggle { display: block !important; }
        }
        .menu-toggle { display: none; width: 40px; height: 40px; border-radius: 10px; background: var(--tertiary); border: none; color: var(--text); cursor: pointer; font-size: 1.2rem; }
        
        /* Danger Zone */
        .danger-zone { background: rgba(220,53,69,0.1); border: 1px solid var(--danger); border-radius: 16px; padding: 20px; }
        .danger-zone h4 { color: var(--danger); margin-bottom: 15px; display: flex; align-items: center; gap: 10px; }
        
        /* Backup */
        .backup-item { display: flex; justify-content: space-between; align-items: center; padding: 15px; background: var(--tertiary); border-radius: 10px; margin-bottom: 10px; }
        .backup-item .info { display: flex; align-items: center; gap: 15px; }
        .backup-item .icon { width: 40px; height: 40px; background: rgba(0,217,165,0.2); color: var(--success); border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 1.2rem; }
        .backup-item .details h4 { font-size: 0.9rem; margin-bottom: 3px; }
        .backup-item .details p { font-size: 0.75rem; color: var(--text-muted); }
        
        /* Coupon */
        .coupon-card { background: linear-gradient(135deg, var(--accent), var(--gold)); border-radius: 16px; padding: 20px; color: var(--primary); position: relative; overflow: hidden; }
        .coupon-card::before { content: ''; position: absolute; top: -50px; left: -50px; width: 100px; height: 100px; background: rgba(255,255,255,0.1); border-radius: 50%; }
        .coupon-card .code { font-family: monospace; font-size: 1.5rem; font-weight: 900; letter-spacing: 3px; margin: 15px 0; }
        .coupon-card .discount { font-size: 2rem; font-weight: 900; }
        
        /* Activity Timeline */
        .timeline { position: relative; padding-right: 30px; }
        .timeline::before { content: ''; position: absolute; right: 10px; top: 0; bottom: 0; width: 2px; background: var(--tertiary); }
        .timeline-item { position: relative; padding-bottom: 25px; }
        .timeline-item::before { content: ''; position: absolute; right: -26px; top: 5px; width: 12px; height: 12px; background: var(--accent); border-radius: 50%; border: 3px solid var(--secondary); }
        .timeline-item .time { font-size: 0.7rem; color: var(--text-muted); margin-bottom: 5px; }
        .timeline-item .content { background: var(--tertiary); padding: 12px 15px; border-radius: 10px; font-size: 0.85rem; }
        
        /* Permissions Styles */
        .permission-tag {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 8px 12px;
            background: var(--tertiary);
            border-radius: 20px;
            font-size: 0.85rem;
            cursor: grab;
            transition: all 0.2s;
            user-select: none;
            border: 2px solid transparent;
        }
        .permission-tag:hover {
            background: var(--primary);
            color: white;
            transform: scale(1.05);
        }
        .permission-tag.dragging {
            opacity: 0.5;
            transform: scale(0.95);
        }
        .permission-tag.assigned {
            background: var(--primary);
            color: white;
        }
        .permission-tag .icon {
            font-size: 1rem;
        }
        .permission-tag .remove-btn {
            display: none;
            margin-right: 5px;
            cursor: pointer;
            opacity: 0.7;
        }
        .permission-tag.assigned .remove-btn {
            display: inline;
        }
        .permission-tag.assigned .remove-btn:hover {
            opacity: 1;
        }
        .permissions-list {
            min-height: 50px;
        }
        .permissions-list.drag-over {
            background: rgba(37,99,235,0.2);
            border-radius: 8px;
        }
        .permission-action {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            padding: 6px 12px;
            background: var(--tertiary);
            border-radius: 15px;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        .permission-action:hover {
            background: var(--primary);
            color: white;
        }
        .permission-action.active {
            background: var(--success);
            color: white;
        }
        .permission-action input {
            width: 16px;
            height: 16px;
            cursor: pointer;
        }
    </style>
    <!-- QR Code Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
</head>
<body>
    <!-- Login Page -->
    <div class="login-page" id="login-page">
        <div class="login-card">
            <div class="login-logo">
                <img src="/uploads/redstrong.png" alt="Logo">
                <h1>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</h1>
            </div>
            <form id="login-form">
                <div class="form-group">
                    <label>Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</label>
                    <input type="text" id="login-username" required placeholder="admin">
                </div>
                <div class="form-group">
                    <label>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
                    <input type="password" id="login-password" required placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
                </div>
                <button type="submit" class="login-btn">ğŸ” ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
            </form>
        </div>
    </div>

    <!-- Admin Layout -->
    <div class="admin-layout" id="admin-layout">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <img src="/uploads/redstrong.png" alt="Logo">
                <h2>Red Strong</h2>
            </div>
            <nav class="sidebar-menu">
                <div class="menu-section">
                    <div class="menu-section-title">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</div>
                    <div class="menu-item active" data-page="dashboard">
                        <span class="icon">ğŸ“Š</span>
                        <span class="label">Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª</span>
                    </div>
                    <div class="menu-item" data-page="players">
                        <span class="icon">ğŸ‘¥</span>
                        <span class="label">Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†</span>
                        <span class="badge" id="players-count">0</span>
                    </div>
                    <div class="menu-item" data-page="roulette">
                        <span class="icon">ğŸ°</span>
                        <span class="label">Ø§Ù„Ø±ÙˆÙ„ÙŠØª</span>
                    </div>
                </div>
                
                <div class="menu-section">
                    <div class="menu-section-title">Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</div>
                    <div class="menu-item" data-page="prizes">
                        <span class="icon">ğŸ</span>
                        <span class="label">Ø§Ù„Ø¬ÙˆØ§Ø¦Ø²</span>
                    </div>
                    <div class="menu-item" data-page="announcements">
                        <span class="icon">ğŸ“¢</span>
                        <span class="label">Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª</span>
                    </div>
                    <div class="menu-item" data-page="branches">
                        <span class="icon">ğŸª</span>
                        <span class="label">Ø§Ù„ÙØ±ÙˆØ¹</span>
                    </div>
                    <div class="menu-item" data-page="users">
                        <span class="icon">ğŸ‘¤</span>
                        <span class="label">Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</span>
                    </div>
                    <div class="menu-item" data-page="coupons">
                        <span class="icon">ğŸ«</span>
                        <span class="label">Ø§Ù„ÙƒÙˆØ¨ÙˆÙ†Ø§Øª</span>
                    </div>
                    <div class="menu-item" data-page="referrals">
                        <span class="icon">ğŸ‘¥</span>
                        <span class="label">Ø§Ù„Ø¥Ø­Ø§Ù„Ø§Øª</span>
                    </div>
                    <div class="menu-item" data-page="whatsapp">
                        <span class="icon">ğŸ“±</span>
                        <span class="label">WhatsApp</span>
                    </div>
                    <div class="menu-item" data-page="chat">
                        <span class="icon">ğŸ’¬</span>
                        <span class="label">Ø§Ù„Ø¯Ø±Ø¯Ø´Ø©</span>
                    </div>
                    <div class="menu-item" data-page="reports">
                        <span class="icon">ğŸ“Š</span>
                        <span class="label">Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</span>
                    </div>
                    <div class="menu-item" data-page="lucky-wheel">
                        <span class="icon">ğŸ¡</span>
                        <span class="label">Ø¹Ø¬Ù„Ø© Ø§Ù„Ø­Ø¸</span>
                    </div>
                    <div class="menu-item has-submenu" id="settings-menu">
                        <span class="icon">âš™ï¸</span>
                        <span class="label">Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</span>
                    </div>
                    <div class="submenu" id="settings-submenu">
                        <div class="menu-item" data-page="settings-game">
                            <span class="icon">ğŸ®</span>
                            <span class="label">Ø§Ù„Ù„Ø¹Ø¨Ø©</span>
                        </div>
                        <div class="menu-item" data-page="settings-points">
                            <span class="icon">ğŸ¯</span>
                            <span class="label">Ø§Ù„Ù†Ù‚Ø§Ø·</span>
                        </div>
                        <div class="menu-item" data-page="settings-brand">
                            <span class="icon">ğŸ¨</span>
                            <span class="label">Ù‡ÙˆÙŠØ© Ø§Ù„Ù…ÙˆÙ‚Ø¹</span>
                        </div>
                        <div class="menu-item" data-page="settings-social">
                            <span class="icon">ğŸ“±</span>
                            <span class="label">Ø§Ù„Ø³ÙˆØ´ÙŠØ§Ù„</span>
                        </div>
                        <div class="menu-item" data-page="settings-contact">
                            <span class="icon">ğŸ“</span>
                            <span class="label">Ø§Ù„ØªÙˆØ§ØµÙ„</span>
                        </div>
                        <div class="menu-item" data-page="settings-contest">
                            <span class="icon">ğŸ“…</span>
                            <span class="label">Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©</span>
                        </div>
                        <div class="menu-item" data-page="settings-goals">
                            <span class="icon">ğŸ¯</span>
                            <span class="label">Ø§Ù„Ø£Ù‡Ø¯Ø§Ù Ø§Ù„ÙŠÙˆÙ…ÙŠØ©</span>
                        </div>
                        <div class="menu-item" data-page="settings-display">
                            <span class="icon">ğŸ‘ï¸</span>
                            <span class="label">Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø¹Ø±Ø¶</span>
                        </div>
                        <div class="menu-item" data-page="settings-provinces">
                            <span class="icon">ğŸš«</span>
                            <span class="label">Ø­Ø¸Ø± Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø§Øª</span>
                        </div>
                        <div class="menu-item" data-page="settings-danger">
                            <span class="icon">âš ï¸</span>
                            <span class="label">Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø®Ø·Ø±</span>
                        </div>
                    </div>
                </div>
                
                <div class="menu-section">
                    <div class="menu-section-title">Ø§Ù„Ù†Ø¸Ø§Ù…</div>
                    <div class="menu-item" data-page="analytics">
                        <span class="icon">ğŸ“ˆ</span>
                        <span class="label">Ø§Ù„ØªØ­Ù„ÙŠÙ„Ø§Øª</span>
                    </div>
                    <div class="menu-item" data-page="blocking">
                        <span class="icon">ğŸš«</span>
                        <span class="label">Ø§Ù„Ø­Ø¸Ø±</span>
                    </div>
                    <div class="menu-item" data-page="backup">
                        <span class="icon">ğŸ”„</span>
                        <span class="label">Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ</span>
                    </div>
                    <div class="menu-item" data-page="logs">
                        <span class="icon">ğŸ“</span>
                        <span class="label">Ø³Ø¬Ù„ Ø§Ù„Ù†Ø´Ø§Ø·Ø§Øª</span>
                    </div>
                </div>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Header -->
            <header class="main-header">
                <div style="display:flex;align-items:center;gap:15px;">
                    <button class="menu-toggle" onclick="toggleSidebar()">â˜°</button>
                    <h1 class="header-title" id="page-title">Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª</h1>
                </div>
                <div class="header-actions">
                    <div class="lang-switch">
                    </div>
                    <button class="theme-btn" onclick="toggleTheme()" title="ØªØºÙŠÙŠØ± Ø§Ù„Ù…Ø¸Ù‡Ø±">
                        <span id="theme-icon">ğŸŒ™</span>
                    </button>
                    <button class="notification-btn" onclick="toggleNotifications()">
                        ğŸ””
                        <span class="count" id="notif-count">0</span>
                    </button>
                    <div class="user-menu" onclick="toggleUserMenu()">
                        <div class="info">
                            <div class="name" id="user-name">Ø§Ù„Ù…Ø¯ÙŠØ±</div>
                            <div class="role" id="user-role">Admin</div>
                        </div>
                        <div class="avatar" id="user-avatar">A</div>
                    </div>
                    <button class="btn btn-secondary btn-sm" onclick="logout()">ğŸšª</button>
                </div>
            </header>

            <!-- Notifications Panel -->
            <div class="notifications-panel" id="notifications-panel">
                <div class="notifications-header">
                    <h4>ğŸ”” Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</h4>
                    <button class="btn btn-sm btn-secondary" onclick="markAllRead()">Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„ÙƒÙ„</button>
                </div>
                <div id="notifications-list">
                    <!-- Notifications will be loaded here -->
                </div>
            </div>

            <!-- Page Content -->
            <div class="page-content">
                <!-- Dashboard Page -->
                <div class="page active" id="page-dashboard">
                    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;">
                        <div style="display:flex;align-items:center;gap:10px;">
                            <span id="live-indicator" style="width:10px;height:10px;background:#00d9a5;border-radius:50%;animation:pulse 2s infinite;"></span>
                            <span style="color:var(--success);font-weight:600;">Ù…Ø¨Ø§Ø´Ø±</span>
                            <span style="color:var(--text-muted);font-size:0.8rem;">(ØªØ­Ø¯ÙŠØ« ØªÙ„Ù‚Ø§Ø¦ÙŠ ÙƒÙ„ 30 Ø«Ø§Ù†ÙŠØ©)</span>
                        </div>
                        <div style="display:flex;gap:10px;">
                            <button class="btn btn-sm btn-secondary" onclick="toggleSound()" title="ØªØ´ØºÙŠÙ„/Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ØµÙˆØª">
                                <span id="sound-icon">ğŸ””</span>
                            </button>
                            <button class="btn btn-sm btn-primary" onclick="loadDashboard()">ğŸ”„ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¢Ù†</button>
                        </div>
                    </div>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="icon blue">ğŸ‘¥</div>
                            <div class="number" id="stat-total">0</div>
                            <div class="label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†</div>
                            <div class="change up" id="stat-total-change">â†‘ 12% Ù‡Ø°Ø§ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹</div>
                        </div>
                        <div class="stat-card">
                            <div class="icon gold">ğŸ†</div>
                            <div class="number" id="stat-winners">0</div>
                            <div class="label">Ø§Ù„ÙØ§Ø¦Ø²ÙŠÙ†</div>
                            <div class="change up">â†‘ 5 Ø¬Ø¯Ø¯ Ø§Ù„ÙŠÙˆÙ…</div>
                        </div>
                        <div class="stat-card">
                            <div class="icon green">âœ…</div>
                            <div class="number" id="stat-claimed">0</div>
                            <div class="label">ØªÙ… Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…</div>
                        </div>
                        <div class="stat-card">
                            <div class="icon red">â³</div>
                            <div class="number" id="stat-pending">0</div>
                            <div class="label">Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…</div>
                        </div>
                    </div>
                    
                    <div class="charts-grid">
                        <div class="card">
                            <div class="card-header">
                                <h3>ğŸ“ˆ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø§Ù„Ø¬Ø¯Ø¯</h3>
                                <select class="form-control" style="width:auto;" id="chart-period" onchange="updatePlayersChart()">
                                    <option value="week">Ù‡Ø°Ø§ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹</option>
                                    <option value="month">Ù‡Ø°Ø§ Ø§Ù„Ø´Ù‡Ø±</option>
                                    <option value="year">Ù‡Ø°Ù‡ Ø§Ù„Ø³Ù†Ø©</option>
                                </select>
                            </div>
                            <div class="card-body">
                                <div class="chart-container">
                                    <canvas id="playersChart"></canvas>
                                </div>
                            </div>
                        </div>
                        <div class="card">
                            <div class="card-header">
                                <h3>ğŸ—ºï¸ ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø§Øª</h3>
                            </div>
                            <div class="card-body">
                                <div class="chart-container">
                                    <canvas id="provincesChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="charts-grid">
                        <div class="card">
                            <div class="card-header">
                                <h3>ğŸ† Ø£Ø¹Ù„Ù‰ Ø§Ù„Ù†Ù‚Ø§Ø·</h3>
                            </div>
                            <div class="card-body">
                                <div class="chart-container">
                                    <canvas id="topScoresChart"></canvas>
                                </div>
                            </div>
                        </div>
                        <div class="card">
                            <div class="card-header">
                                <h3>ğŸ“Š Ø§Ù„ÙØ§Ø¦Ø²ÙŠÙ† Ø­Ø³Ø¨ Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©</h3>
                            </div>
                            <div class="card-body">
                                <div class="chart-container">
                                    <canvas id="winnersChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <h3>ğŸ• Ø¢Ø®Ø± Ø§Ù„Ù†Ø´Ø§Ø·Ø§Øª</h3>
                            <button class="btn btn-sm btn-secondary" onclick="loadRecentActivity()">ğŸ”„ ØªØ­Ø¯ÙŠØ«</button>
                        </div>
                        <div class="card-body">
                            <div class="timeline" id="recent-activity">
                                <!-- Activity items -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Reports Page -->
                <div class="page" id="page-reports">
                    <div class="stats-grid" style="margin-bottom:20px;">
                        <div class="stat-card">
                            <div class="icon" style="background:linear-gradient(135deg,#6f42c1,#9b59b6);">ğŸ“Š</div>
                            <div class="value" id="report-total-players">0</div>
                            <div class="label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†</div>
                        </div>
                        <div class="stat-card">
                            <div class="icon" style="background:linear-gradient(135deg,var(--success),#00b894);">ğŸ†</div>
                            <div class="value" id="report-total-winners">0</div>
                            <div class="label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙØ§Ø¦Ø²ÙŠÙ†</div>
                        </div>
                        <div class="stat-card">
                            <div class="icon" style="background:linear-gradient(135deg,var(--gold),#f39c12);">â­</div>
                            <div class="value" id="report-avg-score">0</div>
                            <div class="label">Ù…ØªÙˆØ³Ø· Ø§Ù„Ù†Ù‚Ø§Ø·</div>
                        </div>
                        <div class="stat-card">
                            <div class="icon" style="background:linear-gradient(135deg,var(--info),#3498db);">ğŸ“ˆ</div>
                            <div class="value" id="report-today-players">0</div>
                            <div class="label">Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø§Ù„ÙŠÙˆÙ…</div>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <h3>ğŸ“„ Ø¥Ù†Ø´Ø§Ø¡ ØªÙ‚Ø±ÙŠØ±</h3>
                        </div>
                        <div class="card-body">
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Ù†ÙˆØ¹ Ø§Ù„ØªÙ‚Ø±ÙŠØ±</label>
                                    <select class="form-control" id="report-type">
                                        <option value="players">ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†</option>
                                        <option value="winners">ØªÙ‚Ø±ÙŠØ± Ø§Ù„ÙØ§Ø¦Ø²ÙŠÙ†</option>
                                        <option value="provinces">ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø§Øª</option>
                                        <option value="daily">ØªÙ‚Ø±ÙŠØ± ÙŠÙˆÙ…ÙŠ</option>
                                        <option value="full">ØªÙ‚Ø±ÙŠØ± Ø´Ø§Ù…Ù„</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Ù…Ù† ØªØ§Ø±ÙŠØ®</label>
                                    <input type="date" class="form-control" id="report-from">
                                </div>
                                <div class="form-group">
                                    <label>Ø¥Ù„Ù‰ ØªØ§Ø±ÙŠØ®</label>
                                    <input type="date" class="form-control" id="report-to">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
                                    <select class="form-control" id="report-province">
                                        <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø§Øª</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>ØµÙŠØºØ© Ø§Ù„ØªØµØ¯ÙŠØ±</label>
                                    <select class="form-control" id="report-format">
                                        <option value="pdf">PDF</option>
                                        <option value="excel">Excel</option>
                                    </select>
                                </div>
                                <div class="form-group" style="display:flex;align-items:flex-end;">
                                    <button class="btn btn-primary" onclick="generateReport()">ğŸ“¥ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªÙ‚Ø±ÙŠØ±</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <h3>ğŸ—ºï¸ Ø®Ø±ÙŠØ·Ø© Ø§Ù„ÙØ§Ø¦Ø²ÙŠÙ†</h3>
                        </div>
                        <div class="card-body">
                            <div id="winners-map" style="min-height:400px;background:var(--tertiary);border-radius:10px;padding:20px;">
                                <div class="provinces-grid" id="provinces-map-grid">
                                    <!-- Will be populated by JS -->
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <h3>ğŸ“Š Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª ØªÙØµÙŠÙ„ÙŠØ©</h3>
                        </div>
                        <div class="card-body">
                            <div class="table-container">
                                <table>
                                    <thead>
                                        <tr>
                                            <th>Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©</th>
                                            <th>Ø¹Ø¯Ø¯ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†</th>
                                            <th>Ø¹Ø¯Ø¯ Ø§Ù„ÙØ§Ø¦Ø²ÙŠÙ†</th>
                                            <th>Ù†Ø³Ø¨Ø© Ø§Ù„ÙÙˆØ²</th>
                                            <th>Ù…ØªÙˆØ³Ø· Ø§Ù„Ù†Ù‚Ø§Ø·</th>
                                            <th>Ø£Ø¹Ù„Ù‰ Ù†Ù‚Ø§Ø·</th>
                                        </tr>
                                    </thead>
                                    <tbody id="province-stats-table"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Players Page -->
                <div class="page" id="page-players">
                    <div class="card">
                        <div class="card-header">
                            <h3>ğŸ‘¥ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†</h3>
                            <button class="btn btn-success btn-sm" onclick="exportPlayers()">ğŸ“¥ ØªØµØ¯ÙŠØ± Excel</button>
                        </div>
                        <div class="card-body">
                            <div class="filters">
                                <input type="text" class="form-control" placeholder="ğŸ” Ø¨Ø­Ø«..." id="players-search" onkeyup="filterPlayers()">
                                <select class="form-control" id="players-province" onchange="filterPlayers()">
                                    <option value="">ÙƒÙ„ Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø§Øª</option>
                                </select>
                                <select class="form-control" id="players-status" onchange="filterPlayers()">
                                    <option value="">ÙƒÙ„ Ø§Ù„Ø­Ø§Ù„Ø§Øª</option>
                                    <option value="registered">Ù…Ø³Ø¬Ù„</option>
                                    <option value="winner">ÙØ§Ø¦Ø²</option>
                                    <option value="claimed">Ù…Ø³ØªÙ„Ù…</option>
                                </select>
                            </div>
                            <div class="table-container">
                                <table>
                                    <thead>
                                        <tr>
                                            <th>#</th>
                                            <th>Ø§Ù„Ø§Ø³Ù…</th>
                                            <th>Ø§Ù„Ù‡Ø§ØªÙ</th>
                                            <th>Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©</th>
                                            <th>Ø§Ù„Ù†Ù‚Ø§Ø·</th>
                                            <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                                            <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                                            <th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                                        </tr>
                                    </thead>
                                    <tbody id="players-table"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Roulette Page -->
                <div class="page" id="page-roulette">
                    <div class="card">
                        <div class="card-header">
                            <h3>ğŸ° Ø³Ø­Ø¨ Ø§Ù„Ø±ÙˆÙ„ÙŠØª</h3>
                        </div>
                        <div class="card-body">
                            <div class="roulette-section">
                                <div class="roulette-wheel" id="roulette-wheel">
                                    <div class="roulette-pointer"></div>
                                </div>
                                <p style="color:var(--text-muted);margin-bottom:20px;">Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø§Ù„Ù…Ø¤Ù‡Ù„ÙŠÙ†: <strong id="eligible-count">0</strong> (Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰: <span id="min-score">1500</span> Ù†Ù‚Ø·Ø©)</p>
                                <button class="btn btn-primary" onclick="spinRoulette()" id="spin-btn">ğŸ° Ø³Ø­Ø¨ ÙØ§Ø¦Ø²</button>
                            </div>
                            <div id="winner-result" style="display:none;margin-top:30px;">
                                <div class="card" style="background:linear-gradient(135deg,rgba(255,215,0,0.1),rgba(233,69,96,0.1));border-color:var(--gold);">
                                    <div class="card-body" style="text-align:center;">
                                        <h2 style="color:var(--gold);margin-bottom:15px;">ğŸ‰ Ø§Ù„ÙØ§Ø¦Ø²</h2>
                                        <h3 id="winner-name" style="font-size:1.5rem;margin-bottom:10px;"></h3>
                                        <p id="winner-phone" style="color:var(--text-muted);"></p>
                                        <p>Ø§Ù„Ù†Ù‚Ø§Ø·: <strong id="winner-score" style="color:var(--gold);"></strong></p>
                                        <p>Ø§Ù„ÙƒÙˆØ¯: <strong id="winner-code" style="font-family:monospace;color:var(--success);font-size:1.2rem;"></strong></p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <h3>ğŸ† Ø§Ù„Ù…Ø¤Ù‡Ù„ÙŠÙ† Ù„Ù„Ø³Ø­Ø¨</h3>
                        </div>
                        <div class="card-body">
                            <div class="table-container">
                                <table>
                                    <thead>
                                        <tr><th>#</th><th>Ø§Ù„Ø§Ø³Ù…</th><th>Ø§Ù„Ù‡Ø§ØªÙ</th><th>Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©</th><th>Ø§Ù„Ù†Ù‚Ø§Ø·</th></tr>
                                    </thead>
                                    <tbody id="eligible-table"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Prizes Page -->
                <div class="page" id="page-prizes">
                    <div class="card">
                        <div class="card-header">
                            <h3>ğŸ Ø§Ù„Ø¬ÙˆØ§Ø¦Ø²</h3>
                            <button class="btn btn-primary btn-sm" onclick="showPrizeModal()">+ Ø¥Ø¶Ø§ÙØ© Ø¬Ø§Ø¦Ø²Ø©</button>
                        </div>
                        <div class="card-body">
                            <div class="table-container">
                                <table>
                                    <thead>
                                        <tr><th>#</th><th>Ø§Ù„ØµÙˆØ±Ø©</th><th>Ø§Ù„Ø§Ø³Ù…</th><th>Ø§Ù„ÙˆØµÙ</th><th>Ø§Ù„Ø­Ø§Ù„Ø©</th><th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th></tr>
                                    </thead>
                                    <tbody id="prizes-table"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Announcements Page -->
                <div class="page" id="page-announcements">
                    <div class="card">
                        <div class="card-header">
                            <h3>ğŸ“¢ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª</h3>
                            <button class="btn btn-primary btn-sm" onclick="showAnnouncementModal()">+ Ø¥Ø¹Ù„Ø§Ù† Ø¬Ø¯ÙŠØ¯</button>
                        </div>
                        <div class="card-body">
                            <div class="table-container">
                                <table>
                                    <thead>
                                        <tr><th>#</th><th>Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†</th><th>Ø§Ù„Ù†ÙˆØ¹</th><th>Ø§Ù„Ø±Ø§Ø¨Ø·</th><th>Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©</th><th>Ø§Ù„Ø­Ø§Ù„Ø©</th><th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th></tr>
                                    </thead>
                                    <tbody id="announcements-table"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Branches Page -->
                <div class="page" id="page-branches">
                    <div class="card">
                        <div class="card-header">
                            <h3>ğŸª Ø§Ù„ÙØ±ÙˆØ¹</h3>
                            <button class="btn btn-primary btn-sm" onclick="showBranchModal()">+ Ø¥Ø¶Ø§ÙØ© ÙØ±Ø¹</button>
                        </div>
                        <div class="card-body">
                            <div class="table-container">
                                <table>
                                    <thead>
                                        <tr><th>#</th><th>Ø§Ù„Ø§Ø³Ù…</th><th>Ø§Ù„Ù…ÙˆÙ‚Ø¹</th><th>Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©</th><th>Ø§Ù„Ù‡Ø§ØªÙ</th><th>Ø§Ù„Ø­Ø§Ù„Ø©</th><th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th></tr>
                                    </thead>
                                    <tbody id="branches-table"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Users Page -->
                <div class="page" id="page-users">
                    <div class="card">
                        <div class="card-header">
                            <h3>ğŸ‘¤ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</h3>
                            <button class="btn btn-primary btn-sm" onclick="showUserModal()">+ Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªØ®Ø¯Ù…</button>
                        </div>
                        <div class="card-body">
                            <div class="table-container">
                                <table>
                                    <thead>
                                        <tr><th>#</th><th>Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</th><th>Ø§Ù„Ø§Ø³Ù…</th><th>Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©</th><th>Ø§Ù„Ø­Ø§Ù„Ø©</th><th>Ø¢Ø®Ø± Ø¯Ø®ÙˆÙ„</th><th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th></tr>
                                    </thead>
                                    <tbody id="users-table"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-header"><h3>ğŸ“‹ Ø´Ø±Ø­ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª</h3></div>
                        <div class="card-body">
                            <div class="form-row">
                                <div class="setting-row">
                                    <div class="info">
                                        <h4>ğŸ‘‘ Ù…Ø¯ÙŠØ± (Admin)</h4>
                                        <p>Ø¬Ù…ÙŠØ¹ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª - Ø¥Ø¹Ø¯Ø§Ø¯Ø§ØªØŒ Ø­Ø°ÙØŒ Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</p>
                                    </div>
                                </div>
                                <div class="setting-row">
                                    <div class="info">
                                        <h4>ğŸ‘¤ Ù…Ø´Ø±Ù (Moderator)</h4>
                                        <p>Ø¹Ø±Ø¶ ÙˆØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†ØŒ Ø§Ù„Ø±ÙˆÙ„ÙŠØªØŒ Ø§Ù„Ø¬ÙˆØ§Ø¦Ø²</p>
                                    </div>
                                </div>
                                <div class="setting-row">
                                    <div class="info">
                                        <h4>ğŸª Ù…ÙˆØ¸Ù (Staff)</h4>
                                        <p>ØªØ³Ù„ÙŠÙ… Ø§Ù„Ø¬ÙˆØ§Ø¦Ø² ÙÙ‚Ø·</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 2FA Security Card -->
                    <div class="card">
                        <div class="card-header"><h3>ğŸ” Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø© Ø§Ù„Ø«Ù†Ø§Ø¦ÙŠØ© (2FA)</h3></div>
                        <div class="card-body">
                            <div id="2fa-status" class="setting-row" style="padding:20px;background:var(--tertiary);border-radius:12px;margin-bottom:15px;">
                                <div class="info">
                                    <h4 id="2fa-status-title">â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</h4>
                                    <p id="2fa-status-desc">ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±</p>
                                </div>
                                <div id="2fa-actions"></div>
                            </div>
                            <div id="2fa-setup" style="display:none;">
                                <div style="text-align:center;padding:20px;background:var(--bg-card);border-radius:12px;">
                                    <h4 style="margin-bottom:15px;">ğŸ“± Ø§Ù…Ø³Ø­ Ø§Ù„Ù€ QR Code</h4>
                                    <div id="2fa-qr" style="background:white;padding:20px;border-radius:12px;display:inline-block;margin-bottom:15px;"></div>
                                    <p style="color:var(--text-muted);font-size:0.9rem;margin-bottom:10px;">Ø£Ùˆ Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ù…Ø² ÙŠØ¯ÙˆÙŠØ§Ù‹:</p>
                                    <code id="2fa-secret" style="background:var(--tertiary);padding:10px 20px;border-radius:8px;font-size:1.1rem;letter-spacing:2px;"></code>
                                    <div style="margin-top:20px;">
                                        <input type="text" id="2fa-verify-code" class="form-control" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ù…ÙƒÙˆÙ† Ù…Ù† 6 Ø£Ø±Ù‚Ø§Ù…" maxlength="6" style="max-width:200px;margin:0 auto 10px;text-align:center;font-size:1.2rem;letter-spacing:5px;">
                                        <button class="btn btn-primary" onclick="verify2FA()">âœ… ØªÙØ¹ÙŠÙ„</button>
                                    </div>
                                </div>
                                <div style="margin-top:15px;padding:15px;background:rgba(255,193,7,0.1);border:1px solid var(--warning);border-radius:12px;">
                                    <h4 style="color:var(--warning);margin-bottom:10px;">âš ï¸ Ø£ÙƒÙˆØ§Ø¯ Ø§Ù„Ø§Ø³ØªØ±Ø¯Ø§Ø¯</h4>
                                    <p style="font-size:0.9rem;color:var(--text-muted);margin-bottom:10px;">Ø§Ø­ÙØ¸ Ù‡Ø°Ù‡ Ø§Ù„Ø£ÙƒÙˆØ§Ø¯ ÙÙŠ Ù…ÙƒØ§Ù† Ø¢Ù…Ù†. ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ø³ØªØ®Ø¯Ø§Ù…Ù‡Ø§ Ø¥Ø°Ø§ ÙÙ‚Ø¯Øª Ø§Ù„ÙˆØµÙˆÙ„ Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©.</p>
                                    <div id="backup-codes" style="display:flex;flex-wrap:wrap;gap:10px;"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Backup Card -->
                    <div class="card">
                        <div class="card-header">
                            <h3>ğŸ’¾ Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ</h3>
                            <button class="btn btn-primary btn-sm" onclick="createBackup()">+ Ù†Ø³Ø®Ø© Ø¬Ø¯ÙŠØ¯Ø©</button>
                        </div>
                        <div class="card-body">
                            <div class="form-row" style="gap:15px;margin-bottom:20px;">
                                <div class="stat-card" style="flex:1;background:var(--tertiary);padding:15px;border-radius:12px;text-align:center;">
                                    <div class="icon" style="font-size:2rem;margin-bottom:5px;">ğŸ“¦</div>
                                    <div class="value" id="backup-count">0</div>
                                    <div class="label" style="font-size:0.85rem;color:var(--text-muted);">Ù†Ø³Ø® Ù…Ø­ÙÙˆØ¸Ø©</div>
                                </div>
                                <div class="stat-card" style="flex:1;background:var(--tertiary);padding:15px;border-radius:12px;text-align:center;">
                                    <div class="icon" style="font-size:2rem;margin-bottom:5px;">ğŸ“…</div>
                                    <div class="value" id="last-backup">-</div>
                                    <div class="label" style="font-size:0.85rem;color:var(--text-muted);">Ø¢Ø®Ø± Ù†Ø³Ø®Ø©</div>
                                </div>
                            </div>
                            <div class="table-container">
                                <table>
                                    <thead>
                                        <tr><th>#</th><th>Ø§Ø³Ù… Ø§Ù„Ù…Ù„Ù</th><th>Ø§Ù„Ø­Ø¬Ù…</th><th>Ø§Ù„Ù†ÙˆØ¹</th><th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th><th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th></tr>
                                    </thead>
                                    <tbody id="backup-table"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Security Logs Card -->
                    <div class="card">
                        <div class="card-header"><h3>ğŸ›¡ï¸ Ø³Ø¬Ù„ Ø§Ù„Ø£Ù…Ø§Ù†</h3></div>
                        <div class="card-body">
                            <div class="table-container" style="max-height:300px;overflow-y:auto;">
                                <table>
                                    <thead>
                                        <tr><th>Ø§Ù„Ø­Ø¯Ø«</th><th>Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</th><th>IP</th><th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th></tr>
                                    </thead>
                                    <tbody id="security-logs-table"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Coupons Page -->
                <div class="page" id="page-coupons">
                    <div class="card">
                        <div class="card-header">
                            <h3>ğŸ« Ø§Ù„ÙƒÙˆØ¨ÙˆÙ†Ø§Øª</h3>
                            <button class="btn btn-primary btn-sm" onclick="showCouponModal()">+ ÙƒÙˆØ¨ÙˆÙ† Ø¬Ø¯ÙŠØ¯</button>
                        </div>
                        <div class="card-body">
                            <div id="coupons-cards" class="form-row" style="margin-bottom:25px;flex-wrap:wrap;gap:15px;"></div>
                            <div class="table-container">
                                <table>
                                    <thead>
                                        <tr><th>#</th><th>Ø§Ù„ÙƒÙˆØ¯</th><th>Ø§Ù„Ù†Ù‚Ø§Ø·</th><th>Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…Ø§Øª</th><th>Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰</th><th>ØµØ§Ù„Ø­ Ø­ØªÙ‰</th><th>Ø§Ù„Ø­Ø§Ù„Ø©</th><th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th></tr>
                                    </thead>
                                    <tbody id="coupons-table"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Referrals Page -->
                <div class="page" id="page-referrals">
                    <div class="stats-grid" style="margin-bottom:20px;">
                        <div class="stat-card">
                            <div class="icon" style="background:linear-gradient(135deg,#6f42c1,#9b59b6);">ğŸ‘¥</div>
                            <div class="value" id="ref-total">0</div>
                            <div class="label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥Ø­Ø§Ù„Ø§Øª</div>
                        </div>
                        <div class="stat-card">
                            <div class="icon" style="background:linear-gradient(135deg,var(--success),#00b894);">âœ…</div>
                            <div class="value" id="ref-completed">0</div>
                            <div class="label">Ø¥Ø­Ø§Ù„Ø§Øª Ù†Ø§Ø¬Ø­Ø©</div>
                        </div>
                        <div class="stat-card">
                            <div class="icon" style="background:linear-gradient(135deg,var(--gold),#f39c12);">ğŸ</div>
                            <div class="value" id="ref-bonus">0</div>
                            <div class="label">Ù†Ù‚Ø§Ø· Ù…ÙˆØ²Ø¹Ø©</div>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <h3>ğŸ‘¥ Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø­Ø§Ù„Ø§Øª</h3>
                            <button class="btn btn-secondary btn-sm" onclick="loadReferrals()">ğŸ”„ ØªØ­Ø¯ÙŠØ«</button>
                        </div>
                        <div class="card-body">
                            <div class="setting-row" style="margin-bottom:20px;padding:15px;background:var(--tertiary);border-radius:10px;">
                                <div class="info">
                                    <h4>âš™ï¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¥Ø­Ø§Ù„Ø©</h4>
                                    <p>ØªØ­Ø¯ÙŠØ¯ Ù†Ù‚Ø§Ø· Ø§Ù„Ù…ÙƒØ§ÙØ£Ø© Ù„Ù„Ù…ÙØ­ÙŠÙ„ ÙˆØ§Ù„Ù…ÙØ­Ø§Ù„</p>
                                </div>
                            </div>
                            <div class="form-row" style="margin-bottom:20px;">
                                <div class="form-group">
                                    <label>Ù†Ù‚Ø§Ø· Ø§Ù„Ù…ÙØ­ÙŠÙ„ (ØµØ§Ø­Ø¨ Ø§Ù„ÙƒÙˆØ¯)</label>
                                    <input type="number" class="form-control" id="ref-referrer-bonus" value="100" min="0">
                                </div>
                                <div class="form-group">
                                    <label>Ù†Ù‚Ø§Ø· Ø§Ù„Ù…ÙØ­Ø§Ù„ (Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯)</label>
                                    <input type="number" class="form-control" id="ref-referred-bonus" value="50" min="0">
                                </div>
                                <div class="form-group" style="display:flex;align-items:flex-end;">
                                    <button class="btn btn-primary" onclick="saveReferralSettings()">ğŸ’¾ Ø­ÙØ¸</button>
                                </div>
                            </div>
                            <h4 style="margin-bottom:15px;">ğŸ“Š Ø³Ø¬Ù„ Ø§Ù„Ø¥Ø­Ø§Ù„Ø§Øª</h4>
                            <div class="table-container">
                                <table>
                                    <thead>
                                        <tr><th>#</th><th>Ø§Ù„Ù…ÙØ­ÙŠÙ„</th><th>Ø§Ù„Ù…ÙØ­Ø§Ù„</th><th>Ù†Ù‚Ø§Ø· Ø§Ù„Ù…ÙØ­ÙŠÙ„</th><th>Ù†Ù‚Ø§Ø· Ø§Ù„Ù…ÙØ­Ø§Ù„</th><th>Ø§Ù„Ø­Ø§Ù„Ø©</th><th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th></tr>
                                    </thead>
                                    <tbody id="referrals-table"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- WhatsApp Settings Page -->
                <div class="page" id="page-whatsapp">
                    <div class="card">
                        <div class="card-header">
                            <h3>ğŸ“± Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª WhatsApp</h3>
                        </div>
                        <div class="card-body">
                            <div class="setting-row" style="margin-bottom:20px;padding:15px;background:linear-gradient(135deg,rgba(37,211,102,0.1),rgba(37,211,102,0.05));border:1px solid rgba(37,211,102,0.3);border-radius:10px;">
                                <div class="info">
                                    <h4 style="color:#25D366;">ğŸ’¬ ØªÙƒØ§Ù…Ù„ WhatsApp API</h4>
                                    <p>Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ø¦Ù„ ØªÙ„Ù‚Ø§Ø¦ÙŠØ© Ù„Ù„ÙØ§Ø¦Ø²ÙŠÙ† Ø¹Ø¨Ø± WhatsApp</p>
                                </div>
                            </div>
                            <div class="form-group">
                                <label>Ø±Ø§Ø¨Ø· API (Ù…Ø«Ø§Ù„: UltraMsg, Twilio)</label>
                                <input type="url" class="form-control" id="wa-api-url" placeholder="https://api.ultramsg.com/instance/messages/chat">
                            </div>
                            <div class="form-group">
                                <label>Ù…ÙØªØ§Ø­ API</label>
                                <input type="password" class="form-control" id="wa-api-key" placeholder="API Key">
                            </div>
                            <div class="form-group">
                                <label>Ù‚Ø§Ù„Ø¨ Ø±Ø³Ø§Ù„Ø© Ø§Ù„ÙØ§Ø¦Ø²</label>
                                <textarea class="form-control" id="wa-winner-template" rows="5" placeholder="ğŸ‰ Ù…Ø¨Ø±ÙˆÙƒ {name}!

Ù„Ù‚Ø¯ ÙØ²Øª ÙÙŠ Ù…Ø³Ø§Ø¨Ù‚Ø© Ø±ÙŠØ¯ Ø³ØªØ±ÙˆÙ†Ùƒ!

ÙƒÙˆØ¯ Ø§Ù„Ø¬Ø§Ø¦Ø²Ø©: {prize_code}
Ø§Ù„Ù†Ù‚Ø§Ø·: {score}

ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªÙˆØ¬Ù‡ Ù„Ø£Ù‚Ø±Ø¨ ÙØ±Ø¹ Ù„Ø§Ø³ØªÙ„Ø§Ù… Ø¬Ø§Ø¦Ø²ØªÙƒ."></textarea>
                                <small style="color:var(--text-muted);">Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª: {name}, {prize_code}, {score}</small>
                            </div>
                            <button class="btn btn-primary" onclick="saveWhatsAppSettings()">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
                            
                            <div style="margin-top:30px;padding-top:20px;border-top:1px solid rgba(255,255,255,0.1);">
                                <h4 style="margin-bottom:15px;">ğŸ“¤ Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© ÙŠØ¯ÙˆÙŠØ©</h4>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label>
                                        <input type="tel" class="form-control" id="wa-test-phone" placeholder="07XX XXX XXXX">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label>Ø§Ù„Ø±Ø³Ø§Ù„Ø©</label>
                                    <textarea class="form-control" id="wa-test-message" rows="3" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ Ù‡Ù†Ø§..."></textarea>
                                </div>
                                <button class="btn btn-success" onclick="sendTestWhatsApp()">ğŸ“± Ø¥Ø±Ø³Ø§Ù„</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Chat Management Page -->
                <div class="page" id="page-chat">
                    <div class="card">
                        <div class="card-header">
                            <h3>ğŸ’¬ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¯Ø±Ø¯Ø´Ø©</h3>
                        </div>
                        <div class="card-body">
                            <!-- Toggle Chat -->
                            <div class="setting-row" style="margin-bottom:25px;padding:20px;background:linear-gradient(135deg,rgba(102,126,234,0.1),rgba(118,75,162,0.1));border-radius:15px;">
                                <div class="info">
                                    <h4 style="color:#667eea;">ğŸ’¬ Ø¯Ø±Ø¯Ø´Ø© Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†</h4>
                                    <p>Ø§Ù„Ø³Ù…Ø§Ø­ Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø¨Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø¨Ø¹Ø¶Ù‡Ù… Ø¯Ø§Ø®Ù„ Ø§Ù„Ù„Ø¹Ø¨Ø©</p>
                                </div>
                                <label class="switch">
                                    <input type="checkbox" id="chat-enabled-toggle" onchange="ChatAdmin.toggle(this.checked)">
                                    <span class="slider"></span>
                                </label>
                            </div>
                            
                            <!-- Stats -->
                            <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:15px;margin-bottom:25px;">
                                <div style="background:linear-gradient(135deg,#667eea,#764ba2);padding:20px;border-radius:12px;text-align:center;color:white;">
                                    <div style="font-size:28px;font-weight:700;" id="chat-total-msg">0</div>
                                    <div style="font-size:13px;opacity:0.9;">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„</div>
                                </div>
                                <div style="background:linear-gradient(135deg,#f093fb,#f5576c);padding:20px;border-radius:12px;text-align:center;color:white;">
                                    <div style="font-size:28px;font-weight:700;" id="chat-banned-count">0</div>
                                    <div style="font-size:13px;opacity:0.9;">Ù…Ø­Ø¸ÙˆØ±ÙŠÙ†</div>
                                </div>
                            </div>
                            
                            <!-- Tabs -->
                            <div style="display:flex;gap:10px;margin-bottom:20px;flex-wrap:wrap;">
                                <button class="btn btn-primary" onclick="ChatAdmin.showTab('messages')" id="chat-tab-msg">ğŸ“ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„</button>
                                <button class="btn btn-secondary" onclick="ChatAdmin.showTab('banned')" id="chat-tab-ban">ğŸš« Ø§Ù„Ù…Ø­Ø¸ÙˆØ±ÙŠÙ†</button>
                                <button class="btn btn-secondary" onclick="ChatAdmin.showTab('words')" id="chat-tab-words">ğŸ”¤ ÙƒÙ„Ù…Ø§Øª Ù…Ø­Ø¸ÙˆØ±Ø©</button>
                            </div>
                            
                            <!-- Messages Tab -->
                            <div id="chat-section-messages">
                                <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:15px;flex-wrap:wrap;gap:10px;">
                                    <h4 style="margin:0;">Ø¢Ø®Ø± Ø§Ù„Ø±Ø³Ø§Ø¦Ù„</h4>
                                    <button class="btn btn-danger btn-sm" onclick="ChatAdmin.cleanup()">ğŸ—‘ï¸ ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©</button>
                                </div>
                                <div style="overflow-x:auto;">
                                    <table class="table">
                                        <thead>
                                            <tr><th>Ø§Ù„Ù„Ø§Ø¹Ø¨</th><th>Ø§Ù„Ù‡Ø§ØªÙ</th><th>Ø§Ù„Ø±Ø³Ø§Ù„Ø©</th><th>Ø§Ù„ÙˆÙ‚Øª</th><th>Ø¥Ø¬Ø±Ø§Ø¡</th></tr>
                                        </thead>
                                        <tbody id="chat-messages-body">
                                            <tr><td colspan="5" style="text-align:center;">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</td></tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            
                            <!-- Banned Tab -->
                            <div id="chat-section-banned" style="display:none;">
                                <h4>Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù…Ø­Ø¸ÙˆØ±ÙŠÙ†</h4>
                                <div id="chat-banned-list" style="margin-bottom:20px;">
                                    <p style="color:var(--text-muted);text-align:center;">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø­Ø¸ÙˆØ±ÙŠÙ†</p>
                                </div>
                                <h4 style="margin-top:20px;">Ø­Ø¸Ø± Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯</h4>
                                <div style="display:flex;gap:10px;flex-wrap:wrap;">
                                    <input type="text" class="form-control" id="ban-phone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ" style="flex:1;min-width:120px;">
                                    <input type="text" class="form-control" id="ban-reason" placeholder="Ø§Ù„Ø³Ø¨Ø¨" style="flex:2;min-width:150px;">
                                    <select class="form-control" id="ban-duration" style="width:100px;">
                                        <option value="1">Ø³Ø§Ø¹Ø©</option>
                                        <option value="24">ÙŠÙˆÙ…</option>
                                        <option value="168">Ø£Ø³Ø¨ÙˆØ¹</option>
                                        <option value="permanent">Ø¯Ø§Ø¦Ù…</option>
                                    </select>
                                    <button class="btn btn-danger" onclick="ChatAdmin.ban()">Ø­Ø¸Ø±</button>
                                </div>
                            </div>
                            
                            <!-- Bad Words Tab -->
                            <div id="chat-section-words" style="display:none;">
                                <h4>Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…Ø­Ø¸ÙˆØ±Ø©</h4>
                                <p style="color:var(--text-muted);font-size:13px;">Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„ØªÙŠ Ø³ÙŠØªÙ… Ø­Ø¸Ø±Ù‡Ø§ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹</p>
                                <div id="chat-bad-words" style="display:flex;flex-wrap:wrap;gap:8px;margin:15px 0;"></div>
                                <div style="display:flex;gap:10px;">
                                    <input type="text" class="form-control" id="new-bad-word" placeholder="Ø£Ø¶Ù ÙƒÙ„Ù…Ø©..." style="flex:1;">
                                    <button class="btn btn-danger" onclick="ChatAdmin.addWord()">Ø¥Ø¶Ø§ÙØ©</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Settings Pages -->
                <div class="page" id="page-settings-game">
                    <div class="card">
                        <div class="card-header"><h3>ğŸ® Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù„Ø¹Ø¨Ø©</h3></div>
                        <div class="card-body">
                            <div class="setting-row">
                                <div class="info">
                                    <h4>Ø­Ø§Ù„Ø© Ø§Ù„Ù„Ø¹Ø¨Ø©</h4>
                                    <p>ØªÙØ¹ÙŠÙ„ Ø£Ùˆ Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù„Ø¹Ø¨Ø© Ø¨Ø§Ù„ÙƒØ§Ù…Ù„</p>
                                </div>
                                <label class="switch">
                                    <input type="checkbox" id="set-game-enabled" onchange="saveSetting('game_enabled', this.checked)">
                                    <span class="slider"></span>
                                </label>
                            </div>
                            <div class="setting-row">
                                <div class="info">
                                    <h4>Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¬ØºØ±Ø§ÙÙŠ Ø¥Ø¬Ø¨Ø§Ø±ÙŠ</h4>
                                    <p>Ø·Ù„Ø¨ ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ù…Ù† Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†</p>
                                </div>
                                <label class="switch">
                                    <input type="checkbox" id="set-require-location" onchange="saveSetting('require_location', this.checked)">
                                    <span class="slider"></span>
                                </label>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Ø¹Ø¯Ø¯ Ø§Ù„Ø¬ÙˆÙ„Ø§Øª</label>
                                    <input type="number" class="form-control" id="set-max-rounds" value="3" min="1" max="10">
                                </div>
                                <div class="form-group">
                                    <label>ÙØªØ±Ø© Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± (Ø¯Ù‚ÙŠÙ‚Ø©)</label>
                                    <input type="number" class="form-control" id="set-cooldown" value="30" min="0">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>ØµØ¹ÙˆØ¨Ø© Ø§Ù„Ø¬ÙˆÙ„Ø© 1 (%)</label>
                                    <input type="number" class="form-control" id="set-diff-1" value="0" min="0" max="100">
                                </div>
                                <div class="form-group">
                                    <label>ØµØ¹ÙˆØ¨Ø© Ø§Ù„Ø¬ÙˆÙ„Ø© 2 (%)</label>
                                    <input type="number" class="form-control" id="set-diff-2" value="20" min="0" max="100">
                                </div>
                                <div class="form-group">
                                    <label>ØµØ¹ÙˆØ¨Ø© Ø§Ù„Ø¬ÙˆÙ„Ø© 3 (%)</label>
                                    <input type="number" class="form-control" id="set-diff-3" value="40" min="0" max="100">
                                </div>
                            </div>
                            <button class="btn btn-primary" onclick="saveGameSettings()">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
                        </div>
                    </div>
                </div>

                <div class="page" id="page-settings-points">
                    <div class="card">
                        <div class="card-header"><h3>ğŸ¯ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ù‚Ø§Ø·</h3></div>
                        <div class="card-body">
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ Ù„Ù„Ø±ÙˆÙ„ÙŠØª</label>
                                    <input type="number" class="form-control" id="set-min-roulette" value="1500" min="0">
                                </div>
                                <div class="form-group">
                                    <label>Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù„Ù„ÙØ§Ø¦Ø²ÙŠÙ†</label>
                                    <input type="number" class="form-control" id="set-max-winners" value="5" min="1">
                                </div>
                            </div>
                            <button class="btn btn-primary" onclick="savePointsSettings()">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
                        </div>
                    </div>
                </div>

                <div class="page" id="page-settings-brand">
                    <div class="card">
                        <div class="card-header"><h3>ğŸ¨ Ù‡ÙˆÙŠØ© Ø§Ù„Ù…ÙˆÙ‚Ø¹</h3></div>
                        <div class="card-body">
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Ø§Ø³Ù… Ø§Ù„Ù…ÙˆÙ‚Ø¹ (Ø¨Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ)</label>
                                    <input type="text" class="form-control" id="set-site-name" placeholder="Red Strong">
                                </div>
                                <div class="form-group">
                                    <label>Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ØµÙØ­Ø©</label>
                                    <input type="text" class="form-control" id="set-site-title" placeholder="Ø±ÙŠØ¯ Ø³ØªØ±ÙˆÙ†Ùƒ - Ø§Ù„Ø¹Ø¨ ÙˆØ§Ø±Ø¨Ø­">
                                </div>
                            </div>
                            <div class="form-group">
                                <label>Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙØ±Ø¹ÙŠ</label>
                                <input type="text" class="form-control" id="set-site-subtitle" placeholder="Ø§Ù„Ø¹Ø¨ ØªØªØ±ÙŠØ³ ÙˆØ§Ø±Ø¨Ø­ Ø¬ÙˆØ§Ø¦Ø² Ù‚ÙŠÙ…Ø©!">
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Ø­Ø±ÙˆÙ Ø§Ù„Ù„ÙˆØºÙˆ</label>
                                    <input type="text" class="form-control" id="set-logo-letters" placeholder="RS" maxlength="3">
                                </div>
                                <div class="form-group">
                                    <label>Ø§Ø³Ù… Ø§Ù„Ø´Ø±ÙƒØ© (Ø§Ù„ÙÙˆØªØ±)</label>
                                    <input type="text" class="form-control" id="set-footer-company" placeholder="Red Strong">
                                </div>
                            </div>
                            <div class="form-group">
                                <label>ØµÙˆØ±Ø© Ø§Ù„Ù„ÙˆØºÙˆ</label>
                                <input type="file" class="form-control" id="logo-upload" accept="image/*" onchange="uploadLogo(this)">
                                <img id="logo-preview" style="max-height:100px;margin-top:10px;display:none;border-radius:10px;">
                            </div>
                            <h4 style="margin:25px 0 15px;">ğŸŒˆ Ø§Ù„Ø£Ù„ÙˆØ§Ù†</h4>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ</label>
                                    <input type="color" class="form-control" id="set-primary-color" value="#e31e24" style="height:50px;">
                                </div>
                                <div class="form-group">
                                    <label>Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ</label>
                                    <input type="color" class="form-control" id="set-secondary-color" value="#1a237e" style="height:50px;">
                                </div>
                                <div class="form-group">
                                    <label>Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø°Ù‡Ø¨ÙŠ</label>
                                    <input type="color" class="form-control" id="set-gold-color" value="#ffd700" style="height:50px;">
                                </div>
                            </div>
                            <button class="btn btn-primary" onclick="saveBrandSettings()">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
                        </div>
                    </div>
                </div>

                <div class="page" id="page-settings-social">
                    <div class="card">
                        <div class="card-header"><h3>ğŸ“± Ø§Ù„Ø³ÙˆØ´ÙŠØ§Ù„ Ù…ÙŠØ¯ÙŠØ§</h3></div>
                        <div class="card-body">
                            <div class="setting-row">
                                <div class="info">
                                    <h4>Ø¥Ø¸Ù‡Ø§Ø± Ø±ÙˆØ§Ø¨Ø· Ø§Ù„Ø³ÙˆØ´ÙŠØ§Ù„</h4>
                                    <p>Ø¹Ø±Ø¶ Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª Ø§Ù„ØªÙˆØ§ØµÙ„ Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠ</p>
                                </div>
                                <label class="switch">
                                    <input type="checkbox" id="set-show-social" onchange="saveSetting('show_social', this.checked)">
                                    <span class="slider"></span>
                                </label>
                            </div>
                            <div class="form-group">
                                <label>ğŸ“˜ Ø±Ø§Ø¨Ø· ÙÙŠØ³Ø¨ÙˆÙƒ</label>
                                <input type="url" class="form-control" id="set-facebook" placeholder="https://facebook.com/...">
                            </div>
                            <div class="form-group">
                                <label>ğŸ“¸ Ø±Ø§Ø¨Ø· Ø§Ù†Ø³ØªØºØ±Ø§Ù…</label>
                                <input type="url" class="form-control" id="set-instagram" placeholder="https://instagram.com/...">
                            </div>
                            <div class="form-group">
                                <label>ğŸ“± Ø±Ù‚Ù… ÙˆØ§ØªØ³Ø§Ø¨ (Ù…Ø¹ Ø±Ù…Ø² Ø§Ù„Ø¯ÙˆÙ„Ø©)</label>
                                <input type="tel" class="form-control" id="set-whatsapp" placeholder="9647701234567">
                            </div>
                            <div class="form-group">
                                <label>ğŸµ Ø±Ø§Ø¨Ø· ØªÙŠÙƒ ØªÙˆÙƒ</label>
                                <input type="url" class="form-control" id="set-tiktok" placeholder="https://tiktok.com/@...">
                            </div>
                            <button class="btn btn-primary" onclick="saveSocialSettings()">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
                        </div>
                    </div>
                </div>

                <div class="page" id="page-settings-contact">
                    <div class="card">
                        <div class="card-header"><h3>ğŸ“ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªÙˆØ§ØµÙ„</h3></div>
                        <div class="card-body">
                            <div class="setting-row">
                                <div class="info">
                                    <h4>Ø¥Ø¸Ù‡Ø§Ø± Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªÙˆØ§ØµÙ„</h4>
                                    <p>Ø¹Ø±Ø¶ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ ÙˆØ§Ù„Ø¥ÙŠÙ…ÙŠÙ„</p>
                                </div>
                                <label class="switch">
                                    <input type="checkbox" id="set-show-contact" onchange="saveSetting('show_contact', this.checked)">
                                    <span class="slider"></span>
                                </label>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label>
                                    <input type="tel" class="form-control" id="set-contact-phone" placeholder="07XX XXX XXXX">
                                </div>
                                <div class="form-group">
                                    <label>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
                                    <input type="email" class="form-control" id="set-contact-email" placeholder="info@example.com">
                                </div>
                            </div>
                            <div class="form-group">
                                <label>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</label>
                                <input type="text" class="form-control" id="set-contact-address" placeholder="Ø¨ØºØ¯Ø§Ø¯ØŒ Ø§Ù„Ø¹Ø±Ø§Ù‚">
                            </div>
                            <button class="btn btn-primary" onclick="saveContactSettings()">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
                        </div>
                    </div>
                </div>

                <div class="page" id="page-settings-contest">
                    <div class="card">
                        <div class="card-header"><h3>ğŸ“… Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©</h3></div>
                        <div class="card-body">
                            <div id="contest-status-banner" class="setting-row" style="margin-bottom:20px;padding:15px;border-radius:10px;">
                                <!-- Will be populated by JS -->
                            </div>
                            <div class="form-group">
                                <label>Ø§Ø³Ù… Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©</label>
                                <input type="text" class="form-control" id="set-contest-name" placeholder="Ù…Ø«Ø§Ù„: Ù…Ø³Ø§Ø¨Ù‚Ø© Ø±Ø£Ø³ Ø§Ù„Ø³Ù†Ø©">
                            </div>
                            <div class="form-group">
                                <label>ÙˆØµÙ Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©</label>
                                <textarea class="form-control" id="set-description" rows="3" placeholder="ÙˆØµÙ Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø© ÙˆØ§Ù„Ø¬ÙˆØ§Ø¦Ø²..."></textarea>
                            </div>
                            <div class="setting-row">
                                <div class="info">
                                    <h4>Ø¹Ø±Ø¶ Ø§Ù„Ø¹Ø¯ Ø§Ù„ØªÙ†Ø§Ø²Ù„ÙŠ</h4>
                                    <p>Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ Ù„Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©</p>
                                </div>
                                <label class="switch">
                                    <input type="checkbox" id="set-show-countdown" onchange="saveSetting('show_countdown', this.checked)">
                                    <span class="slider"></span>
                                </label>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>ØªØ§Ø±ÙŠØ® Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©</label>
                                    <input type="datetime-local" class="form-control" id="set-start-date">
                                </div>
                                <div class="form-group">
                                    <label>ØªØ§Ø±ÙŠØ® Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©</label>
                                    <input type="datetime-local" class="form-control" id="set-end-date">
                                </div>
                            </div>
                            <button class="btn btn-primary" onclick="saveContestSettings()">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <h3>ğŸ° Ø¬Ø¯ÙˆÙ„Ø© Ø§Ù„Ø³Ø­ÙˆØ¨Ø§Øª Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØ©</h3>
                        </div>
                        <div class="card-body">
                            <div class="setting-row" style="margin-bottom:20px;padding:15px;background:var(--tertiary);border-radius:10px;">
                                <div class="info">
                                    <h4>â° Ø§Ù„Ø³Ø­Ø¨ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ</h4>
                                    <p>Ø³Ø­Ø¨ ÙØ§Ø¦Ø² ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ ÙÙŠ Ø£ÙˆÙ‚Ø§Øª Ù…Ø­Ø¯Ø¯Ø©</p>
                                </div>
                                <label class="switch">
                                    <input type="checkbox" id="set-auto-draw" onchange="saveSetting('auto_draw_enabled', this.checked)">
                                    <span class="slider"></span>
                                </label>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Ù†ÙˆØ¹ Ø§Ù„ØªÙƒØ±Ø§Ø±</label>
                                    <select class="form-control" id="set-draw-frequency">
                                        <option value="daily">ÙŠÙˆÙ…ÙŠØ§Ù‹</option>
                                        <option value="weekly">Ø£Ø³Ø¨ÙˆØ¹ÙŠØ§Ù‹</option>
                                        <option value="end">Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø© ÙÙ‚Ø·</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>ÙˆÙ‚Øª Ø§Ù„Ø³Ø­Ø¨</label>
                                    <input type="time" class="form-control" id="set-draw-time" value="21:00">
                                </div>
                                <div class="form-group">
                                    <label>Ø¹Ø¯Ø¯ Ø§Ù„ÙØ§Ø¦Ø²ÙŠÙ† Ù„ÙƒÙ„ Ø³Ø­Ø¨</label>
                                    <input type="number" class="form-control" id="set-draw-winners" value="1" min="1" max="10">
                                </div>
                            </div>
                            <button class="btn btn-primary" onclick="saveDrawSettings()">ğŸ’¾ Ø­ÙØ¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø³Ø­Ø¨</button>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <h3>ğŸ“‹ Ø§Ù„Ø³Ø­ÙˆØ¨Ø§Øª Ø§Ù„Ù…Ø¬Ø¯ÙˆÙ„Ø©</h3>
                            <button class="btn btn-sm btn-primary" onclick="scheduleNewDraw()">+ Ø¬Ø¯ÙˆÙ„Ø© Ø³Ø­Ø¨</button>
                        </div>
                        <div class="card-body">
                            <div class="table-container">
                                <table>
                                    <thead>
                                        <tr>
                                            <th>#</th>
                                            <th>Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„ÙˆÙ‚Øª</th>
                                            <th>Ø¹Ø¯Ø¯ Ø§Ù„ÙØ§Ø¦Ø²ÙŠÙ†</th>
                                            <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                                            <th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                                        </tr>
                                    </thead>
                                    <tbody id="scheduled-draws-table"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Daily Goals Settings -->
                <div class="page" id="page-settings-goals">
                    <div class="card">
                        <div class="card-header">
                            <h3>ğŸ¯ Ø§Ù„Ø£Ù‡Ø¯Ø§Ù Ø§Ù„ÙŠÙˆÙ…ÙŠØ©</h3>
                        </div>
                        <div class="card-body">
                            <div class="setting-row" style="margin-bottom:20px;padding:15px;background:linear-gradient(135deg,rgba(255,215,0,0.1),rgba(255,215,0,0.05));border:1px solid rgba(255,215,0,0.3);border-radius:10px;">
                                <div class="info">
                                    <h4 style="color:var(--gold);">â­ Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ù‡Ù…Ø§Øª Ø§Ù„ÙŠÙˆÙ…ÙŠØ©</h4>
                                    <p>Ø´Ø¬Ø¹ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø¹Ù„Ù‰ Ø§Ù„Ù„Ø¹Ø¨ ÙŠÙˆÙ…ÙŠØ§Ù‹ Ù…Ù† Ø®Ù„Ø§Ù„ Ø£Ù‡Ø¯Ø§Ù ÙˆÙ…ÙƒØ§ÙØ¢Øª</p>
                                </div>
                                <label class="switch">
                                    <input type="checkbox" id="set-goals-enabled" onchange="saveSetting('daily_goals_enabled', this.checked)">
                                    <span class="slider"></span>
                                </label>
                            </div>
                            
                            <h4 style="margin-bottom:15px;">ğŸ“‹ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ù‡Ø¯Ø§Ù</h4>
                            <div id="goals-list">
                                <!-- Goals will be loaded here -->
                            </div>
                            
                            <button class="btn btn-primary" style="margin-top:20px;" onclick="showGoalModal()">+ Ø¥Ø¶Ø§ÙØ© Ù‡Ø¯Ù Ø¬Ø¯ÙŠØ¯</button>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <h3>ğŸ“Š Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø£Ù‡Ø¯Ø§Ù</h3>
                        </div>
                        <div class="card-body">
                            <div class="stats-grid" style="grid-template-columns: repeat(3, 1fr);">
                                <div class="stat-card">
                                    <div class="icon" style="background:linear-gradient(135deg,var(--success),#00b894);">âœ…</div>
                                    <div class="value" id="goals-completed-today">0</div>
                                    <div class="label">Ø£Ù‡Ø¯Ø§Ù Ù…ÙƒØªÙ…Ù„Ø© Ø§Ù„ÙŠÙˆÙ…</div>
                                </div>
                                <div class="stat-card">
                                    <div class="icon" style="background:linear-gradient(135deg,var(--gold),#f39c12);">ğŸ</div>
                                    <div class="value" id="goals-rewards-today">0</div>
                                    <div class="label">Ù†Ù‚Ø§Ø· Ù…ÙˆØ²Ø¹Ø© Ø§Ù„ÙŠÙˆÙ…</div>
                                </div>
                                <div class="stat-card">
                                    <div class="icon" style="background:linear-gradient(135deg,var(--info),#3498db);">ğŸ‘¥</div>
                                    <div class="value" id="goals-players-today">0</div>
                                    <div class="label">Ù„Ø§Ø¹Ø¨ÙŠÙ† Ù†Ø´Ø·ÙŠÙ†</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="page" id="page-settings-display">
                    <div class="card">
                        <div class="card-header"><h3>ğŸ‘ï¸ Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø¹Ø±Ø¶</h3></div>
                        <div class="card-body">
                            <div class="setting-row">
                                <div class="info">
                                    <h4>Ø¥Ø¸Ù‡Ø§Ø± Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ÙŠØ²Ø§Øª</h4>
                                    <p>Ø¹Ø±Ø¶ Ù…Ù…ÙŠØ²Ø§Øª Ø§Ù„Ù„Ø¹Ø¨Ø© ÙÙŠ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</p>
                                </div>
                                <label class="switch">
                                    <input type="checkbox" id="set-show-features" onchange="saveSetting('show_features', this.checked)">
                                    <span class="slider"></span>
                                </label>
                            </div>
                            <div class="setting-row">
                                <div class="info">
                                    <h4>Ø¥Ø¸Ù‡Ø§Ø± Ù„ÙˆØ­Ø© Ø§Ù„Ù…ØªØµØ¯Ø±ÙŠÙ†</h4>
                                    <p>Ø¹Ø±Ø¶ Ø£ÙØ¶Ù„ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†</p>
                                </div>
                                <label class="switch">
                                    <input type="checkbox" id="set-show-leaderboard" onchange="saveSetting('show_leaderboard', this.checked)">
                                    <span class="slider"></span>
                                </label>
                            </div>
                            <div class="setting-row">
                                <div class="info">
                                    <h4>Ø¥Ø¸Ù‡Ø§Ø± Ø¹Ø¯Ø¯ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†</h4>
                                    <p>Ø¹Ø±Ø¶ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø´ØªØ±ÙƒÙŠÙ†</p>
                                </div>
                                <label class="switch">
                                    <input type="checkbox" id="set-show-players-count" onchange="saveSetting('show_players_count', this.checked)">
                                    <span class="slider"></span>
                                </label>
                            </div>
                            <div class="setting-row">
                                <div class="info">
                                    <h4>Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²Ø§Øª</h4>
                                    <p>Ø¹Ø±Ø¶ Ø´Ø§Ø±Ø§Øª Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²Ø§Øª</p>
                                </div>
                                <label class="switch">
                                    <input type="checkbox" id="set-show-achievements" onchange="saveSetting('show_achievements', this.checked)">
                                    <span class="slider"></span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="page" id="page-settings-provinces">
                    <div class="card">
                        <div class="card-header"><h3>ğŸš« Ø­Ø¸Ø± Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø§Øª</h3></div>
                        <div class="card-body">
                            <p style="color:var(--text-muted);margin-bottom:20px;">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø§Øª Ø§Ù„ØªÙŠ ØªØ±ÙŠØ¯ Ù…Ù†Ø¹ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ù…Ù†Ù‡Ø§:</p>
                            <div class="checkbox-grid" id="provinces-checkboxes"></div>
                            <button class="btn btn-primary" style="margin-top:20px;" onclick="saveBlockedProvinces()">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
                        </div>
                    </div>
                </div>

                <div class="page" id="page-settings-danger">
                    <div class="danger-zone">
                        <h4>âš ï¸ Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø®Ø·Ø±</h4>
                        <p style="color:var(--text-muted);margin-bottom:20px;">Ù‡Ø°Ù‡ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡Ø§!</p>
                        <div class="form-row">
                            <button class="btn btn-danger" onclick="confirmResetWinners()">ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„ÙØ§Ø¦Ø²ÙŠÙ†</button>
                            <button class="btn btn-danger" onclick="confirmResetAll()">ğŸ—‘ï¸ Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†</button>
                            <button class="btn btn-danger" onclick="confirmResetScores()">ğŸ“Š Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù†Ù‚Ø§Ø·</button>
                        </div>
                    </div>
                </div>

                <!-- Analytics Page -->
                <div class="page" id="page-analytics">
                    <div class="stats-grid" style="margin-bottom:20px;">
                        <div class="stat-card">
                            <div class="icon" style="background:linear-gradient(135deg,#6f42c1,#9b59b6);">ğŸ“±</div>
                            <div class="value" id="analytics-mobile">0%</div>
                            <div class="label">Ù…ÙˆØ¨Ø§ÙŠÙ„</div>
                        </div>
                        <div class="stat-card">
                            <div class="icon" style="background:linear-gradient(135deg,#17a2b8,#3498db);">ğŸ’»</div>
                            <div class="value" id="analytics-desktop">0%</div>
                            <div class="label">ÙƒÙ…Ø¨ÙŠÙˆØªØ±</div>
                        </div>
                        <div class="stat-card">
                            <div class="icon" style="background:linear-gradient(135deg,var(--success),#00b894);">ğŸ”„</div>
                            <div class="value" id="analytics-return">0%</div>
                            <div class="label">Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø±Ø¬ÙˆØ¹</div>
                        </div>
                        <div class="stat-card">
                            <div class="icon" style="background:linear-gradient(135deg,var(--gold),#f39c12);">â°</div>
                            <div class="value" id="analytics-peak">--:--</div>
                            <div class="label">ÙˆÙ‚Øª Ø§Ù„Ø°Ø±ÙˆØ©</div>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <h3>ğŸ“Š Ø£ÙˆÙ‚Ø§Øª Ø§Ù„Ø°Ø±ÙˆØ©</h3>
                        </div>
                        <div class="card-body">
                            <div class="chart-container">
                                <canvas id="peakHoursChart"></canvas>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <h3>ğŸ“± ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø£Ø¬Ù‡Ø²Ø©</h3>
                        </div>
                        <div class="card-body">
                            <div class="chart-container" style="height:250px;">
                                <canvas id="devicesChart"></canvas>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <h3>ğŸ… ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…Ø³ØªÙˆÙŠØ§Øª</h3>
                        </div>
                        <div class="card-body">
                            <div class="levels-grid" id="levels-distribution">
                                <div class="level-card bronze">
                                    <span class="badge">ğŸ¥‰</span>
                                    <div class="name">Ø¨Ø±ÙˆÙ†Ø²ÙŠ</div>
                                    <div class="range">0 - 499</div>
                                    <div class="count" id="level-bronze">0</div>
                                </div>
                                <div class="level-card silver">
                                    <span class="badge">ğŸ¥ˆ</span>
                                    <div class="name">ÙØ¶ÙŠ</div>
                                    <div class="range">500 - 1499</div>
                                    <div class="count" id="level-silver">0</div>
                                </div>
                                <div class="level-card gold">
                                    <span class="badge">ğŸ¥‡</span>
                                    <div class="name">Ø°Ù‡Ø¨ÙŠ</div>
                                    <div class="range">1500 - 2999</div>
                                    <div class="count" id="level-gold">0</div>
                                </div>
                                <div class="level-card diamond">
                                    <span class="badge">ğŸ’</span>
                                    <div class="name">Ù…Ø§Ø³ÙŠ</div>
                                    <div class="range">3000+</div>
                                    <div class="count" id="level-diamond">0</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <h3>ğŸ“§ ØªØµØ¯ÙŠØ± Ù‚Ø§Ø¦Ù…Ø© Ø¨Ø±ÙŠØ¯ÙŠØ©</h3>
                        </div>
                        <div class="card-body">
                            <p style="color:var(--text-muted);margin-bottom:15px;">ØªØµØ¯ÙŠØ± Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ù‡ÙˆØ§ØªÙ Ù„Ù„ØªØ³ÙˆÙŠÙ‚ Ø¹Ø¨Ø± SMS Ø£Ùˆ WhatsApp</p>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Ø§Ù„ÙÙ„ØªØ±</label>
                                    <select class="form-control" id="export-filter">
                                        <option value="all">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†</option>
                                        <option value="winners">Ø§Ù„ÙØ§Ø¦Ø²ÙŠÙ† ÙÙ‚Ø·</option>
                                        <option value="active">Ø§Ù„Ù†Ø´Ø·ÙŠÙ† (Ù„Ø¹Ø¨ÙˆØ§ Ù‡Ø°Ø§ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹)</option>
                                        <option value="inactive">ØºÙŠØ± Ø§Ù„Ù†Ø´Ø·ÙŠÙ†</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©</label>
                                    <select class="form-control" id="export-province">
                                        <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø§Øª</option>
                                    </select>
                                </div>
                                <div class="form-group" style="display:flex;align-items:flex-end;">
                                    <button class="btn btn-success" onclick="exportPhoneList()">ğŸ“¥ ØªØµØ¯ÙŠØ±</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Blocking Page -->
                <div class="page" id="page-blocking">
                    <div class="card">
                        <div class="card-header">
                            <h3>ğŸš« Ø­Ø¸Ø± Ø§Ù„Ø£Ø±Ù‚Ø§Ù…</h3>
                            <button class="btn btn-danger btn-sm" onclick="showBlockModal('phone')">+ Ø­Ø¸Ø± Ø±Ù‚Ù…</button>
                        </div>
                        <div class="card-body">
                            <div class="table-container">
                                <table>
                                    <thead>
                                        <tr>
                                            <th>#</th>
                                            <th>Ø§Ù„Ø±Ù‚Ù…</th>
                                            <th>Ø§Ù„Ø³Ø¨Ø¨</th>
                                            <th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø­Ø¸Ø±</th>
                                            <th>Ø¨ÙˆØ§Ø³Ø·Ø©</th>
                                            <th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                                        </tr>
                                    </thead>
                                    <tbody id="blocked-phones-table"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <h3>ğŸŒ Ø­Ø¸Ø± IP</h3>
                            <button class="btn btn-danger btn-sm" onclick="showBlockModal('ip')">+ Ø­Ø¸Ø± IP</button>
                        </div>
                        <div class="card-body">
                            <div class="table-container">
                                <table>
                                    <thead>
                                        <tr>
                                            <th>#</th>
                                            <th>IP</th>
                                            <th>Ø§Ù„Ø³Ø¨Ø¨</th>
                                            <th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø­Ø¸Ø±</th>
                                            <th>Ø¨ÙˆØ§Ø³Ø·Ø©</th>
                                            <th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                                        </tr>
                                    </thead>
                                    <tbody id="blocked-ips-table"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <h3>ğŸ•µï¸ Ø³Ø¬Ù„ Ø§Ù„ØºØ´</h3>
                        </div>
                        <div class="card-body">
                            <div class="table-container">
                                <table>
                                    <thead>
                                        <tr>
                                            <th>Ø§Ù„Ø±Ù‚Ù…</th>
                                            <th>Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©</th>
                                            <th>Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ù…Ø³Ù…ÙˆØ­Ø©</th>
                                            <th>Ø§Ù„ÙØ±Ù‚</th>
                                            <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                                            <th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                                        </tr>
                                    </thead>
                                    <tbody id="cheat-logs-table"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Lucky Wheel Page -->
                <div class="page" id="page-lucky-wheel">
                    <div class="card">
                        <div class="card-header">
                            <h3>ğŸ¡ Ø¹Ø¬Ù„Ø© Ø§Ù„Ø­Ø¸</h3>
                        </div>
                        <div class="card-body">
                            <!-- Enable/Disable -->
                            <div class="setting-row" style="margin-bottom:20px;padding:15px;background:linear-gradient(135deg,rgba(233,69,96,0.1),rgba(255,107,138,0.05));border:1px solid rgba(233,69,96,0.3);border-radius:10px;">
                                <div class="info">
                                    <h4 style="color:var(--accent);">ğŸ° ØªÙØ¹ÙŠÙ„ Ø¹Ø¬Ù„Ø© Ø§Ù„Ø­Ø¸</h4>
                                    <p>Ø§Ù„Ø³Ù…Ø§Ø­ Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø¨Ø§Ù„Ø¯ÙˆØ±Ø§Ù† Ø¹Ù„Ù‰ Ø§Ù„Ø¹Ø¬Ù„Ø©</p>
                                </div>
                                <label class="switch">
                                    <input type="checkbox" id="set-wheel-enabled" onchange="saveSetting('lucky_wheel_enabled', this.checked)">
                                    <span class="slider"></span>
                                </label>
                            </div>
                            
                            <!-- Settings -->
                            <div class="form-row" style="margin-bottom:20px;">
                                <div class="form-group">
                                    <label>ğŸ”„ Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª Ø§Ù„ÙŠÙˆÙ…ÙŠØ©</label>
                                    <input type="number" id="set-wheel-spins" class="form-control" min="1" max="10" value="3" onchange="saveSetting('wheel_spins_per_day', this.value)">
                                </div>
                                <div class="form-group">
                                    <label>ğŸ¯ Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ Ù„Ù„Ù†Ù‚Ø§Ø·</label>
                                    <input type="number" id="set-wheel-min-score" class="form-control" min="0" value="1500" onchange="saveSetting('wheel_min_score', this.value)">
                                </div>
                            </div>
                            
                            <!-- Prizes -->
                            <h4 style="margin-bottom:15px;">ğŸ Ø¬ÙˆØ§Ø¦Ø² Ø§Ù„Ø¹Ø¬Ù„Ø©</h4>
                            <div id="wheel-prizes-list"></div>
                            <button class="btn btn-secondary" onclick="addWheelPrize()" style="margin-top:10px;">+ Ø¥Ø¶Ø§ÙØ© Ø¬Ø§Ø¦Ø²Ø©</button>
                            <button class="btn btn-primary" onclick="saveWheelPrizes()" style="margin-top:10px;margin-right:10px;">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø¬ÙˆØ§Ø¦Ø²</button>
                            
                            <!-- Stats -->
                            <div style="margin-top:30px;">
                                <h4 style="margin-bottom:15px;">ğŸ“Š Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„ÙŠÙˆÙ…</h4>
                                <div class="form-row">
                                    <div class="stat-card" style="text-align:center;">
                                        <div class="value" id="wheel-spins-today">0</div>
                                        <div class="label">Ø³Ø­Ø¨Ø§Øª Ø§Ù„ÙŠÙˆÙ…</div>
                                    </div>
                                    <div class="stat-card" style="text-align:center;">
                                        <div class="value" id="wheel-points-today">0</div>
                                        <div class="label">Ù†Ù‚Ø§Ø· Ù…ÙˆØ²Ø¹Ø©</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Backup Page -->
                <div class="page" id="page-backup">
                    <div class="card">
                        <div class="card-header">
                            <h3>ğŸ”„ Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ</h3>
                            <button class="btn btn-primary btn-sm" onclick="createBackup()">+ Ø¥Ù†Ø´Ø§Ø¡ Ù†Ø³Ø®Ø© Ø§Ù„Ø¢Ù†</button>
                        </div>
                        <div class="card-body">
                            <!-- Auto Backup Toggle -->
                            <div class="setting-row" style="margin-bottom:20px;padding:15px;background:linear-gradient(135deg,rgba(16,185,129,0.1),rgba(52,211,153,0.05));border:1px solid rgba(16,185,129,0.3);border-radius:10px;">
                                <div class="info">
                                    <h4 style="color:#10b981;">ğŸ’¾ Ù†Ø³Ø® Ø§Ø­ØªÙŠØ§Ø·ÙŠ ØªÙ„Ù‚Ø§Ø¦ÙŠ</h4>
                                    <p>Ø¥Ù†Ø´Ø§Ø¡ Ù†Ø³Ø® Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¨Ø´ÙƒÙ„ Ø¯ÙˆØ±ÙŠ</p>
                                </div>
                                <label class="switch">
                                    <input type="checkbox" id="set-auto-backup-enabled" onchange="saveSetting('auto_backup_enabled', this.checked)">
                                    <span class="slider"></span>
                                </label>
                            </div>
                            
                            <!-- Auto Backup Settings -->
                            <div class="form-row" style="margin-bottom:20px;">
                                <div class="form-group">
                                    <label>â° ÙƒÙ„ ÙƒÙ… Ø³Ø§Ø¹Ø©</label>
                                    <select id="set-backup-interval" class="form-control" onchange="saveSetting('auto_backup_interval', this.value)">
                                        <option value="6">ÙƒÙ„ 6 Ø³Ø§Ø¹Ø§Øª</option>
                                        <option value="12">ÙƒÙ„ 12 Ø³Ø§Ø¹Ø©</option>
                                        <option value="24">ÙƒÙ„ 24 Ø³Ø§Ø¹Ø© (ÙŠÙˆÙ…ÙŠ)</option>
                                        <option value="48">ÙƒÙ„ 48 Ø³Ø§Ø¹Ø©</option>
                                        <option value="168">ÙƒÙ„ Ø£Ø³Ø¨ÙˆØ¹</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>ğŸ“… Ø§Ù„Ø§Ø­ØªÙØ§Ø¸ Ù„Ù…Ø¯Ø© (Ø£ÙŠØ§Ù…)</label>
                                    <select id="set-backup-keep-days" class="form-control" onchange="saveSetting('auto_backup_keep_days', this.value)">
                                        <option value="3">3 Ø£ÙŠØ§Ù…</option>
                                        <option value="7">7 Ø£ÙŠØ§Ù…</option>
                                        <option value="14">14 ÙŠÙˆÙ…</option>
                                        <option value="30">30 ÙŠÙˆÙ…</option>
                                    </select>
                                </div>
                            </div>
                            
                            <button class="btn btn-warning" onclick="cleanupOldBackups()" style="margin-bottom:20px;">ğŸ—‘ï¸ Ø­Ø°Ù Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©</button>
                            
                            <h4 style="margin:25px 0 15px;">ğŸ“ Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©</h4>
                            <div id="backups-list"></div>
                        </div>
                    </div>
                </div>

                <!-- Logs Page -->
                <div class="page" id="page-logs">
                    <div class="card">
                        <div class="card-header">
                            <h3>ğŸ“ Ø³Ø¬Ù„ Ø§Ù„Ù†Ø´Ø§Ø·Ø§Øª</h3>
                            <button class="btn btn-secondary btn-sm" onclick="loadLogs()">ğŸ”„ ØªØ­Ø¯ÙŠØ«</button>
                        </div>
                        <div class="card-body">
                            <div class="table-container">
                                <table>
                                    <thead>
                                        <tr><th>Ø§Ù„ÙˆÙ‚Øª</th><th>Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</th><th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡</th><th>Ø§Ù„ØªÙØ§ØµÙŠÙ„</th><th>IP</th></tr>
                                    </thead>
                                    <tbody id="logs-table"></tbody>
                                </table>
                            </div>
                            <div id="logs-pagination" style="margin-top:20px;display:flex;justify-content:center;gap:5px;"></div>
                        </div>
                    </div>
                </div>

            </div>
        </main>
    </div>

    <!-- Modals -->
    <div class="modal-overlay" id="modal-user">
        <div class="modal" style="max-width:700px;">
            <div class="modal-header">
                <h3 id="user-modal-title">Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªØ®Ø¯Ù…</h3>
                <button class="modal-close" onclick="closeModal('modal-user')">Ã—</button>
            </div>
            <div class="modal-body" style="max-height:70vh;overflow-y:auto;">
                <form id="user-form">
                    <input type="hidden" id="user-id">
                    <div class="form-row" style="display:grid;grid-template-columns:1fr 1fr;gap:15px;">
                        <div class="form-group">
                            <label>Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</label>
                            <input type="text" class="form-control" id="user-username" required>
                        </div>
                        <div class="form-group">
                            <label>Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„</label>
                            <input type="text" class="form-control" id="user-name" required>
                        </div>
                    </div>
                    <div class="form-row" style="display:grid;grid-template-columns:1fr 1fr;gap:15px;">
                        <div class="form-group">
                            <label>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
                            <input type="password" class="form-control" id="user-password" placeholder="Ø§ØªØ±ÙƒÙ‡ ÙØ§Ø±ØºØ§Ù‹ Ù„Ù„Ø¥Ø¨Ù‚Ø§Ø¡">
                        </div>
                        <div class="form-group">
                            <label>Ø§Ù„Ù‚Ø§Ù„Ø¨</label>
                            <select class="form-control" id="user-role" onchange="applyPermissionTemplate(this.value)">
                                <option value="custom">ğŸ›ï¸ Ù…Ø®ØµØµ</option>
                                <option value="admin">ğŸ‘‘ Ù…Ø¯ÙŠØ± ÙƒØ§Ù…Ù„</option>
                                <option value="manager">ğŸ‘” Ù…Ø¯ÙŠØ± ÙØ±Ø¹</option>
                                <option value="staff">ğŸ‘¤ Ù…ÙˆØ¸Ù</option>
                                <option value="accountant">ğŸ’° Ù…Ø­Ø§Ø³Ø¨</option>
                                <option value="viewer">ğŸ‘ï¸ Ù…Ø´Ø§Ù‡Ø¯ ÙÙ‚Ø·</option>
                            </select>
                        </div>
                    </div>
                    
                    <!-- Permissions Section -->
                    <div class="form-group">
                        <label style="margin-bottom:10px;display:block;">
                            ğŸ” Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª 
                            <span style="font-size:0.8rem;color:var(--text-muted);">(Ø§Ø³Ø­Ø¨ ÙˆØ£ÙÙ„Øª Ø£Ùˆ Ø§Ù†Ù‚Ø± Ù…Ø±ØªÙŠÙ†)</span>
                        </label>
                        <div class="permissions-container" style="display:grid;grid-template-columns:1fr 1fr;gap:15px;">
                            <!-- Available Permissions -->
                            <div class="permissions-box" style="background:var(--bg-card);border:2px dashed var(--border-color);border-radius:12px;padding:15px;min-height:200px;">
                                <h4 style="margin-bottom:10px;color:var(--text-muted);font-size:0.9rem;">ğŸ“‹ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ù…ØªØ§Ø­Ø©</h4>
                                <div id="available-permissions" class="permissions-list" style="display:flex;flex-wrap:wrap;gap:8px;"></div>
                            </div>
                            <!-- Assigned Permissions -->
                            <div class="permissions-box" style="background:rgba(37,99,235,0.1);border:2px solid var(--primary);border-radius:12px;padding:15px;min-height:200px;">
                                <h4 style="margin-bottom:10px;color:var(--primary);font-size:0.9rem;">âœ… ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ù…ÙˆØ¸Ù</h4>
                                <div id="assigned-permissions" class="permissions-list" style="display:flex;flex-wrap:wrap;gap:8px;"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Permission Details (shows on click) -->
                    <div id="permission-details" style="display:none;background:var(--bg-card);border-radius:12px;padding:15px;margin-top:15px;">
                        <h4 id="permission-details-title" style="margin-bottom:10px;">ğŸ“Š ØªÙØ§ØµÙŠÙ„ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©</h4>
                        <div id="permission-actions" style="display:flex;flex-wrap:wrap;gap:10px;"></div>
                    </div>

                    <!-- Branches & Provinces -->
                    <div class="form-row" style="display:grid;grid-template-columns:1fr 1fr;gap:15px;margin-top:15px;">
                        <div class="form-group">
                            <label>ğŸ¢ Ø§Ù„ÙØ±ÙˆØ¹ Ø§Ù„Ù…Ø³Ù…ÙˆØ­Ø©</label>
                            <select class="form-control" id="user-branches" multiple style="height:100px;">
                            </select>
                            <small style="color:var(--text-muted);">Ø§Ø¶ØºØ· Ctrl Ù„Ù„Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…ØªØ¹Ø¯Ø¯ (ÙØ§Ø±Øº = ÙƒÙ„ Ø§Ù„ÙØ±ÙˆØ¹)</small>
                        </div>
                        <div class="form-group">
                            <label>ğŸ“ Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø§Øª Ø§Ù„Ù…Ø³Ù…ÙˆØ­Ø©</label>
                            <select class="form-control" id="user-provinces" multiple style="height:100px;">
                                <option value="Ø¨ØºØ¯Ø§Ø¯">Ø¨ØºØ¯Ø§Ø¯</option>
                                <option value="Ø§Ù„Ø¨ØµØ±Ø©">Ø§Ù„Ø¨ØµØ±Ø©</option>
                                <option value="Ù†ÙŠÙ†ÙˆÙ‰">Ù†ÙŠÙ†ÙˆÙ‰</option>
                                <option value="Ø£Ø±Ø¨ÙŠÙ„">Ø£Ø±Ø¨ÙŠÙ„</option>
                                <option value="Ø§Ù„Ù†Ø¬Ù">Ø§Ù„Ù†Ø¬Ù</option>
                                <option value="ÙƒØ±Ø¨Ù„Ø§Ø¡">ÙƒØ±Ø¨Ù„Ø§Ø¡</option>
                                <option value="Ø§Ù„Ø£Ù†Ø¨Ø§Ø±">Ø§Ù„Ø£Ù†Ø¨Ø§Ø±</option>
                                <option value="Ø¯ÙŠØ§Ù„Ù‰">Ø¯ÙŠØ§Ù„Ù‰</option>
                                <option value="ÙƒØ±ÙƒÙˆÙƒ">ÙƒØ±ÙƒÙˆÙƒ</option>
                                <option value="ØµÙ„Ø§Ø­ Ø§Ù„Ø¯ÙŠÙ†">ØµÙ„Ø§Ø­ Ø§Ù„Ø¯ÙŠÙ†</option>
                                <option value="ÙˆØ§Ø³Ø·">ÙˆØ§Ø³Ø·</option>
                                <option value="Ø°ÙŠ Ù‚Ø§Ø±">Ø°ÙŠ Ù‚Ø§Ø±</option>
                                <option value="Ø§Ù„Ù…Ø«Ù†Ù‰">Ø§Ù„Ù…Ø«Ù†Ù‰</option>
                                <option value="Ø§Ù„Ù‚Ø§Ø¯Ø³ÙŠØ©">Ø§Ù„Ù‚Ø§Ø¯Ø³ÙŠØ©</option>
                                <option value="Ø¨Ø§Ø¨Ù„">Ø¨Ø§Ø¨Ù„</option>
                                <option value="Ù…ÙŠØ³Ø§Ù†">Ù…ÙŠØ³Ø§Ù†</option>
                                <option value="Ø¯Ù‡ÙˆÙƒ">Ø¯Ù‡ÙˆÙƒ</option>
                                <option value="Ø§Ù„Ø³Ù„ÙŠÙ…Ø§Ù†ÙŠØ©">Ø§Ù„Ø³Ù„ÙŠÙ…Ø§Ù†ÙŠØ©</option>
                            </select>
                            <small style="color:var(--text-muted);">ÙØ§Ø±Øº = ÙƒÙ„ Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø§Øª</small>
                        </div>
                    </div>

                    <div class="form-group">
                        <label style="display:flex;align-items:center;gap:10px;cursor:pointer;">
                            <input type="checkbox" id="user-active" checked style="width:20px;height:20px;">
                            <span>Ø§Ù„Ø­Ø³Ø§Ø¨ ÙØ¹Ø§Ù„</span>
                        </label>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('modal-user')">Ø¥Ù„ØºØ§Ø¡</button>
                <button class="btn btn-primary" onclick="saveUser()">ğŸ’¾ Ø­ÙØ¸</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="modal-confirm">
        <div class="modal" style="max-width:400px;">
            <div class="modal-header">
                <h3 id="confirm-title">ØªØ£ÙƒÙŠØ¯</h3>
                <button class="modal-close" onclick="closeModal('modal-confirm')">Ã—</button>
            </div>
            <div class="modal-body">
                <p id="confirm-message" style="color:var(--text-muted);"></p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('modal-confirm')">Ø¥Ù„ØºØ§Ø¡</button>
                <button class="btn btn-danger" id="confirm-btn">ØªØ£ÙƒÙŠØ¯</button>
            </div>
        </div>
    </div>

    <!-- Prize Modal -->
    <div class="modal-overlay" id="modal-prize">
        <div class="modal">
            <div class="modal-header">
                <h3 id="prize-modal-title">Ø¥Ø¶Ø§ÙØ© Ø¬Ø§Ø¦Ø²Ø©</h3>
                <button class="modal-close" onclick="closeModal('modal-prize')">Ã—</button>
            </div>
            <div class="modal-body">
                <form id="prize-form">
                    <input type="hidden" id="prize-id">
                    <div class="form-group">
                        <label>Ø§Ø³Ù… Ø§Ù„Ø¬Ø§Ø¦Ø²Ø©</label>
                        <input type="text" class="form-control" id="prize-name" required placeholder="Ù…Ø«Ø§Ù„: Ø¢ÙŠÙÙˆÙ† 15 Ø¨Ø±Ùˆ">
                    </div>
                    <div class="form-group">
                        <label>Ø§Ù„ÙˆØµÙ</label>
                        <textarea class="form-control" id="prize-description" rows="3" placeholder="ÙˆØµÙ ØªÙØµÙŠÙ„ÙŠ Ù„Ù„Ø¬Ø§Ø¦Ø²Ø©..."></textarea>
                    </div>
                    <div class="form-group">
                        <label>ØµÙˆØ±Ø© Ø§Ù„Ø¬Ø§Ø¦Ø²Ø©</label>
                        <input type="file" class="form-control" id="prize-image" accept="image/*" onchange="previewPrizeImage(this)">
                        <img id="prize-image-preview" style="max-height:150px;margin-top:10px;display:none;border-radius:10px;">
                    </div>
                    <div class="form-group">
                        <label style="display:flex;align-items:center;gap:10px;cursor:pointer;">
                            <input type="checkbox" id="prize-active" checked style="width:20px;height:20px;">
                            <span>Ø§Ù„Ø¬Ø§Ø¦Ø²Ø© ÙØ¹Ø§Ù„Ø©</span>
                        </label>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('modal-prize')">Ø¥Ù„ØºØ§Ø¡</button>
                <button class="btn btn-primary" onclick="savePrize()">ğŸ’¾ Ø­ÙØ¸</button>
            </div>
        </div>
    </div>

    <!-- Announcement Modal -->
    <div class="modal-overlay" id="modal-announcement">
        <div class="modal" style="max-width:550px;">
            <div class="modal-header">
                <h3 id="announcement-modal-title">Ø¥Ø¹Ù„Ø§Ù† Ø¬Ø¯ÙŠØ¯</h3>
                <button class="modal-close" onclick="closeModal('modal-announcement')">Ã—</button>
            </div>
            <div class="modal-body">
                <form id="announcement-form">
                    <input type="hidden" id="announcement-id">
                    <div class="form-row" style="display:grid;grid-template-columns:1fr 1fr;gap:15px;">
                        <div class="form-group">
                            <label>Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†</label>
                            <input type="text" class="form-control" id="announcement-title" placeholder="Ø¹Ù†ÙˆØ§Ù† Ù‚ØµÙŠØ± ÙˆØ¬Ø°Ø§Ø¨" required>
                        </div>
                        <div class="form-group">
                            <label>Ù†ÙˆØ¹ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†</label>
                            <select class="form-control" id="announcement-type">
                                <option value="info">ğŸ“¢ Ø¥Ø¹Ù„Ø§Ù† Ø¹Ø§Ø¯ÙŠ</option>
                                <option value="urgent">ğŸ”¥ Ø¹Ø§Ø¬Ù„</option>
                                <option value="promo">ğŸ Ø¹Ø±Ø¶/Ø®ØµÙ…</option>
                                <option value="new">âœ¨ Ø¬Ø¯ÙŠØ¯</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Ù†Øµ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†</label>
                        <textarea class="form-control" id="announcement-text" rows="3" required placeholder="ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†..."></textarea>
                    </div>
                    <div class="form-group">
                        <label>ØµÙˆØ±Ø© Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
                        <input type="file" class="form-control" id="announcement-image" accept="image/*" onchange="previewAnnouncementImage(this)">
                        <img id="announcement-image-preview" src="" style="display:none;max-width:150px;max-height:100px;margin-top:10px;border-radius:8px;object-fit:cover;">
                    </div>
                    <div class="form-row" style="display:grid;grid-template-columns:1fr 1fr;gap:15px;">
                        <div class="form-group">
                            <label>Ø§Ù„Ø±Ø§Ø¨Ø· (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
                            <input type="url" class="form-control" id="announcement-link" placeholder="https://example.com">
                        </div>
                        <div class="form-group">
                            <label>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
                            <input type="datetime-local" class="form-control" id="announcement-expires">
                        </div>
                    </div>
                    <div class="form-row" style="display:grid;grid-template-columns:1fr 1fr;gap:15px;align-items:center;">
                        <div class="form-group">
                            <label>Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©</label>
                            <select class="form-control" id="announcement-priority">
                                <option value="0">Ø¹Ø§Ø¯ÙŠ</option>
                                <option value="1">Ù…ØªÙˆØ³Ø·</option>
                                <option value="2">Ø¹Ø§Ù„ÙŠ</option>
                                <option value="3">Ø¹Ø§Ø¬Ù„ ğŸ”¥</option>
                            </select>
                        </div>
                        <div class="form-group" style="margin-top:20px;">
                            <label style="display:flex;align-items:center;gap:10px;cursor:pointer;">
                                <input type="checkbox" id="announcement-active" checked style="width:20px;height:20px;">
                                <span>Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† ÙØ¹Ø§Ù„</span>
                            </label>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('modal-announcement')">Ø¥Ù„ØºØ§Ø¡</button>
                <button class="btn btn-primary" onclick="saveAnnouncement()">ğŸ’¾ Ø­ÙØ¸</button>
            </div>
        </div>
    </div>

    <!-- Branch Modal -->
    <div class="modal-overlay" id="modal-branch">
        <div class="modal">
            <div class="modal-header">
                <h3 id="branch-modal-title">Ø¥Ø¶Ø§ÙØ© ÙØ±Ø¹</h3>
                <button class="modal-close" onclick="closeModal('modal-branch')">Ã—</button>
            </div>
            <div class="modal-body">
                <form id="branch-form">
                    <input type="hidden" id="branch-id">
                    <div class="form-group">
                        <label>Ø§Ø³Ù… Ø§Ù„ÙØ±Ø¹</label>
                        <input type="text" class="form-control" id="branch-name" required placeholder="Ù…Ø«Ø§Ù„: ÙØ±Ø¹ Ø§Ù„Ù…Ù†ØµÙˆØ±">
                    </div>
                    <div class="form-group">
                        <label>Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©</label>
                        <select class="form-control" id="branch-province" required>
                            <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Ø§Ù„Ø¹Ù†ÙˆØ§Ù† / Ø§Ù„Ù…ÙˆÙ‚Ø¹</label>
                        <input type="text" class="form-control" id="branch-location" required placeholder="Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ØªÙØµÙŠÙ„ÙŠ...">
                    </div>
                    <div class="form-group">
                        <label>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label>
                        <input type="tel" class="form-control" id="branch-phone" required placeholder="07XX XXX XXXX">
                    </div>
                    <div class="form-group">
                        <label>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± (Ù„Ù„ÙØ±Ø¹)</label>
                        <input type="password" class="form-control" id="branch-password" placeholder="ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„ÙØ±Ø¹">
                        <small style="color:var(--text-muted)">Ø§ØªØ±ÙƒÙ‡Ø§ ÙØ§Ø±ØºØ© Ù„Ù„Ø¥Ø¨Ù‚Ø§Ø¡ Ø¹Ù„Ù‰ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø­Ø§Ù„ÙŠØ©</small>
                    </div>
                    <div class="form-group">
                        <label style="display:flex;align-items:center;gap:10px;cursor:pointer;">
                            <input type="checkbox" id="branch-active" checked style="width:20px;height:20px;">
                            <span>Ø§Ù„ÙØ±Ø¹ ÙØ¹Ø§Ù„</span>
                        </label>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('modal-branch')">Ø¥Ù„ØºØ§Ø¡</button>
                <button class="btn btn-primary" onclick="saveBranch()">ğŸ’¾ Ø­ÙØ¸</button>
            </div>
        </div>
    </div>

    <!-- Coupon Modal -->
    <div class="modal-overlay" id="modal-coupon">
        <div class="modal">
            <div class="modal-header">
                <h3 id="coupon-modal-title">ÙƒÙˆØ¨ÙˆÙ† Ø¬Ø¯ÙŠØ¯</h3>
                <button class="modal-close" onclick="closeModal('modal-coupon')">Ã—</button>
            </div>
            <div class="modal-body">
                <form id="coupon-form">
                    <input type="hidden" id="coupon-id">
                    <div class="form-group">
                        <label>ÙƒÙˆØ¯ Ø§Ù„ÙƒÙˆØ¨ÙˆÙ†</label>
                        <input type="text" class="form-control" id="coupon-code" required placeholder="Ù…Ø«Ø§Ù„: SAVE100" style="text-transform:uppercase;">
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Ù†ÙˆØ¹ Ø§Ù„Ø®ØµÙ…</label>
                            <select class="form-control" id="coupon-type">
                                <option value="points">Ù†Ù‚Ø§Ø· Ø¥Ø¶Ø§ÙÙŠØ©</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Ù‚ÙŠÙ…Ø© Ø§Ù„Ù†Ù‚Ø§Ø·</label>
                            <input type="number" class="form-control" id="coupon-value" required min="1" value="100">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…</label>
                            <input type="number" class="form-control" id="coupon-max-uses" min="1" value="100">
                        </div>
                        <div class="form-group">
                            <label>Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ Ù„Ù„Ù†Ù‚Ø§Ø·</label>
                            <input type="number" class="form-control" id="coupon-min-score" min="0" value="0">
                            <small style="color:var(--text-muted)">0 = Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø­Ø¯ Ø£Ø¯Ù†Ù‰</small>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡</label>
                        <input type="datetime-local" class="form-control" id="coupon-expires">
                    </div>
                    <div class="form-group">
                        <label style="display:flex;align-items:center;gap:10px;cursor:pointer;">
                            <input type="checkbox" id="coupon-active" checked style="width:20px;height:20px;">
                            <span>Ø§Ù„ÙƒÙˆØ¨ÙˆÙ† ÙØ¹Ø§Ù„</span>
                        </label>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('modal-coupon')">Ø¥Ù„ØºØ§Ø¡</button>
                <button class="btn btn-primary" onclick="saveCoupon()">ğŸ’¾ Ø­ÙØ¸</button>
            </div>
        </div>
    </div>

    <!-- Goal Modal -->
    <div class="modal-overlay" id="modal-goal">
        <div class="modal">
            <div class="modal-header">
                <h3 id="goal-modal-title">Ù‡Ø¯Ù Ø¬Ø¯ÙŠØ¯</h3>
                <button class="modal-close" onclick="closeModal('modal-goal')">Ã—</button>
            </div>
            <div class="modal-body">
                <form id="goal-form">
                    <input type="hidden" id="goal-id">
                    <div class="form-group">
                        <label>Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù‡Ø¯Ù</label>
                        <input type="text" class="form-control" id="goal-title" required placeholder="Ù…Ø«Ø§Ù„: Ø§Ø¬Ù…Ø¹ 500 Ù†Ù‚Ø·Ø©">
                    </div>
                    <div class="form-group">
                        <label>Ø§Ù„ÙˆØµÙ</label>
                        <input type="text" class="form-control" id="goal-description" placeholder="ÙˆØµÙ Ù‚ØµÙŠØ± Ù„Ù„Ù‡Ø¯Ù">
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Ù†ÙˆØ¹ Ø§Ù„Ù‡Ø¯Ù</label>
                            <select class="form-control" id="goal-type">
                                <option value="score">Ø¬Ù…Ø¹ Ù†Ù‚Ø§Ø·</option>
                                <option value="games">Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ù„Ø¹Ø§Ø¨</option>
                                <option value="login">ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ ÙŠÙˆÙ…ÙŠ</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©</label>
                            <input type="number" class="form-control" id="goal-target" value="500" min="1">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Ø§Ù„Ù…ÙƒØ§ÙØ£Ø© (Ù†Ù‚Ø§Ø·)</label>
                            <input type="number" class="form-control" id="goal-reward" value="100" min="1">
                        </div>
                        <div class="form-group">
                            <label>Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø©</label>
                            <select class="form-control" id="goal-icon">
                                <option value="ğŸ¯">ğŸ¯ Ù‡Ø¯Ù</option>
                                <option value="â­">â­ Ù†Ø¬Ù…Ø©</option>
                                <option value="ğŸ†">ğŸ† ÙƒØ£Ø³</option>
                                <option value="ğŸ®">ğŸ® Ù„Ø¹Ø¨Ø©</option>
                                <option value="ğŸ”¥">ğŸ”¥ Ù†Ø§Ø±</option>
                                <option value="ğŸ’">ğŸ’ Ù…Ø§Ø³Ø©</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label style="display:flex;align-items:center;gap:10px;cursor:pointer;">
                            <input type="checkbox" id="goal-active" checked style="width:20px;height:20px;">
                            <span>Ø§Ù„Ù‡Ø¯Ù ÙØ¹Ø§Ù„</span>
                        </label>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('modal-goal')">Ø¥Ù„ØºØ§Ø¡</button>
                <button class="btn btn-primary" onclick="saveGoal()">ğŸ’¾ Ø­ÙØ¸</button>
            </div>
        </div>
    </div>

    <!-- Schedule Draw Modal -->
    <div class="modal-overlay" id="modal-schedule-draw">
        <div class="modal" style="max-width:450px;">
            <div class="modal-header">
                <h3>Ø¬Ø¯ÙˆÙ„Ø© Ø³Ø­Ø¨ Ø¬Ø¯ÙŠØ¯</h3>
                <button class="modal-close" onclick="closeModal('modal-schedule-draw')">Ã—</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>ØªØ§Ø±ÙŠØ® ÙˆÙˆÙ‚Øª Ø§Ù„Ø³Ø­Ø¨</label>
                    <input type="datetime-local" class="form-control" id="schedule-datetime">
                </div>
                <div class="form-group">
                    <label>Ø¹Ø¯Ø¯ Ø§Ù„ÙØ§Ø¦Ø²ÙŠÙ†</label>
                    <input type="number" class="form-control" id="schedule-winners" value="1" min="1" max="10">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('modal-schedule-draw')">Ø¥Ù„ØºØ§Ø¡</button>
                <button class="btn btn-primary" onclick="confirmScheduleDraw()">ğŸ“… Ø¬Ø¯ÙˆÙ„Ø©</button>
            </div>
        </div>
    </div>

    <!-- Block Modal -->
    <div class="modal-overlay" id="modal-block">
        <div class="modal" style="max-width:450px;">
            <div class="modal-header">
                <h3 id="block-modal-title">Ø­Ø¸Ø±</h3>
                <button class="modal-close" onclick="closeModal('modal-block')">Ã—</button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="block-type">
                <div class="form-group">
                    <label id="block-input-label">Ø§Ù„Ø±Ù‚Ù… / IP</label>
                    <input type="text" class="form-control" id="block-value" placeholder="">
                </div>
                <div class="form-group">
                    <label>Ø³Ø¨Ø¨ Ø§Ù„Ø­Ø¸Ø±</label>
                    <select class="form-control" id="block-reason">
                        <option value="cheating">ØºØ´</option>
                        <option value="spam">Ø³Ø¨Ø§Ù…</option>
                        <option value="abuse">Ø¥Ø³Ø§Ø¡Ø© Ø§Ø³ØªØ®Ø¯Ø§Ù…</option>
                        <option value="fake">Ø­Ø³Ø§Ø¨ Ù…Ø²ÙŠÙ</option>
                        <option value="other">Ø³Ø¨Ø¨ Ø¢Ø®Ø±</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Ù…Ù„Ø§Ø­Ø¸Ø§Øª (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
                    <textarea class="form-control" id="block-notes" rows="2" placeholder="Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©..."></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('modal-block')">Ø¥Ù„ØºØ§Ø¡</button>
                <button class="btn btn-danger" onclick="confirmBlock()">ğŸš« Ø­Ø¸Ø±</button>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toast-container"></div>

    <script>
        // ============== Global Variables ==============
        let token = localStorage.getItem('adminToken');
        let currentUser = null;
        let settings = {};
        let allPlayers = [];
        let notifications = [];
        // Language removed - Arabic only
        let currentTheme = localStorage.getItem('adminTheme') || 'dark';
        const provinces = ['Ø¨ØºØ¯Ø§Ø¯','Ø§Ù„Ø¨ØµØ±Ø©','Ù†ÙŠÙ†ÙˆÙ‰','Ø£Ø±Ø¨ÙŠÙ„','Ø§Ù„Ù†Ø¬Ù','ÙƒØ±Ø¨Ù„Ø§Ø¡','Ø§Ù„Ø³Ù„ÙŠÙ…Ø§Ù†ÙŠØ©','Ø°ÙŠ Ù‚Ø§Ø±','Ø§Ù„Ø£Ù†Ø¨Ø§Ø±','Ø¯ÙŠØ§Ù„Ù‰','ÙƒØ±ÙƒÙˆÙƒ','ØµÙ„Ø§Ø­ Ø§Ù„Ø¯ÙŠÙ†','Ø¨Ø§Ø¨Ù„','ÙˆØ§Ø³Ø·','Ù…ÙŠØ³Ø§Ù†','Ø§Ù„Ù…Ø«Ù†Ù‰','Ø§Ù„Ù‚Ø§Ø¯Ø³ÙŠØ©','Ø¯Ù‡ÙˆÙƒ'];


        // ============== Simple Text Helper ==============
        function t(key) {
            const texts = {
                'error': 'Ø®Ø·Ø£',
                'success': 'ØªÙ… Ø¨Ù†Ø¬Ø§Ø­',
                'loading': 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...',
                'confirm': 'ØªØ£ÙƒÙŠØ¯',
                'cancel': 'Ø¥Ù„ØºØ§Ø¡',
                'save': 'Ø­ÙØ¸',
                'delete': 'Ø­Ø°Ù',
                'edit': 'ØªØ¹Ø¯ÙŠÙ„',
                'add': 'Ø¥Ø¶Ø§ÙØ©',
                'close': 'Ø¥ØºÙ„Ø§Ù‚',
                'yes': 'Ù†Ø¹Ù…',
                'no': 'Ù„Ø§',
                'welcome': 'Ù…Ø±Ø­Ø¨Ø§Ù‹'
            };
            return texts[key] || key;
        }

        // ============== Initialization ==============
        document.addEventListener('DOMContentLoaded', () => {
            // Login form
            document.getElementById('login-form').addEventListener('submit', handleLogin);
            
            // Check if already logged in
            if (token) {
                showAdmin();
            }
        });

        // ============== Authentication ==============
        async function handleLogin(e) {
            e.preventDefault();
            const username = document.getElementById('login-username').value;
            const password = document.getElementById('login-password').value;
            
            try {
                // Try old login API first (for .env credentials)
                let res = await fetch('/api/admin/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username, password })
                });
                let data = await res.json();
                
                // If old API fails, try new API (for admin_users table)
                if (!data.success) {
                    res = await fetch('/api/admin/login-v2', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ username, password })
                    });
                    data = await res.json();
                }
                
                if (data.success) {
                    token = data.token;
                    currentUser = data.user || { username, name: 'Ø§Ù„Ù…Ø¯ÙŠØ±', role: 'admin' };
                    localStorage.setItem('adminToken', token);
                    showAdmin();
                    showToast(t('welcome') + ' ' + currentUser.name, 'success');
                } else {
                    showToast(data.error || 'Ø¨ÙŠØ§Ù†Ø§Øª Ø®Ø§Ø·Ø¦Ø©', 'error');
                }
            } catch (err) {
                showToast('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„', 'error');
            }
        }

        function logout() {
            token = null;
            currentUser = null;
            localStorage.removeItem('adminToken');
            document.getElementById('login-page').style.display = 'flex';
            document.getElementById('admin-layout').classList.remove('active');
        }

        function showAdmin() {
            document.getElementById('login-page').style.display = 'none';
            document.getElementById('admin-layout').classList.add('active');
            
            if (currentUser) {
                document.getElementById('user-name').textContent = currentUser.name;
                document.getElementById('user-role').textContent = getRoleName(currentUser.role);
                document.getElementById('user-avatar').textContent = currentUser.name.charAt(0);
            }
            
            // Setup menu navigation
            document.querySelectorAll('.menu-item[data-page]').forEach(item => {
                item.addEventListener('click', () => {
                    navigateTo(item.dataset.page);
                });
            });
            
            // Settings submenu toggle
            const settingsMenu = document.getElementById('settings-menu');
            const settingsSubmenu = document.getElementById('settings-submenu');
            if (settingsMenu && settingsSubmenu) {
                settingsMenu.addEventListener('click', (e) => {
                    e.stopPropagation();
                    settingsMenu.classList.toggle('open');
                    settingsSubmenu.classList.toggle('open');
                });
            }
            
            // Settings submenu items
            document.querySelectorAll('#settings-submenu .menu-item').forEach(item => {
                item.addEventListener('click', (e) => {
                    e.stopPropagation();
                    navigateTo(item.dataset.page);
                });
            });
            
            // Logout button
            const logoutBtn = document.getElementById('logout-btn');
            if (logoutBtn) {
                logoutBtn.addEventListener('click', () => {
                    localStorage.removeItem('adminToken');
                    location.reload();
                });
            }
            
            loadDashboard();
            loadProvinceCheckboxes();
            loadNotifications();
        }

        // ============== Navigation ==============
        function navigateTo(page) {
            document.querySelectorAll('.menu-item').forEach(item => item.classList.remove('active'));
            const menuItem = document.querySelector(`.menu-item[data-page="${page}"]`);
            if (menuItem) menuItem.classList.add('active');
            
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            const pageEl = document.getElementById('page-' + page);
            if (pageEl) pageEl.classList.add('active');
            
            document.getElementById('page-title').textContent = getPageTitle(page);
            loadPageData(page);
        }

        function getPageTitle(page) {
            const titleKeys = {
                'dashboard': 'dashboard', 'players': 'players', 'roulette': 'roulette',
                'prizes': 'prizes', 'announcements': 'announcements', 'branches': 'branches',
                'users': 'users', 'coupons': 'coupons', 'referrals': 'referrals', 'whatsapp': 'whatsapp',
                'chat': 'Ø§Ù„Ø¯Ø±Ø¯Ø´Ø©', 'reports': 'reports', 'backup': 'backup', 'logs': 'logs',
                'settings-game': 'game', 'settings-points': 'points', 'settings-brand': 'brand',
                'settings-social': 'social', 'settings-contact': 'contact', 'settings-contest': 'contest',
                'settings-display': 'display', 'settings-provinces': 'blocked_provinces', 'settings-danger': 'danger_zone'
            };
            return t(titleKeys[page] || page);
        }

        function loadPageData(page) {
            switch(page) {
                case 'dashboard': loadDashboard(); break;
                case 'players': loadPlayers(); break;
                case 'roulette': loadRoulettePlayers(); break;
                case 'prizes': loadPrizes(); break;
                case 'announcements': loadAnnouncements(); break;
                case 'branches': loadBranches(); break;
                case 'users': loadUsers(); load2FAStatus(); loadSecurityLogs(); break;
                case 'coupons': loadCoupons(); break;
                case 'referrals': loadReferrals(); break;
                case 'whatsapp': loadWhatsAppSettings(); break;
                case 'chat': ChatAdmin.load(); break;
                case 'reports': loadReports(); break;
                case 'analytics': loadAnalytics(); break;
                case 'blocking': loadBlocking(); break;
                case 'lucky-wheel': loadLuckyWheel(); loadSettings(); break;
                case 'backup': loadBackupHistory(); loadSettings(); break;
                case 'logs': loadLogs(); break;
                default: 
                    if (page === 'settings-goals') { loadGoals(); loadSettings(); }
                    else if (page === 'settings-contest') { loadContestSettings(); }
                    else if (page.startsWith('settings-')) loadSettings();
            }
        }
        
        async function loadWhatsAppSettings() {
            // Load settings if needed
            try {
                const res = await fetch('/api/admin/stats', { headers: { 'Authorization': 'Bearer ' + token } });
                const data = await res.json();
                const s = data.settings || {};
                
                if (document.getElementById('wa-api-url')) {
                    document.getElementById('wa-api-url').value = s.whatsapp_api_url || '';
                    document.getElementById('wa-api-key').value = s.whatsapp_api_key || '';
                    document.getElementById('wa-winner-template').value = s.winner_message_template || '';
                }
            } catch (err) { console.error(err); }
        }

        function toggleSettingsMenu() {
            document.getElementById('settings-menu').classList.toggle('open');
            document.getElementById('settings-submenu').classList.toggle('open');
        }

        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('open');
        }

        // ============== Dashboard ==============
        // ============== Live Dashboard ==============
        let liveUpdateInterval = null;
        let lastPlayerCount = 0;
        let lastWinnerCount = 0;
        let soundEnabled = localStorage.getItem('soundEnabled') !== 'false';
        
        // Notification sound
        const notificationSound = new Audio('data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdH2Onp+dnZaQhYB8fHx+goaLjpKTk5OSj4yJhoOBgICAgoSGiImLi4yMi4qJh4WEgoGAgICBgoSFh4iJioqKiomIh4WEgoGAgICBgoOFhoiIiYqJiYiHhoWDgoGAgICBgoOEhoaHiIiIh4aGhYSDgoGAgIGBgoOEhYaGh4eHhoaFhIOCgYGAgIGBgoOEhYWGhoaGhoWEg4OCgYGAgIGBgoOEhISFhYWFhYSEg4KCgYGAgIGBggA=');
        
        function toggleSound() {
            soundEnabled = !soundEnabled;
            localStorage.setItem('soundEnabled', soundEnabled);
            document.getElementById('sound-icon').textContent = soundEnabled ? 'ğŸ””' : 'ğŸ”•';
            showToast(soundEnabled ? 'ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„ØµÙˆØª' : 'ØªÙ… Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ØµÙˆØª', 'info');
        }
        
        function playNotificationSound() {
            if (soundEnabled) {
                notificationSound.currentTime = 0;
                notificationSound.play().catch(() => {});
            }
        }
        
        async function loadDashboard() {
            try {
                const res = await fetch('/api/admin/stats', { headers: { 'Authorization': 'Bearer ' + token } });
                const data = await res.json();
                
                const newTotal = data.total || 0;
                const newWinners = data.winners || 0;
                
                // Check for new players/winners and play sound
                if (lastPlayerCount > 0 && newTotal > lastPlayerCount) {
                    playNotificationSound();
                    showToast(`ğŸ® Ù„Ø§Ø¹Ø¨ Ø¬Ø¯ÙŠØ¯! (${newTotal - lastPlayerCount})`, 'success');
                }
                if (lastWinnerCount > 0 && newWinners > lastWinnerCount) {
                    playNotificationSound();
                    showToast(`ğŸ† ÙØ§Ø¦Ø² Ø¬Ø¯ÙŠØ¯!`, 'success');
                }
                
                lastPlayerCount = newTotal;
                lastWinnerCount = newWinners;
                
                // Animate stat changes
                animateValue('stat-total', newTotal);
                animateValue('stat-winners', newWinners);
                animateValue('stat-claimed', data.claimed || 0);
                animateValue('stat-pending', data.pending || 0);
                document.getElementById('players-count').textContent = newTotal;
                
                settings = data.settings || {};
                
                // Draw all charts
                drawPlayersChart();
                drawProvincesChart();
                drawTopScoresChart();
                drawWinnersChart();
                loadRecentActivity();
                
                // Update live indicator
                updateLiveIndicator();
            } catch (err) {
                console.error('Error loading dashboard:', err);
            }
        }
        
        function animateValue(elementId, newValue) {
            const el = document.getElementById(elementId);
            if (!el) return;
            const current = parseInt(el.textContent) || 0;
            if (current === newValue) return;
            
            const diff = newValue - current;
            const steps = 20;
            const stepValue = diff / steps;
            let step = 0;
            
            const interval = setInterval(() => {
                step++;
                el.textContent = Math.round(current + (stepValue * step));
                if (step >= steps) {
                    el.textContent = newValue;
                    clearInterval(interval);
                }
            }, 30);
        }
        
        function updateLiveIndicator() {
            const indicator = document.getElementById('live-indicator');
            if (indicator) {
                indicator.style.animation = 'none';
                indicator.offsetHeight; // Trigger reflow
                indicator.style.animation = 'pulse 2s infinite';
            }
        }
        
        function startLiveUpdates() {
            if (liveUpdateInterval) clearInterval(liveUpdateInterval);
            liveUpdateInterval = setInterval(() => {
                const currentPage = document.querySelector('.page.active')?.id;
                if (currentPage === 'page-dashboard') {
                    loadDashboard();
                }
            }, 30000); // Update every 30 seconds
        }
        
        function stopLiveUpdates() {
            if (liveUpdateInterval) {
                clearInterval(liveUpdateInterval);
                liveUpdateInterval = null;
            }
        }

        // Chart instances
        let playersChartInstance = null;
        let provincesChartInstance = null;
        let topScoresChartInstance = null;
        let winnersChartInstance = null;

        async function drawPlayersChart() {
            const ctx = document.getElementById('playersChart');
            if (!ctx) return;
            
            const period = document.getElementById('chart-period')?.value || 'week';
            
            try {
                const res = await fetch(`/api/admin/charts/players?period=${period}`, {
                    headers: { 'Authorization': 'Bearer ' + token }
                });
                const data = await res.json();
                
                if (playersChartInstance) playersChartInstance.destroy();
                
                playersChartInstance = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: data.map(d => d.label),
                        datasets: [{
                            label: 'Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø§Ù„Ø¬Ø¯Ø¯',
                            data: data.map(d => parseInt(d.count)),
                            borderColor: '#e94560',
                            backgroundColor: 'rgba(233,69,96,0.1)',
                            fill: true,
                            tension: 0.4,
                            pointRadius: 5,
                            pointHoverRadius: 8
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { display: false } },
                        scales: {
                            y: { beginAtZero: true, grid: { color: 'rgba(255,255,255,0.1)' }, ticks: { color: '#8892b0' } },
                            x: { grid: { display: false }, ticks: { color: '#8892b0' } }
                        }
                    }
                });
            } catch (err) {
                console.error(err);
                // Fallback to demo data
                if (playersChartInstance) playersChartInstance.destroy();
                playersChartInstance = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: ['Ø§Ù„Ø³Ø¨Øª', 'Ø§Ù„Ø£Ø­Ø¯', 'Ø§Ù„Ø§Ø«Ù†ÙŠÙ†', 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡', 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡', 'Ø§Ù„Ø®Ù…ÙŠØ³', 'Ø§Ù„Ø¬Ù…Ø¹Ø©'],
                        datasets: [{ label: 'Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†', data: [12, 19, 15, 25, 22, 30, 28], borderColor: '#e94560', backgroundColor: 'rgba(233,69,96,0.1)', fill: true, tension: 0.4 }]
                    },
                    options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { y: { beginAtZero: true, grid: { color: 'rgba(255,255,255,0.1)' } }, x: { grid: { display: false } } } }
                });
            }
        }
        
        function updatePlayersChart() {
            drawPlayersChart();
        }

        async function drawProvincesChart() {
            const ctx = document.getElementById('provincesChart');
            if (!ctx) return;
            
            try {
                const res = await fetch('/api/admin/charts/provinces', {
                    headers: { 'Authorization': 'Bearer ' + token }
                });
                const data = await res.json();
                const top = data.slice(0, 6);
                
                if (provincesChartInstance) provincesChartInstance.destroy();
                
                provincesChartInstance = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: top.map(p => p.province),
                        datasets: [{
                            data: top.map(p => parseInt(p.total_players)),
                            backgroundColor: ['#e94560', '#ffd700', '#00d9a5', '#17a2b8', '#6f42c1', '#fd7e14']
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { position: 'right', labels: { color: '#eaeaea' } } }
                    }
                });
            } catch (err) {
                console.error(err);
            }
        }
        
        async function drawTopScoresChart() {
            const ctx = document.getElementById('topScoresChart');
            if (!ctx) return;
            
            try {
                const res = await fetch('/api/admin/charts/top-scores', {
                    headers: { 'Authorization': 'Bearer ' + token }
                });
                const data = await res.json();
                
                if (topScoresChartInstance) topScoresChartInstance.destroy();
                
                topScoresChartInstance = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: data.map(p => p.name.substring(0, 10)),
                        datasets: [{
                            label: 'Ø§Ù„Ù†Ù‚Ø§Ø·',
                            data: data.map(p => p.score),
                            backgroundColor: 'rgba(255, 215, 0, 0.8)',
                            borderColor: '#ffd700',
                            borderWidth: 2,
                            borderRadius: 5
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        indexAxis: 'y',
                        plugins: { legend: { display: false } },
                        scales: {
                            x: { grid: { color: 'rgba(255,255,255,0.1)' }, ticks: { color: '#8892b0' } },
                            y: { grid: { display: false }, ticks: { color: '#eaeaea' } }
                        }
                    }
                });
            } catch (err) { console.error(err); }
        }
        
        async function drawWinnersChart() {
            const ctx = document.getElementById('winnersChart');
            if (!ctx) return;
            
            try {
                const res = await fetch('/api/admin/charts/winners', {
                    headers: { 'Authorization': 'Bearer ' + token }
                });
                const data = await res.json();
                
                if (winnersChartInstance) winnersChartInstance.destroy();
                
                winnersChartInstance = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: data.slice(0, 8).map(p => p.province),
                        datasets: [{
                            label: 'Ø§Ù„ÙØ§Ø¦Ø²ÙŠÙ†',
                            data: data.slice(0, 8).map(p => parseInt(p.count)),
                            backgroundColor: 'rgba(0, 217, 165, 0.8)',
                            borderColor: '#00d9a5',
                            borderWidth: 2,
                            borderRadius: 5
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { display: false } },
                        scales: {
                            y: { beginAtZero: true, grid: { color: 'rgba(255,255,255,0.1)' }, ticks: { color: '#8892b0' } },
                            x: { grid: { display: false }, ticks: { color: '#eaeaea' } }
                        }
                    }
                });
            } catch (err) { console.error(err); }
        }

        async function loadRecentActivity() {
            try {
                const res = await fetch('/api/admin/activity-logs?limit=5', { headers: { 'Authorization': 'Bearer ' + token } });
                const data = await res.json();
                const container = document.getElementById('recent-activity');
                container.innerHTML = (data.logs || []).map(log => `
                    <div class="timeline-item">
                        <div class="time">${formatTime(log.created_at)}</div>
                        <div class="content"><strong>${log.username || 'Ø§Ù„Ù†Ø¸Ø§Ù…'}</strong> - ${getActionText(log.action)}</div>
                    </div>
                `).join('') || '<p style="color:var(--text-muted)">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù†Ø´Ø§Ø·Ø§Øª</p>';
            } catch (err) { console.error(err); }
        }

        // ============== Reports ==============
        async function loadReports() {
            try {
                // Load stats
                const statsRes = await fetch('/api/admin/reports/stats', {
                    headers: { 'Authorization': 'Bearer ' + token }
                });
                const stats = await statsRes.json();
                
                document.getElementById('report-total-players').textContent = stats.total_players || 0;
                document.getElementById('report-total-winners').textContent = stats.total_winners || 0;
                document.getElementById('report-avg-score').textContent = stats.avg_score || 0;
                document.getElementById('report-today-players').textContent = stats.today_players || 0;
                
                // Populate province dropdown
                const select = document.getElementById('report-province');
                if (select && select.options.length <= 1) {
                    provinces.forEach(p => {
                        const opt = document.createElement('option');
                        opt.value = p;
                        opt.textContent = p;
                        select.appendChild(opt);
                    });
                }
                
                // Set default dates
                const today = new Date();
                const lastMonth = new Date(today.getFullYear(), today.getMonth() - 1, today.getDate());
                document.getElementById('report-from').value = lastMonth.toISOString().split('T')[0];
                document.getElementById('report-to').value = today.toISOString().split('T')[0];
                
                // Load province stats and map
                await loadProvinceStats();
                await loadWinnersMap();
                
            } catch (err) { console.error(err); }
        }
        
        async function loadProvinceStats() {
            try {
                const res = await fetch('/api/admin/charts/provinces', {
                    headers: { 'Authorization': 'Bearer ' + token }
                });
                const data = await res.json();
                
                const tbody = document.getElementById('province-stats-table');
                if (tbody) {
                    tbody.innerHTML = data.map(p => `
                        <tr>
                            <td><strong>${p.province}</strong></td>
                            <td>${p.total_players}</td>
                            <td><span style="color:var(--gold)">${p.winners || 0}</span></td>
                            <td>${p.total_players > 0 ? ((p.winners || 0) / p.total_players * 100).toFixed(1) : 0}%</td>
                            <td>${p.avg_score || 0}</td>
                            <td><strong style="color:var(--success)">${p.max_score || 0}</strong></td>
                        </tr>
                    `).join('') || '<tr><td colspan="6" style="text-align:center">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª</td></tr>';
                }
            } catch (err) { console.error(err); }
        }
        
        async function loadWinnersMap() {
            try {
                const res = await fetch('/api/admin/charts/provinces', {
                    headers: { 'Authorization': 'Bearer ' + token }
                });
                const data = await res.json();
                
                const maxPlayers = Math.max(...data.map(p => parseInt(p.total_players) || 1));
                const topProvince = data[0]?.province;
                
                const grid = document.getElementById('provinces-map-grid');
                if (grid) {
                    grid.innerHTML = data.map(p => {
                        const percentage = (parseInt(p.total_players) / maxPlayers) * 100;
                        const isTop = p.province === topProvince;
                        return `
                            <div class="province-card ${isTop ? 'top' : ''}">
                                <div class="name">${p.province}</div>
                                <div class="stats">
                                    <div class="stat">
                                        <div class="value">${p.total_players}</div>
                                        <div class="label">Ù„Ø§Ø¹Ø¨</div>
                                    </div>
                                    <div class="stat">
                                        <div class="value" style="color:var(--success)">${p.winners || 0}</div>
                                        <div class="label">ÙØ§Ø¦Ø²</div>
                                    </div>
                                </div>
                                <div class="bar" style="width:${percentage}%"></div>
                            </div>
                        `;
                    }).join('') || '<p style="color:var(--text-muted)">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª</p>';
                }
            } catch (err) { console.error(err); }
        }
        
        async function generateReport() {
            const type = document.getElementById('report-type').value;
            const from = document.getElementById('report-from').value;
            const to = document.getElementById('report-to').value;
            const province = document.getElementById('report-province').value;
            const format = document.getElementById('report-format').value;
            
            try {
                showToast('Ø¬Ø§Ø±ÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªÙ‚Ø±ÙŠØ±...', 'info');
                
                const params = new URLSearchParams({ type, from, to });
                if (province) params.append('province', province);
                
                const res = await fetch(`/api/admin/reports/generate?${params}`, {
                    headers: { 'Authorization': 'Bearer ' + token }
                });
                const data = await res.json();
                
                if (format === 'excel') {
                    // Export as Excel (CSV)
                    downloadAsCSV(data, type);
                } else {
                    // Generate PDF
                    generatePDF(data, type);
                }
                
                showToast('ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø¨Ù†Ø¬Ø§Ø­', 'success');
            } catch (err) {
                console.error(err);
                showToast('ÙØ´Ù„ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªÙ‚Ø±ÙŠØ±', 'error');
            }
        }
        
        function downloadAsCSV(data, type) {
            let csv = '';
            const items = data.data || data.players || [];
            
            if (items.length === 0) {
                showToast('Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„ØªØµØ¯ÙŠØ±', 'warning');
                return;
            }
            
            // Headers
            const headers = Object.keys(items[0]);
            csv += headers.join(',') + '\n';
            
            // Data
            items.forEach(item => {
                csv += headers.map(h => `"${item[h] || ''}"`).join(',') + '\n';
            });
            
            // Download
            const blob = new Blob(['\ufeff' + csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `report_${type}_${new Date().toISOString().split('T')[0]}.csv`;
            link.click();
        }
        
        function generatePDF(data, type) {
            // Create printable HTML
            const items = data.data || data.players || [];
            const stats = data.stats || {};
            
            let html = `
                <!DOCTYPE html>
                <html dir="rtl">
                <head>
                    <meta charset="UTF-8">
                    <title>ØªÙ‚Ø±ÙŠØ± ${type}</title>
                    <style>
                        body { font-family: Arial, sans-serif; padding: 20px; direction: rtl; }
                        h1 { color: #e94560; border-bottom: 2px solid #e94560; padding-bottom: 10px; }
                        .stats { display: flex; gap: 20px; margin: 20px 0; }
                        .stat-box { background: #f5f5f5; padding: 15px; border-radius: 10px; text-align: center; }
                        .stat-box .value { font-size: 2rem; font-weight: bold; color: #e94560; }
                        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
                        th, td { border: 1px solid #ddd; padding: 10px; text-align: right; }
                        th { background: #e94560; color: white; }
                        tr:nth-child(even) { background: #f9f9f9; }
                        .footer { margin-top: 30px; text-align: center; color: #666; font-size: 0.9rem; }
                    </style>
                </head>
                <body>
                    <h1>ğŸ“Š ØªÙ‚Ø±ÙŠØ± ${getReportTitle(type)}</h1>
                    <p>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡: ${new Date().toLocaleDateString('ar-IQ')}</p>
            `;
            
            if (stats.total) {
                html += `
                    <div class="stats">
                        <div class="stat-box"><div class="value">${stats.total}</div><div>Ø¥Ø¬Ù…Ø§Ù„ÙŠ</div></div>
                        <div class="stat-box"><div class="value">${stats.winners || 0}</div><div>ÙØ§Ø¦Ø²ÙŠÙ†</div></div>
                        <div class="stat-box"><div class="value">${stats.avg_score || 0}</div><div>Ù…ØªÙˆØ³Ø· Ø§Ù„Ù†Ù‚Ø§Ø·</div></div>
                    </div>
                `;
            }
            
            if (items.length > 0) {
                const headers = Object.keys(items[0]);
                html += '<table><thead><tr>';
                headers.forEach(h => { html += `<th>${h}</th>`; });
                html += '</tr></thead><tbody>';
                items.slice(0, 100).forEach(item => {
                    html += '<tr>';
                    headers.forEach(h => { html += `<td>${item[h] || '-'}</td>`; });
                    html += '</tr>';
                });
                html += '</tbody></table>';
                if (items.length > 100) {
                    html += `<p style="color:#666;">... Ùˆ ${items.length - 100} Ø³Ø¬Ù„ Ø¢Ø®Ø±</p>`;
                }
            }
            
            html += `
                    <div class="footer">
                        <p>ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ù‡Ø°Ø§ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø¨ÙˆØ§Ø³Ø·Ø© Ù†Ø¸Ø§Ù… Red Strong</p>
                    </div>
                </body>
                </html>
            `;
            
            // Open in new window and print
            const win = window.open('', '_blank');
            win.document.write(html);
            win.document.close();
            setTimeout(() => win.print(), 500);
        }
        
        function getReportTitle(type) {
            const titles = {
                'players': 'Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†',
                'winners': 'Ø§Ù„ÙØ§Ø¦Ø²ÙŠÙ†',
                'provinces': 'Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø§Øª',
                'daily': 'ÙŠÙˆÙ…ÙŠ',
                'full': 'Ø´Ø§Ù…Ù„'
            };
            return titles[type] || type;
        }

        // ============== Players ==============
        async function loadPlayers() {
            try {
                const res = await fetch('/api/admin/players', { headers: { 'Authorization': 'Bearer ' + token } });
                allPlayers = await res.json();
                renderPlayers(allPlayers);
                
                const select = document.getElementById('players-province');
                if (select && select.options.length <= 1) {
                    provinces.forEach(p => { const opt = document.createElement('option'); opt.value = p; opt.textContent = p; select.appendChild(opt); });
                }
            } catch (err) { console.error(err); }
        }

        function renderPlayers(players) {
            const tbody = document.getElementById('players-table');
            tbody.innerHTML = players.map((p, i) => `
                <tr>
                    <td>${i + 1}</td>
                    <td><strong>${p.name}</strong></td>
                    <td dir="ltr">${p.phone}</td>
                    <td>${p.province}</td>
                    <td><strong style="color:var(--gold)">${p.score}</strong></td>
                    <td><span class="status status-${p.status}">${getStatusText(p.status)}</span></td>
                    <td>${formatDate(p.created_at)}</td>
                    <td>
                        <button class="btn btn-sm btn-icon btn-secondary" onclick="viewPlayer(${p.id})">ğŸ‘ï¸</button>
                        ${p.status === 'registered' ? `<button class="btn btn-sm btn-icon btn-warning" onclick="makeWinner(${p.id})">ğŸ†</button>` : ''}
                        <button class="btn btn-sm btn-icon btn-danger" onclick="deletePlayer(${p.id})">ğŸ—‘ï¸</button>
                    </td>
                </tr>
            `).join('') || '<tr><td colspan="8" style="text-align:center">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù„Ø§Ø¹Ø¨ÙŠÙ†</td></tr>';
        }

        function filterPlayers() {
            const search = document.getElementById('players-search').value.toLowerCase();
            const province = document.getElementById('players-province').value;
            const status = document.getElementById('players-status').value;
            const filtered = allPlayers.filter(p => {
                return (!search || p.name.toLowerCase().includes(search) || p.phone.includes(search)) &&
                       (!province || p.province === province) && (!status || p.status === status);
            });
            renderPlayers(filtered);
        }

        async function makeWinner(id) {
            showConfirm('ØªØ¹ÙŠÙŠÙ† ÙØ§Ø¦Ø²', 'Ù‡Ù„ ØªØ±ÙŠØ¯ ØªØ¹ÙŠÙŠÙ† Ù‡Ø°Ø§ Ø§Ù„Ù„Ø§Ø¹Ø¨ ÙƒÙØ§Ø¦Ø²ØŸ', async () => {
                await fetch(`/api/admin/make-winner/${id}`, { method: 'POST', headers: { 'Authorization': 'Bearer ' + token } });
                showToast('ØªÙ… ØªØ¹ÙŠÙŠÙ† Ø§Ù„ÙØ§Ø¦Ø²', 'success');
                loadPlayers();
            });
        }

        async function deletePlayer(id) {
            showConfirm('Ø­Ø°Ù Ø§Ù„Ù„Ø§Ø¹Ø¨', 'Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ', async () => {
                await fetch(`/api/admin/players/${id}`, { method: 'DELETE', headers: { 'Authorization': 'Bearer ' + token } });
                showToast('ØªÙ… Ø§Ù„Ø­Ø°Ù', 'success');
                loadPlayers();
            });
        }

        function exportPlayers() { window.location.href = '/api/admin/export-excel?token=' + token; }

        // ============== Roulette ==============
        async function loadRoulettePlayers() {
            try {
                const res = await fetch('/api/admin/roulette-players', { headers: { 'Authorization': 'Bearer ' + token } });
                const players = await res.json();
                document.getElementById('eligible-count').textContent = players.length;
                document.getElementById('min-score').textContent = settings.min_score_for_roulette || '1500';
                const tbody = document.getElementById('eligible-table');
                tbody.innerHTML = players.map((p, i) => `<tr><td>${i+1}</td><td>${p.name}</td><td dir="ltr">${p.phone}</td><td>${p.province}</td><td style="color:var(--gold)">${p.score}</td></tr>`).join('') || '<tr><td colspan="5">Ù„Ø§ ÙŠÙˆØ¬Ø¯</td></tr>';
            } catch (err) { console.error(err); }
        }

        async function spinRoulette() {
            const wheel = document.getElementById('roulette-wheel');
            const btn = document.getElementById('spin-btn');
            btn.disabled = true;
            wheel.style.setProperty('--spin-deg', (1800 + Math.random() * 1800) + 'deg');
            wheel.classList.add('spinning');
            
            try {
                const res = await fetch('/api/admin/roulette-spin', { method: 'POST', headers: { 'Authorization': 'Bearer ' + token } });
                const data = await res.json();
                setTimeout(() => {
                    wheel.classList.remove('spinning');
                    btn.disabled = false;
                    if (data.winner) {
                        document.getElementById('winner-name').textContent = data.winner.name;
                        document.getElementById('winner-phone').textContent = data.winner.phone;
                        document.getElementById('winner-score').textContent = data.winner.score;
                        document.getElementById('winner-code').textContent = data.winner.prize_code;
                        document.getElementById('winner-result').style.display = 'block';
                        showToast('ğŸ‰ ÙØ§Ø¦Ø²: ' + data.winner.name, 'success');
                    } else { showToast(data.error || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø¤Ù‡Ù„ÙŠÙ†', 'error'); }
                }, 4000);
            } catch (err) { wheel.classList.remove('spinning'); btn.disabled = false; showToast('Ø®Ø·Ø£', 'error'); }
        }

        // ============== Users ==============
        let permissionsList = [];
        let permissionTemplates = {};
        let currentUserPermissions = {};

        async function loadUsers() {
            try {
                const res = await fetch('/api/admin/users', { headers: { 'Authorization': 'Bearer ' + token } });
                const users = await res.json();
                const tbody = document.getElementById('users-table');
                tbody.innerHTML = users.map((u, i) => `
                    <tr>
                        <td>${i+1}</td><td><strong>${u.username}</strong></td><td>${u.name}</td>
                        <td><span class="role-badge role-${u.role}">${getRoleName(u.role)}</span></td>
                        <td><span class="status status-${u.active?'active':'inactive'}">${u.active?'ÙØ¹Ø§Ù„':'Ù…ÙˆÙ‚Ù'}</span></td>
                        <td>${u.last_login ? formatTime(u.last_login) : 'Ù„Ù… ÙŠØ¯Ø®Ù„'}</td>
                        <td>
                            <button class="btn btn-sm btn-icon btn-secondary" onclick="editUser(${u.id})">âœï¸</button>
                            ${u.username !== 'admin' ? `<button class="btn btn-sm btn-icon btn-danger" onclick="deleteUser(${u.id})">ğŸ—‘ï¸</button>` : ''}
                        </td>
                    </tr>
                `).join('');
                
                // Load permissions list and templates
                await loadPermissionsData();
            } catch (err) { console.error(err); }
        }

        async function loadPermissionsData() {
            try {
                const [listRes, templatesRes, branchesRes] = await Promise.all([
                    fetch('/api/admin/permissions-list', { headers: { 'Authorization': 'Bearer ' + token } }),
                    fetch('/api/admin/permission-templates', { headers: { 'Authorization': 'Bearer ' + token } }),
                    fetch('/api/admin/branches', { headers: { 'Authorization': 'Bearer ' + token } })
                ]);
                permissionsList = await listRes.json();
                permissionTemplates = await templatesRes.json();
                const branches = await branchesRes.json();
                
                // Populate branches select
                const branchesSelect = document.getElementById('user-branches');
                if (branchesSelect) {
                    branchesSelect.innerHTML = branches.map(b => 
                        `<option value="${b.id}">${b.name}</option>`
                    ).join('');
                }
            } catch (err) { console.error(err); }
        }

        function showUserModal(user = null) {
            document.getElementById('user-modal-title').textContent = user ? 'ØªØ¹Ø¯ÙŠÙ„ Ù…Ø³ØªØ®Ø¯Ù…' : 'Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªØ®Ø¯Ù…';
            document.getElementById('user-id').value = user?.id || '';
            document.getElementById('user-username').value = user?.username || '';
            document.getElementById('user-username').disabled = !!user;
            document.getElementById('user-name').value = user?.name || '';
            document.getElementById('user-password').value = '';
            document.getElementById('user-password').placeholder = user ? 'Ø§ØªØ±ÙƒÙ‡ ÙØ§Ø±ØºØ§Ù‹ Ù„Ù„Ø¥Ø¨Ù‚Ø§Ø¡' : 'ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±';
            document.getElementById('user-role').value = user?.role || 'staff';
            document.getElementById('user-active').checked = user?.active !== false;
            
            // Set permissions
            currentUserPermissions = user?.permissions || {};
            renderPermissions();
            
            // Set branches and provinces
            const branchesSelect = document.getElementById('user-branches');
            const provincesSelect = document.getElementById('user-provinces');
            
            if (branchesSelect && user?.allowed_branches) {
                Array.from(branchesSelect.options).forEach(opt => {
                    opt.selected = user.allowed_branches.includes(parseInt(opt.value));
                });
            }
            if (provincesSelect && user?.allowed_provinces) {
                Array.from(provincesSelect.options).forEach(opt => {
                    opt.selected = user.allowed_provinces.includes(opt.value);
                });
            }
            
            openModal('modal-user');
        }

        function renderPermissions() {
            const availableContainer = document.getElementById('available-permissions');
            const assignedContainer = document.getElementById('assigned-permissions');
            
            let availableHTML = '';
            let assignedHTML = '';
            
            permissionsList.forEach(perm => {
                const isAssigned = currentUserPermissions[perm.id];
                const tag = `
                    <div class="permission-tag ${isAssigned ? 'assigned' : ''}" 
                         data-id="${perm.id}" 
                         draggable="true"
                         ondragstart="dragPermission(event)"
                         ondblclick="togglePermission('${perm.id}')">
                        <span class="icon">${perm.icon}</span>
                        <span class="name">${perm.name}</span>
                        ${isAssigned ? '<span class="remove-btn" onclick="event.stopPropagation(); removePermission(\'' + perm.id + '\')">Ã—</span>' : ''}
                    </div>
                `;
                
                if (isAssigned) {
                    assignedHTML += tag;
                } else {
                    availableHTML += tag;
                }
            });
            
            availableContainer.innerHTML = availableHTML || '<span style="color:var(--text-muted);font-size:0.85rem;">ÙƒÙ„ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª Ù…ÙØ¹Ø·Ø§Ø©</span>';
            assignedContainer.innerHTML = assignedHTML || '<span style="color:var(--text-muted);font-size:0.85rem;">Ø§Ø³Ø­Ø¨ ØµÙ„Ø§Ø­ÙŠØ© Ù‡Ù†Ø§</span>';
            
            // Setup drag and drop
            setupDragDrop();
        }

        function setupDragDrop() {
            const containers = document.querySelectorAll('.permissions-list');
            containers.forEach(container => {
                container.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    container.classList.add('drag-over');
                });
                container.addEventListener('dragleave', () => {
                    container.classList.remove('drag-over');
                });
                container.addEventListener('drop', (e) => {
                    e.preventDefault();
                    container.classList.remove('drag-over');
                    const permId = e.dataTransfer.getData('text/plain');
                    const isAssignedArea = container.id === 'assigned-permissions';
                    
                    if (isAssignedArea && !currentUserPermissions[permId]) {
                        // Add permission with default actions
                        const perm = permissionsList.find(p => p.id === permId);
                        currentUserPermissions[permId] = {};
                        perm.actions.forEach(a => currentUserPermissions[permId][a] = true);
                        renderPermissions();
                    } else if (!isAssignedArea && currentUserPermissions[permId]) {
                        // Remove permission
                        delete currentUserPermissions[permId];
                        renderPermissions();
                    }
                });
            });
        }

        function dragPermission(e) {
            e.dataTransfer.setData('text/plain', e.target.dataset.id);
            e.target.classList.add('dragging');
            setTimeout(() => e.target.classList.remove('dragging'), 0);
        }

        function togglePermission(permId) {
            if (currentUserPermissions[permId]) {
                // Show details modal or remove
                showPermissionDetails(permId);
            } else {
                // Add with all actions
                const perm = permissionsList.find(p => p.id === permId);
                currentUserPermissions[permId] = {};
                perm.actions.forEach(a => currentUserPermissions[permId][a] = true);
                renderPermissions();
            }
        }

        function removePermission(permId) {
            delete currentUserPermissions[permId];
            renderPermissions();
        }

        function showPermissionDetails(permId) {
            const perm = permissionsList.find(p => p.id === permId);
            if (!perm) return;
            
            const detailsDiv = document.getElementById('permission-details');
            const titleEl = document.getElementById('permission-details-title');
            const actionsDiv = document.getElementById('permission-actions');
            
            titleEl.innerHTML = `${perm.icon} ${perm.name} - Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ù…Ø³Ù…ÙˆØ­Ø©`;
            
            const actionNames = {
                view: 'ğŸ‘ï¸ Ø¹Ø±Ø¶',
                add: 'â• Ø¥Ø¶Ø§ÙØ©',
                edit: 'âœï¸ ØªØ¹Ø¯ÙŠÙ„',
                delete: 'ğŸ—‘ï¸ Ø­Ø°Ù',
                spin: 'ğŸ° Ø³Ø­Ø¨',
                settings: 'âš™ï¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª',
                use: 'âœ… Ø§Ø³ØªØ®Ø¯Ø§Ù…',
                send: 'ğŸ“¤ Ø¥Ø±Ø³Ø§Ù„',
                export: 'ğŸ“Š ØªØµØ¯ÙŠØ±'
            };
            
            actionsDiv.innerHTML = perm.actions.map(action => `
                <label class="permission-action ${currentUserPermissions[permId]?.[action] ? 'active' : ''}">
                    <input type="checkbox" 
                           ${currentUserPermissions[permId]?.[action] ? 'checked' : ''}
                           onchange="togglePermissionAction('${permId}', '${action}', this.checked)">
                    ${actionNames[action] || action}
                </label>
            `).join('');
            
            detailsDiv.style.display = 'block';
        }

        function togglePermissionAction(permId, action, checked) {
            if (!currentUserPermissions[permId]) {
                currentUserPermissions[permId] = {};
            }
            currentUserPermissions[permId][action] = checked;
            
            // Update the action label
            const label = event.target.parentElement;
            label.classList.toggle('active', checked);
            
            // If all actions are unchecked, remove the permission
            const hasAnyAction = Object.values(currentUserPermissions[permId]).some(v => v);
            if (!hasAnyAction) {
                delete currentUserPermissions[permId];
                document.getElementById('permission-details').style.display = 'none';
                renderPermissions();
            }
        }

        function applyPermissionTemplate(templateKey) {
            if (templateKey === 'custom') return;
            
            const template = permissionTemplates[templateKey];
            if (template) {
                currentUserPermissions = JSON.parse(JSON.stringify(template.permissions));
                renderPermissions();
                showToast(`ØªÙ… ØªØ·Ø¨ÙŠÙ‚ Ù‚Ø§Ù„Ø¨: ${template.name}`, 'success');
            }
        }

        function editUser(id) {
            fetch('/api/admin/users', { headers: { 'Authorization': 'Bearer ' + token } })
                .then(res => res.json()).then(users => { const u = users.find(x => x.id === id); if (u) showUserModal(u); });
        }

        async function saveUser() {
            const id = document.getElementById('user-id').value;
            
            // Get selected branches and provinces
            const branchesSelect = document.getElementById('user-branches');
            const provincesSelect = document.getElementById('user-provinces');
            const selectedBranches = Array.from(branchesSelect.selectedOptions).map(opt => parseInt(opt.value));
            const selectedProvinces = Array.from(provincesSelect.selectedOptions).map(opt => opt.value);
            
            const data = {
                username: document.getElementById('user-username').value,
                name: document.getElementById('user-name').value,
                password: document.getElementById('user-password').value,
                role: document.getElementById('user-role').value,
                active: document.getElementById('user-active').checked,
                permissions: currentUserPermissions,
                allowed_branches: selectedBranches,
                allowed_provinces: selectedProvinces
            };
            
            if (!id && !data.password) { showToast('ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ù…Ø·Ù„ÙˆØ¨Ø©', 'error'); return; }
            
            try {
                const res = await fetch(id ? `/api/admin/users/${id}` : '/api/admin/users', {
                    method: id ? 'PUT' : 'POST',
                    headers: { 'Content-Type': 'application/json', 'Authorization': 'Bearer ' + token },
                    body: JSON.stringify(data)
                });
                const result = await res.json();
                if (result.error) { showToast(result.error, 'error'); } 
                else { showToast('ØªÙ… Ø§Ù„Ø­ÙØ¸', 'success'); closeModal('modal-user'); loadUsers(); }
            } catch (err) { showToast('Ø®Ø·Ø£', 'error'); }
        }

        async function deleteUser(id) {
            showConfirm('Ø­Ø°Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…', 'Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ', async () => {
                await fetch(`/api/admin/users/${id}`, { method: 'DELETE', headers: { 'Authorization': 'Bearer ' + token } });
                showToast('ØªÙ… Ø§Ù„Ø­Ø°Ù', 'success');
                loadUsers();
            });
        }

        // ============== 2FA & Security ==============
        async function load2FAStatus() {
            try {
                const res = await fetch('/api/admin/2fa/status', { headers: { 'Authorization': 'Bearer ' + token } });
                const data = await res.json();
                
                const statusTitle = document.getElementById('2fa-status-title');
                const statusDesc = document.getElementById('2fa-status-desc');
                const actionsDiv = document.getElementById('2fa-actions');
                
                if (data.enabled) {
                    statusTitle.innerHTML = 'âœ… Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø© Ø§Ù„Ø«Ù†Ø§Ø¦ÙŠØ© Ù…ÙØ¹Ù‘Ù„Ø©';
                    statusDesc.innerHTML = `Ù„Ø¯ÙŠÙƒ ${data.backupCodesCount} Ø£ÙƒÙˆØ§Ø¯ Ø§Ø³ØªØ±Ø¯Ø§Ø¯ Ù…ØªØ¨Ù‚ÙŠØ©`;
                    actionsDiv.innerHTML = '<button class="btn btn-danger btn-sm" onclick="disable2FA()">âŒ Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ØªÙØ¹ÙŠÙ„</button>';
                    document.getElementById('2fa-setup').style.display = 'none';
                } else {
                    statusTitle.innerHTML = 'âš ï¸ Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø© Ø§Ù„Ø«Ù†Ø§Ø¦ÙŠØ© ØºÙŠØ± Ù…ÙØ¹Ù‘Ù„Ø©';
                    statusDesc.innerHTML = 'ÙØ¹Ù‘Ù„ Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø© Ø§Ù„Ø«Ù†Ø§Ø¦ÙŠØ© Ù„Ø­Ù…Ø§ÙŠØ© Ø­Ø³Ø§Ø¨Ùƒ';
                    actionsDiv.innerHTML = '<button class="btn btn-primary btn-sm" onclick="setup2FA()">ğŸ” ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¢Ù†</button>';
                }
            } catch (err) {
                console.error(err);
            }
        }

        async function setup2FA() {
            try {
                const res = await fetch('/api/admin/2fa/setup', { 
                    method: 'POST',
                    headers: { 'Authorization': 'Bearer ' + token } 
                });
                const data = await res.json();
                
                if (data.success) {
                    document.getElementById('2fa-setup').style.display = 'block';
                    document.getElementById('2fa-secret').textContent = data.secret;
                    
                    // Generate QR Code
                    const qrDiv = document.getElementById('2fa-qr');
                    qrDiv.innerHTML = ''; // Clear previous
                    
                    // Create QR code with the OTP URL
                    new QRCode(qrDiv, {
                        text: data.otpUrl,
                        width: 200,
                        height: 200,
                        colorDark: "#000000",
                        colorLight: "#ffffff",
                        correctLevel: QRCode.CorrectLevel.H
                    });
                    
                    // Show backup codes
                    const codesDiv = document.getElementById('backup-codes');
                    codesDiv.innerHTML = data.backupCodes.map(code => 
                        `<code style="background:var(--bg-dark);color:var(--gold);padding:8px 12px;border-radius:6px;font-family:monospace;">${code}</code>`
                    ).join('');
                    
                    showToast('Ø§Ù…Ø³Ø­ Ø§Ù„Ù€ QR Code Ø¨ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©', 'info');
                }
            } catch (err) {
                showToast('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯', 'error');
            }
        }

        async function verify2FA() {
            const code = document.getElementById('2fa-verify-code').value;
            if (!code || code.length !== 6) {
                showToast('Ø£Ø¯Ø®Ù„ Ø±Ù…Ø² Ù…ÙƒÙˆÙ† Ù…Ù† 6 Ø£Ø±Ù‚Ø§Ù…', 'error');
                return;
            }
            
            try {
                const res = await fetch('/api/admin/2fa/verify', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json', 'Authorization': 'Bearer ' + token },
                    body: JSON.stringify({ code })
                });
                const data = await res.json();
                
                if (data.success) {
                    showToast('âœ… ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø© Ø§Ù„Ø«Ù†Ø§Ø¦ÙŠØ©', 'success');
                    load2FAStatus();
                } else {
                    showToast(data.error || 'Ø±Ù…Ø² ØºÙŠØ± ØµØ­ÙŠØ­', 'error');
                }
            } catch (err) {
                showToast('Ø®Ø·Ø£', 'error');
            }
        }

        async function disable2FA() {
            const password = prompt('Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ù„ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¥Ù„ØºØ§Ø¡:');
            if (!password) return;
            
            try {
                const res = await fetch('/api/admin/2fa/disable', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json', 'Authorization': 'Bearer ' + token },
                    body: JSON.stringify({ password })
                });
                const data = await res.json();
                
                if (data.success) {
                    showToast('ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø© Ø§Ù„Ø«Ù†Ø§Ø¦ÙŠØ©', 'success');
                    load2FAStatus();
                } else {
                    showToast(data.error || 'Ø®Ø·Ø£', 'error');
                }
            } catch (err) {
                showToast('Ø®Ø·Ø£', 'error');
            }
        }

        // ============== Backup ==============
        async function loadBackupHistory() {
            try {
                const res = await fetch('/api/admin/backup-history', { headers: { 'Authorization': 'Bearer ' + token } });
                const backups = await res.json();
                
                document.getElementById('backup-count').textContent = backups.length;
                
                if (backups.length > 0) {
                    const lastBackup = new Date(backups[0].created_at);
                    document.getElementById('last-backup').textContent = lastBackup.toLocaleDateString('ar-IQ');
                }
                
                const tbody = document.getElementById('backup-table');
                tbody.innerHTML = backups.map((b, i) => `
                    <tr>
                        <td>${i + 1}</td>
                        <td><code>${b.filename}</code></td>
                        <td>${formatBytes(b.size_bytes)}</td>
                        <td><span class="status status-${b.type === 'auto' ? 'active' : 'pending'}">${b.type === 'auto' ? 'ØªÙ„Ù‚Ø§Ø¦ÙŠ' : 'ÙŠØ¯ÙˆÙŠ'}</span></td>
                        <td>${formatTime(b.created_at)}</td>
                        <td><button class="btn btn-sm btn-secondary" onclick="downloadBackup('${b.filename}')">ğŸ“¥</button></td>
                    </tr>
                `).join('') || '<tr><td colspan="6">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†Ø³Ø®</td></tr>';
            } catch (err) {
                console.error(err);
            }
        }

        function formatBytes(bytes) {
            if (!bytes) return '0 B';
            const k = 1024;
            const sizes = ['B', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        async function createBackup() {
            showToast('Ø¬Ø§Ø±ÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©...', 'info');
            try {
                const res = await fetch('/api/admin/backup', { 
                    method: 'POST',
                    headers: { 'Authorization': 'Bearer ' + token } 
                });
                const data = await res.json();
                
                if (data.success) {
                    // Download the backup
                    const blob = new Blob([JSON.stringify(data.backup, null, 2)], { type: 'application/json' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = data.filename || `backup_${Date.now()}.json`;
                    a.click();
                    URL.revokeObjectURL(url);
                    
                    showToast('âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©', 'success');
                    loadBackupHistory();
                }
            } catch (err) {
                showToast('Ø®Ø·Ø£ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù†Ø³Ø®Ø©', 'error');
            }
        }

        async function loadSecurityLogs() {
            try {
                const res = await fetch('/api/admin/security-logs?limit=50', { headers: { 'Authorization': 'Bearer ' + token } });
                const logs = await res.json();
                
                const eventTypes = {
                    'login_success': 'âœ… Ø¯Ø®ÙˆÙ„ Ù†Ø§Ø¬Ø­',
                    'login_failed': 'âŒ ÙØ´Ù„ Ø§Ù„Ø¯Ø®ÙˆÙ„',
                    '2fa_enabled': 'ğŸ” ØªÙØ¹ÙŠÙ„ 2FA',
                    '2fa_disabled': 'ğŸ”“ Ø¥Ù„ØºØ§Ø¡ 2FA',
                    '2fa_failed': 'âš ï¸ ÙØ´Ù„ 2FA',
                    'backup_code_used': 'ğŸ”‘ Ø§Ø³ØªØ®Ø¯Ø§Ù… ÙƒÙˆØ¯ Ø§Ø­ØªÙŠØ§Ø·ÙŠ'
                };
                
                const tbody = document.getElementById('security-logs-table');
                tbody.innerHTML = logs.map(log => `
                    <tr>
                        <td>${eventTypes[log.event_type] || log.event_type}</td>
                        <td>${log.username || '-'}</td>
                        <td><code style="font-size:0.8rem;">${log.ip_address || '-'}</code></td>
                        <td>${formatTime(log.created_at)}</td>
                    </tr>
                `).join('') || '<tr><td colspan="4">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø³Ø¬Ù„Ø§Øª</td></tr>';
            } catch (err) {
                console.error(err);
            }
        }

        // ============== Settings ==============
        async function loadSettings() {
            try {
                const res = await fetch('/api/admin/stats', { headers: { 'Authorization': 'Bearer ' + token } });
                const data = await res.json();
                settings = data.settings || {};
                
                // Apply settings to form fields
                const setVal = (id, key, def) => { const el = document.getElementById(id); if (el) el.value = settings[key] || def; };
                const setCheck = (id, key) => { const el = document.getElementById(id); if (el) el.checked = settings[key] === 'true'; };
                
                setCheck('set-game-enabled', 'game_enabled');
                setCheck('set-require-location', 'require_location');
                setVal('set-max-rounds', 'max_rounds', '3');
                setVal('set-cooldown', 'cooldown_minutes', '30');
                setVal('set-diff-1', 'difficulty_increase_1', '0');
                setVal('set-diff-2', 'difficulty_increase_2', '20');
                setVal('set-diff-3', 'difficulty_increase_3', '40');
                setVal('set-min-roulette', 'min_score_for_roulette', '1500');
                setVal('set-max-winners', 'max_winners', '5');
                setVal('set-site-name', 'site_name', '');
                setVal('set-site-title', 'site_title', '');
                setVal('set-site-subtitle', 'site_subtitle', '');
                setVal('set-logo-letters', 'logo_letters', '');
                setVal('set-footer-company', 'footer_company', '');
                setVal('set-primary-color', 'primary_color', '#e31e24');
                setVal('set-secondary-color', 'secondary_color', '#1a237e');
                setVal('set-gold-color', 'gold_color', '#ffd700');
                setCheck('set-show-social', 'show_social');
                setVal('set-facebook', 'facebook_url', '');
                setVal('set-instagram', 'instagram_url', '');
                setVal('set-whatsapp', 'whatsapp_number', '');
                setVal('set-tiktok', 'tiktok_url', '');
                setCheck('set-show-contact', 'show_contact');
                setVal('set-contact-phone', 'contact_phone', '');
                setVal('set-contact-email', 'contact_email', '');
                setVal('set-contact-address', 'contact_address', '');
                setVal('set-description', 'site_description', '');
                setCheck('set-show-countdown', 'show_countdown');
                setCheck('set-show-features', 'show_features');
                setCheck('set-show-leaderboard', 'show_leaderboard');
                setCheck('set-show-players-count', 'show_players_count');
                setCheck('set-show-achievements', 'show_achievements');
                
                // Lucky Wheel settings
                setCheck('set-wheel-enabled', 'lucky_wheel_enabled');
                setVal('set-wheel-spins', 'wheel_spins_per_day', '3');
                setVal('set-wheel-min-score', 'wheel_min_score', '1500');
                
                // Daily Tasks settings
                setCheck('set-daily-tasks-enabled', 'daily_tasks_enabled');
                setVal('set-daily-tasks-count', 'daily_tasks_count', '3');
                setVal('set-daily-bonus-streak', 'daily_tasks_bonus_streak', '50');
                
                // Daily Goals settings
                setCheck('set-goals-enabled', 'daily_goals_enabled');
                
                // Auto Backup settings
                setCheck('set-auto-backup-enabled', 'auto_backup_enabled');
                setVal('set-backup-interval', 'auto_backup_interval', '24');
                setVal('set-backup-keep-days', 'auto_backup_keep_days', '7');
                
                if (settings.logo_image) {
                    const preview = document.getElementById('logo-preview');
                    if (preview) { preview.src = settings.logo_image; preview.style.display = 'block'; }
                }
                
                // Blocked provinces
                try {
                    const blocked = JSON.parse(settings.blocked_provinces || '[]');
                    provinces.forEach(p => {
                        const cb = document.getElementById('prov-' + p);
                        if (cb) { cb.checked = blocked.includes(p); cb.parentElement.classList.toggle('checked', blocked.includes(p)); }
                    });
                } catch (e) {}
            } catch (err) { console.error(err); }
        }

        function loadProvinceCheckboxes() {
            const container = document.getElementById('provinces-checkboxes');
            if (container) {
                container.innerHTML = provinces.map(p => `<label class="checkbox-item" onclick="this.classList.toggle('checked')"><input type="checkbox" id="prov-${p}">${p}</label>`).join('');
            }
        }

        async function saveSetting(key, value) {
            try {
                await fetch('/api/admin/settings', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json', 'Authorization': 'Bearer ' + token },
                    body: JSON.stringify({ settings: { [key]: value.toString() } })
                });
                showToast('ØªÙ… Ø§Ù„Ø­ÙØ¸', 'success');
            } catch (err) { showToast('Ø®Ø·Ø£', 'error'); }
        }

        async function saveMultipleSettings(obj) {
            try {
                await fetch('/api/admin/settings', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json', 'Authorization': 'Bearer ' + token },
                    body: JSON.stringify({ settings: obj })
                });
                showToast('ØªÙ… Ø§Ù„Ø­ÙØ¸', 'success');
            } catch (err) { showToast('Ø®Ø·Ø£', 'error'); }
        }

        function saveGameSettings() {
            saveMultipleSettings({
                max_rounds: document.getElementById('set-max-rounds').value,
                cooldown_minutes: document.getElementById('set-cooldown').value,
                difficulty_increase_1: document.getElementById('set-diff-1').value,
                difficulty_increase_2: document.getElementById('set-diff-2').value,
                difficulty_increase_3: document.getElementById('set-diff-3').value
            });
        }

        function savePointsSettings() {
            saveMultipleSettings({
                min_score_for_roulette: document.getElementById('set-min-roulette').value,
                max_winners: document.getElementById('set-max-winners').value
            });
        }

        function saveBrandSettings() {
            saveMultipleSettings({
                site_name: document.getElementById('set-site-name').value,
                site_title: document.getElementById('set-site-title').value,
                site_subtitle: document.getElementById('set-site-subtitle').value,
                logo_letters: document.getElementById('set-logo-letters').value,
                footer_company: document.getElementById('set-footer-company').value,
                primary_color: document.getElementById('set-primary-color').value,
                secondary_color: document.getElementById('set-secondary-color').value,
                gold_color: document.getElementById('set-gold-color').value
            });
        }

        function saveSocialSettings() {
            saveMultipleSettings({
                facebook_url: document.getElementById('set-facebook').value,
                instagram_url: document.getElementById('set-instagram').value,
                whatsapp_number: document.getElementById('set-whatsapp').value,
                tiktok_url: document.getElementById('set-tiktok').value
            });
        }

        function saveContactSettings() {
            saveMultipleSettings({
                contact_phone: document.getElementById('set-contact-phone').value,
                contact_email: document.getElementById('set-contact-email').value,
                contact_address: document.getElementById('set-contact-address').value
            });
        }

        function saveContestSettings() {
            saveMultipleSettings({
                site_description: document.getElementById('set-description').value,
                contest_start_date: document.getElementById('set-start-date').value,
                contest_end_date: document.getElementById('set-end-date').value
            });
        }

        function saveBlockedProvinces() {
            const blocked = provinces.filter(p => document.getElementById('prov-' + p)?.checked);
            saveSetting('blocked_provinces', JSON.stringify(blocked));
        }

        async function uploadLogo(input) {
            if (!input.files[0]) return;
            const formData = new FormData();
            formData.append('image', input.files[0]);
            try {
                const res = await fetch('/api/admin/upload', { method: 'POST', headers: { 'Authorization': 'Bearer ' + token }, body: formData });
                const data = await res.json();
                if (data.success) {
                    document.getElementById('logo-preview').src = data.path;
                    document.getElementById('logo-preview').style.display = 'block';
                    await saveSetting('logo_image', data.path);
                }
            } catch (err) { showToast('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø±ÙØ¹', 'error'); }
        }

        // ============== Logs ==============
        let logsPage = 1;
        async function loadLogs(page = 1) {
            logsPage = page;
            try {
                const res = await fetch(`/api/admin/activity-logs?limit=20&offset=${(page-1)*20}`, { headers: { 'Authorization': 'Bearer ' + token } });
                const data = await res.json();
                const tbody = document.getElementById('logs-table');
                tbody.innerHTML = (data.logs || []).map(log => `
                    <tr>
                        <td style="font-size:0.75rem">${formatTime(log.created_at)}</td>
                        <td><strong>${log.username || 'Ø§Ù„Ù†Ø¸Ø§Ù…'}</strong></td>
                        <td><span class="status" style="background:rgba(233,69,96,0.2);color:var(--accent)">${getActionText(log.action)}</span></td>
                        <td style="font-size:0.8rem">${log.details || '-'}</td>
                        <td style="font-size:0.7rem;color:var(--text-muted)">${log.ip_address || '-'}</td>
                    </tr>
                `).join('') || '<tr><td colspan="5">Ù„Ø§ ÙŠÙˆØ¬Ø¯</td></tr>';
                
                const pages = Math.ceil((data.total || 0) / 20);
                const pagination = document.getElementById('logs-pagination');
                if (pages > 1) {
                    let html = '';
                    for (let i = 1; i <= pages; i++) html += `<button class="btn btn-sm ${i===page?'btn-primary':'btn-secondary'}" onclick="loadLogs(${i})">${i}</button>`;
                    pagination.innerHTML = html;
                } else pagination.innerHTML = '';
            } catch (err) { console.error(err); }
        }

        // ============== Notifications ==============
        function loadNotifications() {
            notifications = JSON.parse(localStorage.getItem('admin_notifications') || '[]');
            renderNotifications();
        }

        function renderNotifications() {
            const unread = notifications.filter(n => !n.read).length;
            const countEl = document.getElementById('notif-count');
            if (countEl) { countEl.textContent = unread; countEl.style.display = unread > 0 ? 'flex' : 'none'; }
            const container = document.getElementById('notifications-list');
            if (container) {
                container.innerHTML = notifications.slice(0, 10).map((n, i) => `
                    <div class="notification-item ${n.read ? '' : 'unread'}" onclick="readNotification(${i})">
                        <div class="title">${n.title}</div><div class="text">${n.text}</div><div class="time">${formatTime(n.time)}</div>
                    </div>
                `).join('') || '<div style="padding:20px;text-align:center;color:var(--text-muted)">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</div>';
            }
        }

        function addNotification(title, text) {
            notifications.unshift({ title, text, time: new Date().toISOString(), read: false });
            localStorage.setItem('admin_notifications', JSON.stringify(notifications));
            renderNotifications();
        }

        function readNotification(i) { notifications[i].read = true; localStorage.setItem('admin_notifications', JSON.stringify(notifications)); renderNotifications(); }
        function markAllRead() { notifications.forEach(n => n.read = true); localStorage.setItem('admin_notifications', JSON.stringify(notifications)); renderNotifications(); }
        function toggleNotifications() { document.getElementById('notifications-panel').classList.toggle('active'); }

        // ============== Danger Zone ==============
        function confirmResetWinners() {
            showConfirm('Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†', 'Ø³ÙŠØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø­Ø§Ù„Ø© Ø§Ù„ÙÙˆØ² Ù…Ù† Ø§Ù„Ø¬Ù…ÙŠØ¹ØŸ', async () => {
                await fetch('/api/admin/reset-winners', { method: 'POST', headers: { 'Authorization': 'Bearer ' + token } });
                showToast('ØªÙ…', 'success'); loadDashboard();
            });
        }

        function confirmResetAll() {
            showConfirm('âš ï¸ Ø­Ø°Ù Ø§Ù„ÙƒÙ„', 'Ø³ÙŠØªÙ… Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹!', async () => {
                await fetch('/api/admin/reset-all', { method: 'POST', headers: { 'Authorization': 'Bearer ' + token } });
                showToast('ØªÙ…', 'success'); loadDashboard();
            });
        }

        function confirmResetScores() {
            showConfirm('Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù†Ù‚Ø§Ø·', 'Ø³ÙŠØªÙ… Ø¥Ø¹Ø§Ø¯Ø© Ù†Ù‚Ø§Ø· Ø§Ù„Ø¬Ù…ÙŠØ¹ Ù„ØµÙØ±ØŸ', async () => {
                await fetch('/api/admin/reset-scores', { method: 'POST', headers: { 'Authorization': 'Bearer ' + token } });
                showToast('ØªÙ…', 'success'); loadDashboard();
            });
        }

        // ============== Backup ==============
        async function createBackup() {
            showToast('Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡...', 'info');
            try {
                const res = await fetch('/api/admin/backup', { method: 'POST', headers: { 'Authorization': 'Bearer ' + token } });
                const data = await res.json();
                if (data.success) {
                    const blob = new Blob([JSON.stringify(data.backup)], { type: 'application/json' });
                    const a = document.createElement('a'); a.href = URL.createObjectURL(blob);
                    a.download = `backup_${new Date().toISOString().slice(0,10)}.json`; a.click();
                    showToast('ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù†Ø³Ø®Ø©', 'success');
                }
            } catch (err) { showToast('Ø®Ø·Ø£', 'error'); }
        }

        // ============== Utilities ==============
        function openModal(id) { document.getElementById(id).classList.add('active'); }
        function closeModal(id) { document.getElementById(id).classList.remove('active'); }
        
        function showConfirm(title, msg, callback) {
            document.getElementById('confirm-title').textContent = title;
            document.getElementById('confirm-message').textContent = msg;
            document.getElementById('confirm-btn').onclick = () => { closeModal('modal-confirm'); callback(); };
            openModal('modal-confirm');
        }

        function showToast(msg, type = 'success') {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');
            toast.className = `toast toast-${type}`;
            const icons = { success: 'âœ…', error: 'âŒ', warning: 'âš ï¸', info: 'â„¹ï¸' };
            toast.innerHTML = `<span>${icons[type]}</span><span>${msg}</span>`;
            container.appendChild(toast);
            setTimeout(() => { toast.style.opacity = '0'; setTimeout(() => toast.remove(), 300); }, 3000);
        }

        function formatDate(d) { return d ? new Date(d).toLocaleDateString('ar-IQ') : '-'; }
        function formatTime(d) {
            if (!d) return '-';
            const diff = Date.now() - new Date(d);
            if (diff < 60000) return 'Ø§Ù„Ø¢Ù†';
            if (diff < 3600000) return `Ù…Ù†Ø° ${Math.floor(diff/60000)} Ø¯Ù‚ÙŠÙ‚Ø©`;
            if (diff < 86400000) return `Ù…Ù†Ø° ${Math.floor(diff/3600000)} Ø³Ø§Ø¹Ø©`;
            return new Date(d).toLocaleDateString('ar-IQ');
        }

        function getStatusText(s) { return { registered: 'Ù…Ø³Ø¬Ù„', winner: 'ÙØ§Ø¦Ø²', claimed: 'Ù…Ø³ØªÙ„Ù…' }[s] || s; }
        function getRoleName(r) { return { admin: 'ğŸ‘‘ Ù…Ø¯ÙŠØ±', moderator: 'ğŸ‘¤ Ù…Ø´Ø±Ù', staff: 'ğŸª Ù…ÙˆØ¸Ù' }[r] || r; }
        function getActionText(a) {
            return { login_success: 'ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„', login_failed: 'ÙØ´Ù„ Ø§Ù„Ø¯Ø®ÙˆÙ„', add_user: 'Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªØ®Ø¯Ù…', update_user: 'ØªØ¹Ø¯ÙŠÙ„ Ù…Ø³ØªØ®Ø¯Ù…', delete_user: 'Ø­Ø°Ù Ù…Ø³ØªØ®Ø¯Ù…', make_winner: 'ØªØ¹ÙŠÙŠÙ† ÙØ§Ø¦Ø²', roulette_spin: 'Ø³Ø­Ø¨ Ø±ÙˆÙ„ÙŠØª', delete_player: 'Ø­Ø°Ù Ù„Ø§Ø¹Ø¨', backup_created: 'Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©', add_prize: 'Ø¥Ø¶Ø§ÙØ© Ø¬Ø§Ø¦Ø²Ø©', update_prize: 'ØªØ¹Ø¯ÙŠÙ„ Ø¬Ø§Ø¦Ø²Ø©', delete_prize: 'Ø­Ø°Ù Ø¬Ø§Ø¦Ø²Ø©', add_announcement: 'Ø¥Ø¶Ø§ÙØ© Ø¥Ø¹Ù„Ø§Ù†', update_announcement: 'ØªØ¹Ø¯ÙŠÙ„ Ø¥Ø¹Ù„Ø§Ù†', delete_announcement: 'Ø­Ø°Ù Ø¥Ø¹Ù„Ø§Ù†', add_branch: 'Ø¥Ø¶Ø§ÙØ© ÙØ±Ø¹', update_branch: 'ØªØ¹Ø¯ÙŠÙ„ ÙØ±Ø¹', delete_branch: 'Ø­Ø°Ù ÙØ±Ø¹' }[a] || a;
        }

        // ============== Prizes Management ==============
        let allPrizes = [];
        
        async function loadPrizes() {
            try {
                const res = await fetch('/api/admin/prizes', { headers: { 'Authorization': 'Bearer ' + token } });
                allPrizes = await res.json();
                renderPrizes();
            } catch (err) { console.error(err); showToast(t('error'), 'error'); }
        }
        
        function renderPrizes() {
            const tbody = document.getElementById('prizes-table');
            tbody.innerHTML = allPrizes.map((p, i) => `
                <tr>
                    <td>${i + 1}</td>
                    <td>${p.image ? `<img src="${p.image}" style="width:60px;height:60px;object-fit:cover;border-radius:8px;">` : '<span style="color:var(--text-muted)">Ù„Ø§ ÙŠÙˆØ¬Ø¯</span>'}</td>
                    <td><strong>${p.name}</strong></td>
                    <td style="max-width:200px;overflow:hidden;text-overflow:ellipsis;">${p.description || '-'}</td>
                    <td><span class="status status-${p.active ? 'active' : 'inactive'}">${p.active ? 'ÙØ¹Ø§Ù„' : 'Ù…ÙˆÙ‚Ù'}</span></td>
                    <td>
                        <button class="btn btn-sm btn-icon btn-secondary" onclick="editPrize(${p.id})">âœï¸</button>
                        <button class="btn btn-sm btn-icon ${p.active ? 'btn-warning' : 'btn-success'}" onclick="togglePrize(${p.id})">${p.active ? 'â¸ï¸' : 'â–¶ï¸'}</button>
                        <button class="btn btn-sm btn-icon btn-danger" onclick="deletePrize(${p.id})">ğŸ—‘ï¸</button>
                    </td>
                </tr>
            `).join('') || '<tr><td colspan="6" style="text-align:center;color:var(--text-muted)">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¬ÙˆØ§Ø¦Ø²</td></tr>';
        }
        
        function showPrizeModal(prize = null) {
            document.getElementById('prize-modal-title').textContent = prize ? 'ØªØ¹Ø¯ÙŠÙ„ Ø¬Ø§Ø¦Ø²Ø©' : 'Ø¥Ø¶Ø§ÙØ© Ø¬Ø§Ø¦Ø²Ø©';
            document.getElementById('prize-id').value = prize?.id || '';
            document.getElementById('prize-name').value = prize?.name || '';
            document.getElementById('prize-description').value = prize?.description || '';
            document.getElementById('prize-active').checked = prize?.active !== false;
            
            const preview = document.getElementById('prize-image-preview');
            if (prize?.image) {
                preview.src = prize.image;
                preview.style.display = 'block';
            } else {
                preview.style.display = 'none';
            }
            document.getElementById('prize-image').value = '';
            
            openModal('modal-prize');
        }
        
        function editPrize(id) {
            const prize = allPrizes.find(p => p.id === id);
            if (prize) showPrizeModal(prize);
        }
        
        function previewPrizeImage(input) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    const preview = document.getElementById('prize-image-preview');
                    preview.src = e.target.result;
                    preview.style.display = 'block';
                };
                reader.readAsDataURL(input.files[0]);
            }
        }
        
        async function savePrize() {
            const id = document.getElementById('prize-id').value;
            const name = document.getElementById('prize-name').value;
            const description = document.getElementById('prize-description').value;
            const active = document.getElementById('prize-active').checked;
            const imageFile = document.getElementById('prize-image').files[0];
            
            if (!name) { showToast('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ø¬Ø§Ø¦Ø²Ø©', 'error'); return; }
            
            try {
                let imagePath = null;
                
                // Upload image if selected
                if (imageFile) {
                    const formData = new FormData();
                    formData.append('image', imageFile);
                    const uploadRes = await fetch('/api/admin/upload', {
                        method: 'POST',
                        headers: { 'Authorization': 'Bearer ' + token },
                        body: formData
                    });
                    const uploadData = await uploadRes.json();
                    if (uploadData.success) imagePath = uploadData.path;
                }
                
                const url = id ? `/api/admin/prizes/${id}` : '/api/admin/prizes';
                const method = id ? 'PUT' : 'POST';
                
                const body = { name, description, active };
                if (imagePath) body.image = imagePath;
                
                const res = await fetch(url, {
                    method,
                    headers: { 'Content-Type': 'application/json', 'Authorization': 'Bearer ' + token },
                    body: JSON.stringify(body)
                });
                
                if (res.ok) {
                    showToast(t('success'), 'success');
                    closeModal('modal-prize');
                    loadPrizes();
                } else {
                    showToast(t('error'), 'error');
                }
            } catch (err) { console.error(err); showToast(t('error'), 'error'); }
        }
        
        async function togglePrize(id) {
            try {
                await fetch(`/api/admin/prizes/${id}/toggle`, {
                    method: 'PATCH',
                    headers: { 'Authorization': 'Bearer ' + token }
                });
                loadPrizes();
            } catch (err) { showToast(t('error'), 'error'); }
        }
        
        async function deletePrize(id) {
            showConfirm('Ø­Ø°Ù Ø§Ù„Ø¬Ø§Ø¦Ø²Ø©', 'Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ø¬Ø§Ø¦Ø²Ø©ØŸ', async () => {
                try {
                    await fetch(`/api/admin/prizes/${id}`, {
                        method: 'DELETE',
                        headers: { 'Authorization': 'Bearer ' + token }
                    });
                    showToast(t('success'), 'success');
                    loadPrizes();
                } catch (err) { showToast(t('error'), 'error'); }
            });
        }

        // ============== Announcements Management ==============
        let allAnnouncements = [];
        
        async function loadAnnouncements() {
            try {
                const res = await fetch('/api/admin/announcements', { headers: { 'Authorization': 'Bearer ' + token } });
                allAnnouncements = await res.json();
                renderAnnouncements();
            } catch (err) { console.error(err); showToast(t('error'), 'error'); }
        }
        
        function renderAnnouncements() {
            const priorityLabels = ['Ø¹Ø§Ø¯ÙŠ', 'Ù…ØªÙˆØ³Ø·', 'Ø¹Ø§Ù„ÙŠ', 'ğŸ”¥ Ø¹Ø§Ø¬Ù„'];
            const priorityColors = ['var(--text-muted)', 'var(--info)', 'var(--warning)', 'var(--danger)'];
            const typeLabels = { info: 'ğŸ“¢ Ø¥Ø¹Ù„Ø§Ù†', urgent: 'ğŸ”¥ Ø¹Ø§Ø¬Ù„', promo: 'ğŸ Ø¹Ø±Ø¶', new: 'âœ¨ Ø¬Ø¯ÙŠØ¯' };
            
            const tbody = document.getElementById('announcements-table');
            tbody.innerHTML = allAnnouncements.map((a, i) => `
                <tr>
                    <td>${i + 1}</td>
                    <td>
                        ${a.image ? `<img src="${a.image}" style="width:40px;height:40px;object-fit:cover;border-radius:6px;margin-left:10px;vertical-align:middle;">` : ''}
                        <strong>${a.title || 'Ø¨Ø¯ÙˆÙ† Ø¹Ù†ÙˆØ§Ù†'}</strong><br>
                        <small style="color:var(--text-muted);max-width:200px;display:inline-block;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;">${a.text}</small>
                    </td>
                    <td><span style="background:var(--tertiary);padding:3px 10px;border-radius:15px;font-size:0.8rem;">${typeLabels[a.type] || typeLabels.info}</span></td>
                    <td>${a.link ? `<a href="${a.link}" target="_blank" style="color:var(--info)">ğŸ”— Ø±Ø§Ø¨Ø·</a>` : '-'}</td>
                    <td><span style="color:${priorityColors[a.priority || 0]}">${priorityLabels[a.priority || 0]}</span></td>
                    <td><span class="status status-${a.active ? 'active' : 'inactive'}">${a.active ? 'ÙØ¹Ø§Ù„' : 'Ù…ÙˆÙ‚Ù'}</span></td>
                    <td>
                        <button class="btn btn-sm btn-icon btn-secondary" onclick="editAnnouncement(${a.id})">âœï¸</button>
                        <button class="btn btn-sm btn-icon ${a.active ? 'btn-warning' : 'btn-success'}" onclick="toggleAnnouncement(${a.id})">${a.active ? 'â¸ï¸' : 'â–¶ï¸'}</button>
                        <button class="btn btn-sm btn-icon btn-danger" onclick="deleteAnnouncement(${a.id})">ğŸ—‘ï¸</button>
                    </td>
                </tr>
            `).join('') || '<tr><td colspan="7" style="text-align:center;color:var(--text-muted)">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¥Ø¹Ù„Ø§Ù†Ø§Øª</td></tr>';
        }
        
        function previewAnnouncementImage(input) {
            const preview = document.getElementById('announcement-image-preview');
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    preview.src = e.target.result;
                    preview.style.display = 'block';
                };
                reader.readAsDataURL(input.files[0]);
            } else {
                preview.style.display = 'none';
            }
        }
        
        function showAnnouncementModal(announcement = null) {
            document.getElementById('announcement-modal-title').textContent = announcement ? 'ØªØ¹Ø¯ÙŠÙ„ Ø¥Ø¹Ù„Ø§Ù†' : 'Ø¥Ø¹Ù„Ø§Ù† Ø¬Ø¯ÙŠØ¯';
            document.getElementById('announcement-id').value = announcement?.id || '';
            document.getElementById('announcement-title').value = announcement?.title || '';
            document.getElementById('announcement-text').value = announcement?.text || '';
            document.getElementById('announcement-type').value = announcement?.type || 'info';
            document.getElementById('announcement-link').value = announcement?.link || '';
            document.getElementById('announcement-priority').value = announcement?.priority || '0';
            document.getElementById('announcement-active').checked = announcement?.active !== false;
            document.getElementById('announcement-expires').value = announcement?.expires_at ? announcement.expires_at.slice(0, 16) : '';
            
            const preview = document.getElementById('announcement-image-preview');
            if (announcement?.image) {
                preview.src = announcement.image;
                preview.style.display = 'block';
            } else {
                preview.style.display = 'none';
            }
            document.getElementById('announcement-image').value = '';
            
            openModal('modal-announcement');
        }
        
        function editAnnouncement(id) {
            const announcement = allAnnouncements.find(a => a.id === id);
            if (announcement) showAnnouncementModal(announcement);
        }
        
        async function saveAnnouncement() {
            const id = document.getElementById('announcement-id').value;
            const title = document.getElementById('announcement-title').value;
            const text = document.getElementById('announcement-text').value;
            const type = document.getElementById('announcement-type').value;
            const link = document.getElementById('announcement-link').value;
            const priority = parseInt(document.getElementById('announcement-priority').value);
            const active = document.getElementById('announcement-active').checked;
            const expires = document.getElementById('announcement-expires').value;
            const imageInput = document.getElementById('announcement-image');
            
            if (!title || !text) { showToast('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ÙˆØ§Ù„Ù†Øµ', 'error'); return; }
            
            // Handle image upload
            let imageBase64 = null;
            if (imageInput.files && imageInput.files[0]) {
                imageBase64 = await new Promise((resolve) => {
                    const reader = new FileReader();
                    reader.onload = (e) => resolve(e.target.result);
                    reader.readAsDataURL(imageInput.files[0]);
                });
            }
            
            try {
                const url = id ? `/api/admin/announcements/${id}` : '/api/admin/announcements';
                const method = id ? 'PUT' : 'POST';
                
                const body = { title, text, type, link, priority, active };
                if (imageBase64) body.image = imageBase64;
                if (expires) body.expires_at = expires;
                
                const res = await fetch(url, {
                    method,
                    headers: { 'Content-Type': 'application/json', 'Authorization': 'Bearer ' + token },
                    body: JSON.stringify(body)
                });
                
                if (res.ok) {
                    showToast(t('success'), 'success');
                    closeModal('modal-announcement');
                    loadAnnouncements();
                } else {
                    showToast(t('error'), 'error');
                }
            } catch (err) { console.error(err); showToast(t('error'), 'error'); }
        }
        
        async function toggleAnnouncement(id) {
            try {
                await fetch(`/api/admin/announcements/${id}/toggle`, {
                    method: 'PATCH',
                    headers: { 'Authorization': 'Bearer ' + token }
                });
                loadAnnouncements();
            } catch (err) { showToast(t('error'), 'error'); }
        }
        
        async function deleteAnnouncement(id) {
            showConfirm('Ø­Ø°Ù Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†', 'Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†ØŸ', async () => {
                try {
                    await fetch(`/api/admin/announcements/${id}`, {
                        method: 'DELETE',
                        headers: { 'Authorization': 'Bearer ' + token }
                    });
                    showToast(t('success'), 'success');
                    loadAnnouncements();
                } catch (err) { showToast(t('error'), 'error'); }
            });
        }

        // ============== Branches Management ==============
        let allBranches = [];
        
        async function loadBranches() {
            try {
                const res = await fetch('/api/admin/branches', { headers: { 'Authorization': 'Bearer ' + token } });
                allBranches = await res.json();
                renderBranches();
                
                // Populate province dropdown
                const select = document.getElementById('branch-province');
                if (select && select.options.length <= 1) {
                    provinces.forEach(p => {
                        const opt = document.createElement('option');
                        opt.value = p;
                        opt.textContent = p;
                        select.appendChild(opt);
                    });
                }
            } catch (err) { console.error(err); showToast(t('error'), 'error'); }
        }
        
        function renderBranches() {
            const tbody = document.getElementById('branches-table');
            tbody.innerHTML = allBranches.map((b, i) => `
                <tr>
                    <td>${i + 1}</td>
                    <td><strong>${b.name}</strong></td>
                    <td style="max-width:200px;overflow:hidden;text-overflow:ellipsis;">${b.location || '-'}</td>
                    <td>${b.province}</td>
                    <td dir="ltr">${b.phone}</td>
                    <td><span class="status status-${b.active ? 'active' : 'inactive'}">${b.active ? 'ÙØ¹Ø§Ù„' : 'Ù…ÙˆÙ‚Ù'}</span></td>
                    <td>
                        <button class="btn btn-sm btn-icon btn-secondary" onclick="editBranch(${b.id})">âœï¸</button>
                        <button class="btn btn-sm btn-icon ${b.active ? 'btn-warning' : 'btn-success'}" onclick="toggleBranch(${b.id})">${b.active ? 'â¸ï¸' : 'â–¶ï¸'}</button>
                        <button class="btn btn-sm btn-icon btn-danger" onclick="deleteBranch(${b.id})">ğŸ—‘ï¸</button>
                    </td>
                </tr>
            `).join('') || '<tr><td colspan="7" style="text-align:center;color:var(--text-muted)">Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙØ±ÙˆØ¹</td></tr>';
        }
        
        function showBranchModal(branch = null) {
            document.getElementById('branch-modal-title').textContent = branch ? 'ØªØ¹Ø¯ÙŠÙ„ ÙØ±Ø¹' : 'Ø¥Ø¶Ø§ÙØ© ÙØ±Ø¹';
            document.getElementById('branch-id').value = branch?.id || '';
            document.getElementById('branch-name').value = branch?.name || '';
            document.getElementById('branch-province').value = branch?.province || '';
            document.getElementById('branch-location').value = branch?.location || '';
            document.getElementById('branch-phone').value = branch?.phone || '';
            document.getElementById('branch-password').value = '';
            document.getElementById('branch-active').checked = branch?.active !== false;
            openModal('modal-branch');
        }
        
        function editBranch(id) {
            const branch = allBranches.find(b => b.id === id);
            if (branch) showBranchModal(branch);
        }
        
        async function saveBranch() {
            const id = document.getElementById('branch-id').value;
            const name = document.getElementById('branch-name').value;
            const province = document.getElementById('branch-province').value;
            const location = document.getElementById('branch-location').value;
            const phone = document.getElementById('branch-phone').value;
            const password = document.getElementById('branch-password').value;
            const active = document.getElementById('branch-active').checked;
            
            if (!name || !province || !phone) {
                showToast('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©', 'error');
                return;
            }
            
            if (!id && !password) {
                showToast('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ù„Ù„ÙØ±Ø¹ Ø§Ù„Ø¬Ø¯ÙŠØ¯', 'error');
                return;
            }
            
            try {
                const url = id ? `/api/admin/branches/${id}` : '/api/admin/branches';
                const method = id ? 'PUT' : 'POST';
                
                const body = { name, province, location, phone, active };
                if (password) body.password = password;
                
                const res = await fetch(url, {
                    method,
                    headers: { 'Content-Type': 'application/json', 'Authorization': 'Bearer ' + token },
                    body: JSON.stringify(body)
                });
                
                if (res.ok) {
                    showToast(t('success'), 'success');
                    closeModal('modal-branch');
                    loadBranches();
                } else {
                    const data = await res.json();
                    showToast(data.error || t('error'), 'error');
                }
            } catch (err) { console.error(err); showToast(t('error'), 'error'); }
        }
        
        async function toggleBranch(id) {
            try {
                await fetch(`/api/admin/branches/${id}/toggle`, {
                    method: 'PATCH',
                    headers: { 'Authorization': 'Bearer ' + token }
                });
                loadBranches();
            } catch (err) { showToast(t('error'), 'error'); }
        }
        
        async function deleteBranch(id) {
            showConfirm('Ø­Ø°Ù Ø§Ù„ÙØ±Ø¹', 'Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„ÙØ±Ø¹ØŸ', async () => {
                try {
                    await fetch(`/api/admin/branches/${id}`, {
                        method: 'DELETE',
                        headers: { 'Authorization': 'Bearer ' + token }
                    });
                    showToast(t('success'), 'success');
                    loadBranches();
                } catch (err) { showToast(t('error'), 'error'); }
            });
        }

        // ============== Coupons Management ==============
        let allCoupons = [];
        
        async function loadCoupons() {
            try {
                const res = await fetch('/api/admin/coupons', { headers: { 'Authorization': 'Bearer ' + token } });
                allCoupons = await res.json();
                renderCoupons();
            } catch (err) { console.error(err); showToast(t('error'), 'error'); }
        }
        
        function renderCoupons() {
            // Render coupon cards
            const cardsContainer = document.getElementById('coupons-cards');
            if (cardsContainer) {
                cardsContainer.innerHTML = allCoupons.filter(c => c.active).slice(0, 3).map(c => `
                    <div class="coupon-card" style="background:linear-gradient(135deg,var(--accent),var(--accent-light));padding:20px;border-radius:15px;min-width:200px;">
                        <div style="font-size:0.8rem;opacity:0.8;">ÙƒÙˆØ¨ÙˆÙ† Ù…Ù…ÙŠØ²</div>
                        <div style="font-family:monospace;font-size:1.5rem;font-weight:bold;margin:10px 0;letter-spacing:2px;">${c.code}</div>
                        <div style="font-size:1.1rem;">+${c.discount_value} Ù†Ù‚Ø·Ø©</div>
                        <div style="font-size:0.75rem;margin-top:10px;opacity:0.8;">${c.expires_at ? 'ØµØ§Ù„Ø­ Ø­ØªÙ‰: ' + new Date(c.expires_at).toLocaleDateString('ar-IQ') : 'Ø¨Ø¯ÙˆÙ† Ø§Ù†ØªÙ‡Ø§Ø¡'}</div>
                    </div>
                `).join('') || '<p style="color:var(--text-muted)">Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙƒÙˆØ¨ÙˆÙ†Ø§Øª ÙØ¹Ø§Ù„Ø©</p>';
            }
            
            // Render table
            const tbody = document.getElementById('coupons-table');
            tbody.innerHTML = allCoupons.map((c, i) => `
                <tr>
                    <td>${i + 1}</td>
                    <td><strong style="font-family:monospace;letter-spacing:1px;">${c.code}</strong></td>
                    <td><span style="color:var(--gold);">+${c.discount_value}</span></td>
                    <td>${c.used_count}</td>
                    <td>${c.max_uses}</td>
                    <td>${c.expires_at ? new Date(c.expires_at).toLocaleDateString('ar-IQ') : 'âˆ'}</td>
                    <td><span class="status status-${c.active ? 'active' : 'inactive'}">${c.active ? 'ÙØ¹Ø§Ù„' : 'Ù…ÙˆÙ‚Ù'}</span></td>
                    <td>
                        <button class="btn btn-sm btn-icon btn-secondary" onclick="editCoupon(${c.id})">âœï¸</button>
                        <button class="btn btn-sm btn-icon ${c.active ? 'btn-warning' : 'btn-success'}" onclick="toggleCoupon(${c.id})">${c.active ? 'â¸ï¸' : 'â–¶ï¸'}</button>
                        <button class="btn btn-sm btn-icon btn-danger" onclick="deleteCoupon(${c.id})">ğŸ—‘ï¸</button>
                    </td>
                </tr>
            `).join('') || '<tr><td colspan="8" style="text-align:center;color:var(--text-muted)">Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙƒÙˆØ¨ÙˆÙ†Ø§Øª</td></tr>';
        }
        
        function showCouponModal(coupon = null) {
            document.getElementById('coupon-modal-title').textContent = coupon ? 'ØªØ¹Ø¯ÙŠÙ„ ÙƒÙˆØ¨ÙˆÙ†' : 'ÙƒÙˆØ¨ÙˆÙ† Ø¬Ø¯ÙŠØ¯';
            document.getElementById('coupon-id').value = coupon?.id || '';
            document.getElementById('coupon-code').value = coupon?.code || '';
            document.getElementById('coupon-type').value = coupon?.discount_type || 'points';
            document.getElementById('coupon-value').value = coupon?.discount_value || 100;
            document.getElementById('coupon-max-uses').value = coupon?.max_uses || 100;
            document.getElementById('coupon-min-score').value = coupon?.min_score || 0;
            document.getElementById('coupon-expires').value = coupon?.expires_at ? new Date(coupon.expires_at).toISOString().slice(0, 16) : '';
            document.getElementById('coupon-active').checked = coupon?.active !== false;
            openModal('modal-coupon');
        }
        
        function editCoupon(id) {
            const coupon = allCoupons.find(c => c.id === id);
            if (coupon) showCouponModal(coupon);
        }
        
        async function saveCoupon() {
            const id = document.getElementById('coupon-id').value;
            const code = document.getElementById('coupon-code').value.toUpperCase();
            const discount_type = document.getElementById('coupon-type').value;
            const discount_value = parseInt(document.getElementById('coupon-value').value);
            const max_uses = parseInt(document.getElementById('coupon-max-uses').value);
            const min_score = parseInt(document.getElementById('coupon-min-score').value) || 0;
            const expires_at = document.getElementById('coupon-expires').value || null;
            const active = document.getElementById('coupon-active').checked;
            
            if (!code || !discount_value) {
                showToast('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©', 'error');
                return;
            }
            
            try {
                const url = id ? `/api/admin/coupons/${id}` : '/api/admin/coupons';
                const method = id ? 'PUT' : 'POST';
                
                const res = await fetch(url, {
                    method,
                    headers: { 'Content-Type': 'application/json', 'Authorization': 'Bearer ' + token },
                    body: JSON.stringify({ code, discount_type, discount_value, max_uses, min_score, expires_at, active })
                });
                
                const data = await res.json();
                if (data.error) {
                    showToast(data.error, 'error');
                } else {
                    showToast(t('success'), 'success');
                    closeModal('modal-coupon');
                    loadCoupons();
                }
            } catch (err) { console.error(err); showToast(t('error'), 'error'); }
        }
        
        async function toggleCoupon(id) {
            try {
                await fetch(`/api/admin/coupons/${id}/toggle`, {
                    method: 'PATCH',
                    headers: { 'Authorization': 'Bearer ' + token }
                });
                loadCoupons();
            } catch (err) { showToast(t('error'), 'error'); }
        }
        
        async function deleteCoupon(id) {
            showConfirm('Ø­Ø°Ù Ø§Ù„ÙƒÙˆØ¨ÙˆÙ†', 'Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„ÙƒÙˆØ¨ÙˆÙ†ØŸ', async () => {
                try {
                    await fetch(`/api/admin/coupons/${id}`, {
                        method: 'DELETE',
                        headers: { 'Authorization': 'Bearer ' + token }
                    });
                    showToast(t('success'), 'success');
                    loadCoupons();
                } catch (err) { showToast(t('error'), 'error'); }
            });
        }

        // ============== Referrals Management ==============
        async function loadReferrals() {
            try {
                const res = await fetch('/api/admin/referrals', { headers: { 'Authorization': 'Bearer ' + token } });
                const data = await res.json();
                
                // Update stats
                document.getElementById('ref-total').textContent = data.stats?.total || 0;
                document.getElementById('ref-completed').textContent = data.stats?.completed || 0;
                document.getElementById('ref-bonus').textContent = data.stats?.total_bonus_given || 0;
                
                // Render table
                const tbody = document.getElementById('referrals-table');
                tbody.innerHTML = (data.referrals || []).map((r, i) => `
                    <tr>
                        <td>${i + 1}</td>
                        <td><strong>${r.referrer_name || r.referrer_phone}</strong></td>
                        <td>${r.referred_name || r.referred_phone}</td>
                        <td style="color:var(--success);">+${r.referrer_bonus}</td>
                        <td style="color:var(--info);">+${r.referred_bonus}</td>
                        <td><span class="status status-${r.status === 'completed' ? 'active' : 'pending'}">${r.status === 'completed' ? 'Ù…ÙƒØªÙ…Ù„' : 'Ù…Ø¹Ù„Ù‚'}</span></td>
                        <td>${formatDate(r.created_at)}</td>
                    </tr>
                `).join('') || '<tr><td colspan="7" style="text-align:center;color:var(--text-muted)">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¥Ø­Ø§Ù„Ø§Øª</td></tr>';
            } catch (err) { console.error(err); showToast(t('error'), 'error'); }
        }
        
        async function saveReferralSettings() {
            const referrer_bonus = parseInt(document.getElementById('ref-referrer-bonus').value);
            const referred_bonus = parseInt(document.getElementById('ref-referred-bonus').value);
            
            try {
                await fetch('/api/admin/referral-settings', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json', 'Authorization': 'Bearer ' + token },
                    body: JSON.stringify({ referrer_bonus, referred_bonus, enabled: true })
                });
                showToast(t('success'), 'success');
            } catch (err) { showToast(t('error'), 'error'); }
        }

        // ============== WhatsApp Functions ==============
        async function saveWhatsAppSettings() {
            const apiUrl = document.getElementById('wa-api-url').value;
            const apiKey = document.getElementById('wa-api-key').value;
            const template = document.getElementById('wa-winner-template').value;
            
            try {
                await fetch('/api/admin/settings', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json', 'Authorization': 'Bearer ' + token },
                    body: JSON.stringify({ 
                        settings: {
                            whatsapp_api_url: apiUrl,
                            whatsapp_api_key: apiKey,
                            winner_message_template: template
                        }
                    })
                });
                showToast(t('success'), 'success');
            } catch (err) { showToast(t('error'), 'error'); }
        }
        
        async function sendTestWhatsApp() {
            const phone = document.getElementById('wa-test-phone').value;
            const message = document.getElementById('wa-test-message').value;
            
            if (!phone || !message) {
                showToast('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø±Ù‚Ù… ÙˆØ§Ù„Ø±Ø³Ø§Ù„Ø©', 'error');
                return;
            }
            
            try {
                const res = await fetch('/api/admin/send-whatsapp', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json', 'Authorization': 'Bearer ' + token },
                    body: JSON.stringify({ phone, message })
                });
                const data = await res.json();
                if (data.success) {
                    showToast('ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø©', 'success');
                } else {
                    showToast(data.error || 'ÙØ´Ù„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„', 'error');
                }
            } catch (err) { showToast('ÙØ´Ù„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„', 'error'); }
        }

        // ============== Daily Goals Management ==============
        let allGoals = [];
        
        async function loadGoals() {
            try {
                const res = await fetch('/api/admin/goals', { headers: { 'Authorization': 'Bearer ' + token } });
                const data = await res.json();
                allGoals = data.goals || [];
                renderGoals();
                
                // Update stats
                if (data.stats) {
                    document.getElementById('goals-completed-today').textContent = data.stats.completed_today || 0;
                    document.getElementById('goals-rewards-today').textContent = data.stats.rewards_today || 0;
                    document.getElementById('goals-players-today').textContent = data.stats.active_players || 0;
                }
            } catch (err) { 
                console.error(err);
                renderGoals(); // Render empty/demo
            }
        }
        
        function renderGoals() {
            const container = document.getElementById('goals-list');
            if (!container) return;
            
            if (allGoals.length === 0) {
                // Show demo goals
                container.innerHTML = `
                    <div class="setting-row" style="padding:15px;background:var(--tertiary);border-radius:10px;margin-bottom:10px;">
                        <div style="display:flex;align-items:center;gap:15px;">
                            <span style="font-size:2rem;">ğŸ¯</span>
                            <div>
                                <h4>Ø§Ø¬Ù…Ø¹ 500 Ù†Ù‚Ø·Ø©</h4>
                                <p style="color:var(--text-muted);font-size:0.85rem;">Ø§Ø­ØµÙ„ Ø¹Ù„Ù‰ 500 Ù†Ù‚Ø·Ø© ÙÙŠ ÙŠÙˆÙ… ÙˆØ§Ø­Ø¯</p>
                            </div>
                        </div>
                        <div style="text-align:center;">
                            <div style="color:var(--gold);font-weight:bold;">+100 Ù†Ù‚Ø·Ø©</div>
                            <span class="status status-active">ÙØ¹Ø§Ù„</span>
                        </div>
                    </div>
                    <div class="setting-row" style="padding:15px;background:var(--tertiary);border-radius:10px;margin-bottom:10px;">
                        <div style="display:flex;align-items:center;gap:15px;">
                            <span style="font-size:2rem;">ğŸ®</span>
                            <div>
                                <h4>Ø§Ù„Ø¹Ø¨ 3 Ø£Ù„Ø¹Ø§Ø¨</h4>
                                <p style="color:var(--text-muted);font-size:0.85rem;">Ø£ÙƒÙ…Ù„ 3 Ø£Ù„Ø¹Ø§Ø¨ ÙÙŠ ÙŠÙˆÙ… ÙˆØ§Ø­Ø¯</p>
                            </div>
                        </div>
                        <div style="text-align:center;">
                            <div style="color:var(--gold);font-weight:bold;">+50 Ù†Ù‚Ø·Ø©</div>
                            <span class="status status-active">ÙØ¹Ø§Ù„</span>
                        </div>
                    </div>
                    <div class="setting-row" style="padding:15px;background:var(--tertiary);border-radius:10px;margin-bottom:10px;">
                        <div style="display:flex;align-items:center;gap:15px;">
                            <span style="font-size:2rem;">ğŸ”¥</span>
                            <div>
                                <h4>Ø³Ù„Ø³Ù„Ø© 3 Ø£ÙŠØ§Ù…</h4>
                                <p style="color:var(--text-muted);font-size:0.85rem;">Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„ 3 Ø£ÙŠØ§Ù… Ù…ØªØªØ§Ù„ÙŠØ©</p>
                            </div>
                        </div>
                        <div style="text-align:center;">
                            <div style="color:var(--gold);font-weight:bold;">+200 Ù†Ù‚Ø·Ø©</div>
                            <span class="status status-active">ÙØ¹Ø§Ù„</span>
                        </div>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = allGoals.map(g => `
                <div class="setting-row" style="padding:15px;background:var(--tertiary);border-radius:10px;margin-bottom:10px;">
                    <div style="display:flex;align-items:center;gap:15px;">
                        <span style="font-size:2rem;">${g.icon || 'ğŸ¯'}</span>
                        <div>
                            <h4>${g.title}</h4>
                            <p style="color:var(--text-muted);font-size:0.85rem;">${g.description || ''}</p>
                        </div>
                    </div>
                    <div style="display:flex;align-items:center;gap:15px;">
                        <div style="text-align:center;">
                            <div style="color:var(--gold);font-weight:bold;">+${g.reward} Ù†Ù‚Ø·Ø©</div>
                            <span class="status status-${g.active ? 'active' : 'inactive'}">${g.active ? 'ÙØ¹Ø§Ù„' : 'Ù…ÙˆÙ‚Ù'}</span>
                        </div>
                        <button class="btn btn-sm btn-icon btn-secondary" onclick="editGoal(${g.id})">âœï¸</button>
                        <button class="btn btn-sm btn-icon btn-danger" onclick="deleteGoal(${g.id})">ğŸ—‘ï¸</button>
                    </div>
                </div>
            `).join('');
        }
        
        function showGoalModal(goal = null) {
            document.getElementById('goal-modal-title').textContent = goal ? 'ØªØ¹Ø¯ÙŠÙ„ Ù‡Ø¯Ù' : 'Ù‡Ø¯Ù Ø¬Ø¯ÙŠØ¯';
            document.getElementById('goal-id').value = goal?.id || '';
            document.getElementById('goal-title').value = goal?.title || '';
            document.getElementById('goal-description').value = goal?.description || '';
            document.getElementById('goal-type').value = goal?.type || 'score';
            document.getElementById('goal-target').value = goal?.target || 500;
            document.getElementById('goal-reward').value = goal?.reward || 100;
            document.getElementById('goal-icon').value = goal?.icon || 'ğŸ¯';
            document.getElementById('goal-active').checked = goal?.active !== false;
            openModal('modal-goal');
        }
        
        function editGoal(id) {
            const goal = allGoals.find(g => g.id === id);
            if (goal) showGoalModal(goal);
        }
        
        async function saveGoal() {
            const id = document.getElementById('goal-id').value;
            const title = document.getElementById('goal-title').value;
            const description = document.getElementById('goal-description').value;
            const type = document.getElementById('goal-type').value;
            const target = parseInt(document.getElementById('goal-target').value);
            const reward = parseInt(document.getElementById('goal-reward').value);
            const icon = document.getElementById('goal-icon').value;
            const active = document.getElementById('goal-active').checked;
            
            if (!title) {
                showToast('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù‡Ø¯Ù', 'error');
                return;
            }
            
            try {
                const url = id ? `/api/admin/goals/${id}` : '/api/admin/goals';
                const method = id ? 'PUT' : 'POST';
                
                const res = await fetch(url, {
                    method,
                    headers: { 'Content-Type': 'application/json', 'Authorization': 'Bearer ' + token },
                    body: JSON.stringify({ title, description, type, target, reward, icon, active })
                });
                
                if (res.ok) {
                    showToast(t('success'), 'success');
                    closeModal('modal-goal');
                    loadGoals();
                } else {
                    showToast(t('error'), 'error');
                }
            } catch (err) { 
                console.error(err);
                showToast('ØªÙ… Ø§Ù„Ø­ÙØ¸ Ù…Ø­Ù„ÙŠØ§Ù‹', 'success');
                closeModal('modal-goal');
            }
        }
        
        async function deleteGoal(id) {
            showConfirm('Ø­Ø°Ù Ø§Ù„Ù‡Ø¯Ù', 'Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù‡Ø¯ÙØŸ', async () => {
                try {
                    await fetch(`/api/admin/goals/${id}`, {
                        method: 'DELETE',
                        headers: { 'Authorization': 'Bearer ' + token }
                    });
                    showToast(t('success'), 'success');
                    loadGoals();
                } catch (err) { showToast(t('error'), 'error'); }
            });
        }

        // ============== Contest Scheduling ==============
        let scheduledDraws = [];
        
        function loadContestSettings() {
            loadSettings();
            loadScheduledDraws();
            updateContestStatus();
        }
        
        function updateContestStatus() {
            const banner = document.getElementById('contest-status-banner');
            if (!banner) return;
            
            const startDate = document.getElementById('set-start-date')?.value;
            const endDate = document.getElementById('set-end-date')?.value;
            const now = new Date();
            
            let status = 'pending';
            let message = 'Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø© ØºÙŠØ± Ù…Ø¬Ø¯ÙˆÙ„Ø©';
            let color = 'var(--text-muted)';
            
            if (startDate && endDate) {
                const start = new Date(startDate);
                const end = new Date(endDate);
                
                if (now < start) {
                    status = 'upcoming';
                    message = `Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø© ØªØ¨Ø¯Ø£ ÙÙŠ ${start.toLocaleDateString('ar-IQ')}`;
                    color = 'var(--info)';
                } else if (now >= start && now <= end) {
                    status = 'active';
                    const remaining = Math.ceil((end - now) / (1000 * 60 * 60 * 24));
                    message = `Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø© Ø¬Ø§Ø±ÙŠØ© - Ù…ØªØ¨Ù‚ÙŠ ${remaining} ÙŠÙˆÙ…`;
                    color = 'var(--success)';
                } else {
                    status = 'ended';
                    message = 'Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø© Ø§Ù†ØªÙ‡Øª';
                    color = 'var(--danger)';
                }
            }
            
            banner.style.background = `linear-gradient(135deg, ${color}20, ${color}10)`;
            banner.style.border = `1px solid ${color}50`;
            banner.innerHTML = `
                <div class="info">
                    <h4 style="color:${color};">${status === 'active' ? 'ğŸŸ¢' : status === 'upcoming' ? 'ğŸŸ¡' : 'ğŸ”´'} ${message}</h4>
                </div>
            `;
        }
        
        async function loadScheduledDraws() {
            try {
                const res = await fetch('/api/admin/scheduled-draws', { headers: { 'Authorization': 'Bearer ' + token } });
                scheduledDraws = await res.json();
                renderScheduledDraws();
            } catch (err) {
                console.error(err);
                renderScheduledDraws();
            }
        }
        
        function renderScheduledDraws() {
            const tbody = document.getElementById('scheduled-draws-table');
            if (!tbody) return;
            
            if (scheduledDraws.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" style="text-align:center;color:var(--text-muted)">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø³Ø­ÙˆØ¨Ø§Øª Ù…Ø¬Ø¯ÙˆÙ„Ø©</td></tr>';
                return;
            }
            
            tbody.innerHTML = scheduledDraws.map((d, i) => {
                const drawDate = new Date(d.draw_at);
                const isPast = drawDate < new Date();
                return `
                    <tr>
                        <td>${i + 1}</td>
                        <td>${drawDate.toLocaleString('ar-IQ')}</td>
                        <td>${d.winners_count}</td>
                        <td><span class="status status-${d.executed ? 'active' : isPast ? 'inactive' : 'pending'}">${d.executed ? 'ØªÙ… Ø§Ù„ØªÙ†ÙÙŠØ°' : isPast ? 'ÙØ§Øª Ø§Ù„Ù…ÙˆØ¹Ø¯' : 'ÙÙŠ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±'}</span></td>
                        <td>
                            ${!d.executed ? `<button class="btn btn-sm btn-icon btn-danger" onclick="cancelScheduledDraw(${d.id})">ğŸ—‘ï¸</button>` : ''}
                        </td>
                    </tr>
                `;
            }).join('');
        }
        
        function scheduleNewDraw() {
            // Set default to tomorrow at 9 PM
            const tomorrow = new Date();
            tomorrow.setDate(tomorrow.getDate() + 1);
            tomorrow.setHours(21, 0, 0, 0);
            document.getElementById('schedule-datetime').value = tomorrow.toISOString().slice(0, 16);
            document.getElementById('schedule-winners').value = 1;
            openModal('modal-schedule-draw');
        }
        
        async function confirmScheduleDraw() {
            const datetime = document.getElementById('schedule-datetime').value;
            const winners = parseInt(document.getElementById('schedule-winners').value);
            
            if (!datetime) {
                showToast('Ø§Ù„Ø±Ø¬Ø§Ø¡ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„ÙˆÙ‚Øª', 'error');
                return;
            }
            
            try {
                await fetch('/api/admin/scheduled-draws', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json', 'Authorization': 'Bearer ' + token },
                    body: JSON.stringify({ draw_at: datetime, winners_count: winners })
                });
                showToast('ØªÙ… Ø¬Ø¯ÙˆÙ„Ø© Ø§Ù„Ø³Ø­Ø¨ Ø¨Ù†Ø¬Ø§Ø­', 'success');
                closeModal('modal-schedule-draw');
                loadScheduledDraws();
            } catch (err) {
                showToast('ØªÙ… Ø§Ù„Ø¬Ø¯ÙˆÙ„Ø© Ù…Ø­Ù„ÙŠØ§Ù‹', 'success');
                closeModal('modal-schedule-draw');
            }
        }
        
        async function cancelScheduledDraw(id) {
            showConfirm('Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø³Ø­Ø¨', 'Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¥Ù„ØºØ§Ø¡ Ù‡Ø°Ø§ Ø§Ù„Ø³Ø­Ø¨ Ø§Ù„Ù…Ø¬Ø¯ÙˆÙ„ØŸ', async () => {
                try {
                    await fetch(`/api/admin/scheduled-draws/${id}`, {
                        method: 'DELETE',
                        headers: { 'Authorization': 'Bearer ' + token }
                    });
                    showToast(t('success'), 'success');
                    loadScheduledDraws();
                } catch (err) { showToast(t('error'), 'error'); }
            });
        }
        
        async function saveDrawSettings() {
            const frequency = document.getElementById('set-draw-frequency').value;
            const time = document.getElementById('set-draw-time').value;
            const winners = document.getElementById('set-draw-winners').value;
            
            try {
                await fetch('/api/admin/settings', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json', 'Authorization': 'Bearer ' + token },
                    body: JSON.stringify({
                        settings: {
                            draw_frequency: frequency,
                            draw_time: time,
                            draw_winners_count: winners
                        }
                    })
                });
                showToast(t('success'), 'success');
            } catch (err) { showToast(t('error'), 'error'); }
        }

        // ============== Other Functions ==============
        function viewPlayer(id) { showToast('Ù‚Ø±ÙŠØ¨Ø§Ù‹', 'info'); }
        function toggleUserMenu() {}
        
        // ============== Analytics ==============
        let peakHoursChartInstance = null;
        let devicesChartInstance = null;
        
        async function loadAnalytics() {
            try {
                const res = await fetch('/api/admin/analytics', { headers: { 'Authorization': 'Bearer ' + token } });
                const data = await res.json();
                
                // Update stats
                document.getElementById('analytics-mobile').textContent = (data.mobile_percent || 65) + '%';
                document.getElementById('analytics-desktop').textContent = (data.desktop_percent || 35) + '%';
                document.getElementById('analytics-return').textContent = (data.return_rate || 42) + '%';
                document.getElementById('analytics-peak').textContent = data.peak_hour || '21:00';
                
                // Update levels
                document.getElementById('level-bronze').textContent = data.levels?.bronze || 0;
                document.getElementById('level-silver').textContent = data.levels?.silver || 0;
                document.getElementById('level-gold').textContent = data.levels?.gold || 0;
                document.getElementById('level-diamond').textContent = data.levels?.diamond || 0;
                
                // Draw charts
                drawPeakHoursChart(data.hourly_stats);
                drawDevicesChart(data.mobile_percent, data.desktop_percent);
                
                // Populate province dropdown
                const select = document.getElementById('export-province');
                if (select && select.options.length <= 1) {
                    provinces.forEach(p => {
                        const opt = document.createElement('option');
                        opt.value = p;
                        opt.textContent = p;
                        select.appendChild(opt);
                    });
                }
            } catch (err) {
                console.error(err);
                // Use demo data
                document.getElementById('analytics-mobile').textContent = '65%';
                document.getElementById('analytics-desktop').textContent = '35%';
                document.getElementById('analytics-return').textContent = '42%';
                document.getElementById('analytics-peak').textContent = '21:00';
                drawPeakHoursChart();
                drawDevicesChart(65, 35);
            }
        }
        
        function drawPeakHoursChart(data) {
            const ctx = document.getElementById('peakHoursChart');
            if (!ctx) return;
            
            if (peakHoursChartInstance) peakHoursChartInstance.destroy();
            
            const hours = Array.from({length: 24}, (_, i) => `${i}:00`);
            const values = data || [5,3,2,1,1,2,4,8,15,20,25,30,35,32,28,35,40,45,50,55,48,35,20,10];
            
            peakHoursChartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: hours,
                    datasets: [{
                        label: 'Ø¹Ø¯Ø¯ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†',
                        data: values,
                        backgroundColor: values.map(v => v === Math.max(...values) ? 'rgba(233,69,96,0.9)' : 'rgba(233,69,96,0.4)'),
                        borderRadius: 5
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        y: { beginAtZero: true, grid: { color: 'rgba(255,255,255,0.1)' } },
                        x: { grid: { display: false } }
                    }
                }
            });
        }
        
        function drawDevicesChart(mobile, desktop) {
            const ctx = document.getElementById('devicesChart');
            if (!ctx) return;
            
            if (devicesChartInstance) devicesChartInstance.destroy();
            
            devicesChartInstance = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['ğŸ“± Ù…ÙˆØ¨Ø§ÙŠÙ„', 'ğŸ’» ÙƒÙ…Ø¨ÙŠÙˆØªØ±'],
                    datasets: [{
                        data: [mobile || 65, desktop || 35],
                        backgroundColor: ['#e94560', '#17a2b8']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { position: 'bottom', labels: { color: '#eaeaea' } } }
                }
            });
        }
        
        async function exportPhoneList() {
            const filter = document.getElementById('export-filter').value;
            const province = document.getElementById('export-province').value;
            
            try {
                const params = new URLSearchParams({ filter });
                if (province) params.append('province', province);
                
                const res = await fetch(`/api/admin/export-phones?${params}`, {
                    headers: { 'Authorization': 'Bearer ' + token }
                });
                const data = await res.json();
                
                if (data.phones && data.phones.length > 0) {
                    const csv = data.phones.join('\n');
                    const blob = new Blob([csv], { type: 'text/plain' });
                    const link = document.createElement('a');
                    link.href = URL.createObjectURL(blob);
                    link.download = `phones_${filter}_${new Date().toISOString().split('T')[0]}.txt`;
                    link.click();
                    showToast(`ØªÙ… ØªØµØ¯ÙŠØ± ${data.phones.length} Ø±Ù‚Ù…`, 'success');
                } else {
                    showToast('Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø£Ø±Ù‚Ø§Ù… Ù„Ù„ØªØµØ¯ÙŠØ±', 'warning');
                }
            } catch (err) {
                console.error(err);
                showToast('ÙØ´Ù„ Ø§Ù„ØªØµØ¯ÙŠØ±', 'error');
            }
        }

        // ============== Blocking ==============
        async function loadBlocking() {
            try {
                const res = await fetch('/api/admin/blocked', { headers: { 'Authorization': 'Bearer ' + token } });
                const data = await res.json();
                
                // Render blocked phones
                const phonesTable = document.getElementById('blocked-phones-table');
                if (phonesTable) {
                    phonesTable.innerHTML = (data.phones || []).map((b, i) => `
                        <tr>
                            <td>${i + 1}</td>
                            <td><strong dir="ltr">${b.value}</strong></td>
                            <td>${b.reason || '-'}</td>
                            <td>${formatDate(b.blocked_at)}</td>
                            <td>${b.blocked_by || '-'}</td>
                            <td><button class="btn btn-sm btn-success" onclick="unblock(${b.id}, 'phone')">âœ… Ø±ÙØ¹ Ø§Ù„Ø­Ø¸Ø±</button></td>
                        </tr>
                    `).join('') || '<tr><td colspan="6" style="text-align:center;color:var(--text-muted)">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø£Ø±Ù‚Ø§Ù… Ù…Ø­Ø¸ÙˆØ±Ø©</td></tr>';
                }
                
                // Render blocked IPs
                const ipsTable = document.getElementById('blocked-ips-table');
                if (ipsTable) {
                    ipsTable.innerHTML = (data.ips || []).map((b, i) => `
                        <tr>
                            <td>${i + 1}</td>
                            <td><strong dir="ltr">${b.value}</strong></td>
                            <td>${b.reason || '-'}</td>
                            <td>${formatDate(b.blocked_at)}</td>
                            <td>${b.blocked_by || '-'}</td>
                            <td><button class="btn btn-sm btn-success" onclick="unblock(${b.id}, 'ip')">âœ… Ø±ÙØ¹ Ø§Ù„Ø­Ø¸Ø±</button></td>
                        </tr>
                    `).join('') || '<tr><td colspan="6" style="text-align:center;color:var(--text-muted)">Ù„Ø§ ÙŠÙˆØ¬Ø¯ IPs Ù…Ø­Ø¸ÙˆØ±Ø©</td></tr>';
                }
                
                // Render cheat logs
                const cheatTable = document.getElementById('cheat-logs-table');
                if (cheatTable) {
                    const cheatRes = await fetch('/api/admin/cheat-logs', { headers: { 'Authorization': 'Bearer ' + token } });
                    const cheatData = await cheatRes.json();
                    
                    cheatTable.innerHTML = (cheatData || []).map(c => `
                        <tr>
                            <td dir="ltr">${c.phone}</td>
                            <td style="color:var(--danger);">${c.attempted_points}</td>
                            <td style="color:var(--success);">${c.allowed_points}</td>
                            <td>${c.attempted_points - c.allowed_points}</td>
                            <td>${formatDate(c.logged_at)}</td>
                            <td><button class="btn btn-sm btn-danger" onclick="blockFromCheat('${c.phone}')">ğŸš« Ø­Ø¸Ø±</button></td>
                        </tr>
                    `).join('') || '<tr><td colspan="6" style="text-align:center;color:var(--text-muted)">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø­Ø§ÙˆÙ„Ø§Øª ØºØ´</td></tr>';
                }
            } catch (err) {
                console.error(err);
            }
        }
        
        function showBlockModal(type) {
            document.getElementById('block-type').value = type;
            document.getElementById('block-modal-title').textContent = type === 'phone' ? 'Ø­Ø¸Ø± Ø±Ù‚Ù…' : 'Ø­Ø¸Ø± IP';
            document.getElementById('block-input-label').textContent = type === 'phone' ? 'Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ' : 'Ø¹Ù†ÙˆØ§Ù† IP';
            document.getElementById('block-value').placeholder = type === 'phone' ? '07XX XXX XXXX' : '192.168.1.1';
            document.getElementById('block-value').value = '';
            document.getElementById('block-notes').value = '';
            openModal('modal-block');
        }
        
        function blockFromCheat(phone) {
            document.getElementById('block-type').value = 'phone';
            document.getElementById('block-modal-title').textContent = 'Ø­Ø¸Ø± Ø±Ù‚Ù…';
            document.getElementById('block-input-label').textContent = 'Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ';
            document.getElementById('block-value').value = phone;
            document.getElementById('block-reason').value = 'cheating';
            openModal('modal-block');
        }
        
        async function confirmBlock() {
            const type = document.getElementById('block-type').value;
            const value = document.getElementById('block-value').value;
            const reason = document.getElementById('block-reason').value;
            const notes = document.getElementById('block-notes').value;
            
            if (!value) {
                showToast('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ù‚ÙŠÙ…Ø©', 'error');
                return;
            }
            
            try {
                await fetch('/api/admin/block', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json', 'Authorization': 'Bearer ' + token },
                    body: JSON.stringify({ type, value, reason, notes })
                });
                showToast('ØªÙ… Ø§Ù„Ø­Ø¸Ø± Ø¨Ù†Ø¬Ø§Ø­', 'success');
                closeModal('modal-block');
                loadBlocking();
            } catch (err) {
                showToast('ÙØ´Ù„ Ø§Ù„Ø­Ø¸Ø±', 'error');
            }
        }
        
        async function unblock(id, type) {
            showConfirm('Ø±ÙØ¹ Ø§Ù„Ø­Ø¸Ø±', 'Ù‡Ù„ ØªØ±ÙŠØ¯ Ø±ÙØ¹ Ø§Ù„Ø­Ø¸Ø±ØŸ', async () => {
                try {
                    await fetch(`/api/admin/unblock/${id}?type=${type}`, {
                        method: 'DELETE',
                        headers: { 'Authorization': 'Bearer ' + token }
                    });
                    showToast('ØªÙ… Ø±ÙØ¹ Ø§Ù„Ø­Ø¸Ø±', 'success');
                    loadBlocking();
                } catch (err) {
                    showToast('ÙØ´Ù„ Ø±ÙØ¹ Ø§Ù„Ø­Ø¸Ø±', 'error');
                }
            });
        }

        // ============== Lucky Wheel ==============
        let wheelPrizes = [];
        
        async function loadLuckyWheel() {
            try {
                const res = await fetch('/api/admin/wheel/settings', { headers: { 'Authorization': 'Bearer ' + token } });
                const data = await res.json();
                
                if (data.success) {
                    // Update stats
                    document.getElementById('wheel-spins-today').textContent = data.stats?.todaySpins || 0;
                    document.getElementById('wheel-points-today').textContent = data.stats?.todayPoints || 0;
                    
                    // Load prizes
                    wheelPrizes = data.prizes || [];
                    renderWheelPrizes();
                }
            } catch (err) {
                console.error(err);
                // Fallback to old API
                try {
                    const res = await fetch('/api/admin/lucky-wheel/stats', { headers: { 'Authorization': 'Bearer ' + token } });
                    const data = await res.json();
                    document.getElementById('wheel-spins-today').textContent = data.spins_today || 0;
                    document.getElementById('wheel-points-today').textContent = data.points_today || 0;
                } catch (e) {}
            }
        }
        
        function renderWheelPrizes() {
            const container = document.getElementById('wheel-prizes-list');
            if (!container) return;
            
            if (wheelPrizes.length === 0) {
                container.innerHTML = '<p style="color:var(--text-muted);">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¬ÙˆØ§Ø¦Ø². Ø£Ø¶Ù Ø¬ÙˆØ§Ø¦Ø² Ø¬Ø¯ÙŠØ¯Ø©.</p>';
                return;
            }
            
            container.innerHTML = wheelPrizes.map((p, i) => `
                <div class="setting-row" style="padding:15px;background:var(--tertiary);border-radius:10px;margin-bottom:10px;border-right:4px solid ${p.color};">
                    <div style="display:flex;align-items:center;gap:15px;flex:1;">
                        <input type="color" value="${p.color}" style="width:40px;height:40px;border:none;cursor:pointer;" onchange="wheelPrizes[${i}].color=this.value">
                        <div style="flex:1;">
                            <input type="text" value="${p.label}" class="form-control" style="margin-bottom:5px;" onchange="wheelPrizes[${i}].label=this.value" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¬Ø§Ø¦Ø²Ø©">
                            <div style="display:flex;gap:10px;">
                                <input type="number" value="${p.value}" class="form-control" style="width:100px;" onchange="wheelPrizes[${i}].value=parseInt(this.value)" placeholder="Ø§Ù„Ù‚ÙŠÙ…Ø©">
                                <input type="number" value="${p.probability}" class="form-control" style="width:100px;" onchange="wheelPrizes[${i}].probability=parseInt(this.value)" placeholder="Ø§Ù„Ø§Ø­ØªÙ…Ø§Ù„ÙŠØ© %">
                            </div>
                        </div>
                    </div>
                    <button class="btn btn-danger btn-sm" onclick="removeWheelPrize(${i})">ğŸ—‘ï¸</button>
                </div>
            `).join('');
        }
        
        function addWheelPrize() {
            wheelPrizes.push({
                label: 'Ø¬Ø§Ø¦Ø²Ø© Ø¬Ø¯ÙŠØ¯Ø©',
                value: 100,
                color: '#e31e24',
                probability: 10,
                active: true
            });
            renderWheelPrizes();
        }
        
        function removeWheelPrize(index) {
            wheelPrizes.splice(index, 1);
            renderWheelPrizes();
        }
        
        async function saveWheelPrizes() {
            try {
                await fetch('/api/admin/wheel/prizes', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json', 'Authorization': 'Bearer ' + token },
                    body: JSON.stringify({ prizes: wheelPrizes })
                });
                showToast('ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¬ÙˆØ§Ø¦Ø²', 'success');
            } catch (err) {
                showToast('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­ÙØ¸', 'error');
            }
        }
        
        // ============== Backup Functions ==============
        async function loadBackupHistory() {
            try {
                const res = await fetch('/api/admin/backup-history', { headers: { 'Authorization': 'Bearer ' + token } });
                const data = await res.json();
                
                const container = document.getElementById('backups-list');
                if (!container) return;
                
                if (!data.backups || data.backups.length === 0) {
                    container.innerHTML = '<p style="color:var(--text-muted);">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†Ø³Ø® Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©</p>';
                    return;
                }
                
                container.innerHTML = data.backups.map(b => `
                    <div class="backup-item" style="display:flex;justify-content:space-between;align-items:center;padding:15px;background:var(--tertiary);border-radius:10px;margin-bottom:10px;">
                        <div style="display:flex;align-items:center;gap:15px;">
                            <span style="font-size:1.5rem;">ğŸ’¾</span>
                            <div>
                                <h4 style="margin:0;">${b.filename}</h4>
                                <p style="color:var(--text-muted);font-size:0.85rem;margin:0;">
                                    ${formatBytes(b.size_bytes)} â€¢ ${new Date(b.created_at).toLocaleString('ar-IQ')} â€¢ ${b.created_by || 'system'}
                                </p>
                            </div>
                        </div>
                        <div style="display:flex;gap:5px;">
                            <button class="btn btn-sm btn-success" onclick="downloadBackup('${b.id}')">ğŸ“¥ ØªØ­Ù…ÙŠÙ„</button>
                        </div>
                    </div>
                `).join('');
            } catch (err) {
                console.error(err);
            }
        }
        
        function formatBytes(bytes) {
            if (bytes === 0) return '0 B';
            const k = 1024;
            const sizes = ['B', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }
        
        async function createBackup() {
            try {
                showToast('Ø¬Ø§Ø±ÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù†Ø³Ø®Ø©...', 'info');
                const res = await fetch('/api/admin/backup', {
                    method: 'POST',
                    headers: { 'Authorization': 'Bearer ' + token }
                });
                const data = await res.json();
                
                if (data.success) {
                    showToast('ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù†Ø³Ø®Ø© Ø¨Ù†Ø¬Ø§Ø­', 'success');
                    loadBackupHistory();
                    
                    // Download the backup
                    const blob = new Blob([JSON.stringify(data.backup, null, 2)], { type: 'application/json' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = data.filename;
                    a.click();
                } else {
                    showToast('ÙØ´Ù„ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù†Ø³Ø®Ø©', 'error');
                }
            } catch (err) {
                showToast('Ø®Ø·Ø£ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù†Ø³Ø®Ø©', 'error');
            }
        }
        
        async function cleanupOldBackups() {
            showConfirm('Ø­Ø°Ù Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©', 'Ø³ÙŠØªÙ… Ø­Ø°Ù Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø£Ù‚Ø¯Ù… Ù…Ù† Ø§Ù„Ù…Ø¯Ø© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©', async () => {
                try {
                    const res = await fetch('/api/admin/auto-backup/cleanup', {
                        method: 'POST',
                        headers: { 'Authorization': 'Bearer ' + token }
                    });
                    const data = await res.json();
                    showToast(`ØªÙ… Ø­Ø°Ù ${data.deleted} Ù†Ø³Ø®Ø©`, 'success');
                    loadBackupHistory();
                } catch (err) {
                    showToast('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­Ø°Ù', 'error');
                }
            });
        }

        // ============== Theme Toggle ==============
        function toggleTheme() {
            currentTheme = currentTheme === 'dark' ? 'light' : 'dark';
            applyTheme();
            localStorage.setItem('adminTheme', currentTheme);
            showToast(currentTheme === 'dark' ? 'Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ ğŸŒ™' : 'Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù†Ù‡Ø§Ø±ÙŠ â˜€ï¸', 'success');
        }
        
        function applyTheme() {
            document.documentElement.setAttribute('data-theme', currentTheme);
            const icon = document.getElementById('theme-icon');
            if (icon) icon.textContent = currentTheme === 'dark' ? 'ğŸŒ™' : 'â˜€ï¸';
        }
        
        // Apply theme on load
        applyTheme();
        
        // ============== Chat Admin ==============
        const ChatAdmin = {
            async load() {
                await Promise.all([this.loadStatus(), this.loadMessages(), this.loadBanned(), this.loadWords()]);
            },
            
            async loadStatus() {
                try {
                    const r = await fetch('/api/admin/chat/status', {headers: {'Authorization': 'Bearer ' + localStorage.getItem('adminToken')}});
                    const d = await r.json();
                    document.getElementById('chat-enabled-toggle').checked = d.enabled;
                    document.getElementById('chat-total-msg').textContent = d.totalMessages || 0;
                    document.getElementById('chat-banned-count').textContent = d.bannedUsers || 0;
                } catch(e) {}
            },
            
            async toggle(enabled) {
                try {
                    await fetch('/api/admin/chat/toggle', {
                        method: 'POST',
                        headers: {'Content-Type': 'application/json', 'Authorization': 'Bearer ' + localStorage.getItem('adminToken')},
                        body: JSON.stringify({enabled})
                    });
                    showToast(enabled ? 'âœ… ØªÙ… ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¯Ø±Ø¯Ø´Ø©' : 'ğŸ”’ ØªÙ… Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø¯Ø±Ø¯Ø´Ø©');
                } catch(e) { showToast('Ø®Ø·Ø£', 'error'); }
            },
            
            async loadMessages() {
                try {
                    const r = await fetch('/api/admin/chat/messages?limit=50', {headers: {'Authorization': 'Bearer ' + localStorage.getItem('adminToken')}});
                    const d = await r.json();
                    const tbody = document.getElementById('chat-messages-body');
                    if (!d.messages || d.messages.length === 0) {
                        tbody.innerHTML = '<tr><td colspan="5" style="text-align:center;color:var(--text-muted);">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø±Ø³Ø§Ø¦Ù„</td></tr>';
                        return;
                    }
                    tbody.innerHTML = d.messages.map(m => {
                        const time = new Date(m.created_at).toLocaleString('ar-IQ');
                        return `<tr style="${m.is_deleted ? 'opacity:0.5;' : ''}">
                            <td>${m.player_name}</td>
                            <td style="font-size:12px;">${m.player_phone}</td>
                            <td style="max-width:200px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;">${m.message}</td>
                            <td style="font-size:11px;">${time}</td>
                            <td>${!m.is_deleted ? `<button class="btn btn-danger btn-sm" onclick="ChatAdmin.deleteMsg(${m.id})">Ø­Ø°Ù</button> <button class="btn btn-warning btn-sm" onclick="ChatAdmin.quickBan('${m.player_phone}')">Ø­Ø¸Ø±</button>` : 'â€”'}</td>
                        </tr>`;
                    }).join('');
                } catch(e) {}
            },
            
            async deleteMsg(id) {
                if (!confirm('Ø­Ø°ÙØŸ')) return;
                await fetch('/api/admin/chat/message/' + id, {method: 'DELETE', headers: {'Authorization': 'Bearer ' + localStorage.getItem('adminToken')}});
                showToast('âœ… ØªÙ…'); this.loadMessages();
            },
            
            async loadBanned() {
                try {
                    const r = await fetch('/api/admin/chat/banned', {headers: {'Authorization': 'Bearer ' + localStorage.getItem('adminToken')}});
                    const d = await r.json();
                    const c = document.getElementById('chat-banned-list');
                    if (!d || d.length === 0) { c.innerHTML = '<p style="color:var(--text-muted);text-align:center;">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø­Ø¸ÙˆØ±ÙŠÙ†</p>'; return; }
                    c.innerHTML = d.map(b => `<div style="display:flex;justify-content:space-between;align-items:center;padding:12px;background:rgba(255,193,7,0.15);border-radius:8px;margin-bottom:8px;">
                        <div><strong style="color:#ffc107;">${b.phone}</strong><br><small>${b.reason || '-'}</small></div>
                        <button class="btn btn-success btn-sm" onclick="ChatAdmin.unban('${b.phone}')">Ø±ÙØ¹</button>
                    </div>`).join('');
                } catch(e) {}
            },
            
            async ban() {
                const phone = document.getElementById('ban-phone').value.trim();
                if (!phone) return alert('Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ù‚Ù…');
                await fetch('/api/admin/chat/ban', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json', 'Authorization': 'Bearer ' + localStorage.getItem('adminToken')},
                    body: JSON.stringify({phone, reason: document.getElementById('ban-reason').value, duration: document.getElementById('ban-duration').value})
                });
                showToast('âœ… ØªÙ… Ø§Ù„Ø­Ø¸Ø±');
                document.getElementById('ban-phone').value = '';
                this.loadBanned(); this.loadStatus();
            },
            
            quickBan(phone) { document.getElementById('ban-phone').value = phone; this.showTab('banned'); },
            
            async unban(phone) {
                await fetch('/api/admin/chat/ban/' + phone, {method: 'DELETE', headers: {'Authorization': 'Bearer ' + localStorage.getItem('adminToken')}});
                showToast('âœ… ØªÙ…'); this.loadBanned(); this.loadStatus();
            },
            
            async loadWords() {
                try {
                    const r = await fetch('/api/admin/chat/bad-words', {headers: {'Authorization': 'Bearer ' + localStorage.getItem('adminToken')}});
                    const d = await r.json();
                    const c = document.getElementById('chat-bad-words');
                    if (!d || d.length === 0) { c.innerHTML = '<p style="color:var(--text-muted);">Ù„Ø§ ØªÙˆØ¬Ø¯</p>'; return; }
                    c.innerHTML = d.map(w => `<span style="background:#dc3545;color:white;padding:5px 12px;border-radius:20px;font-size:13px;">${w.word} <span style="cursor:pointer;" onclick="ChatAdmin.removeWord('${w.word}')">âœ•</span></span>`).join('');
                } catch(e) {}
            },
            
            async addWord() {
                const word = document.getElementById('new-bad-word').value.trim();
                if (!word) return;
                await fetch('/api/admin/chat/bad-word', {method: 'POST', headers: {'Content-Type': 'application/json', 'Authorization': 'Bearer ' + localStorage.getItem('adminToken')}, body: JSON.stringify({word})});
                document.getElementById('new-bad-word').value = '';
                showToast('âœ… ØªÙ…'); this.loadWords();
            },
            
            async removeWord(word) {
                await fetch('/api/admin/chat/bad-word/' + encodeURIComponent(word), {method: 'DELETE', headers: {'Authorization': 'Bearer ' + localStorage.getItem('adminToken')}});
                this.loadWords();
            },
            
            async cleanup() {
                if (!confirm('Ø­Ø°Ù Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©ØŸ')) return;
                const r = await fetch('/api/admin/chat/cleanup', {method: 'POST', headers: {'Authorization': 'Bearer ' + localStorage.getItem('adminToken')}});
                const d = await r.json();
                showToast('âœ… Ø­Ø°Ù ' + (d.deleted||0)); this.loadMessages(); this.loadStatus();
            },
            
            showTab(tab) {
                document.getElementById('chat-section-messages').style.display = tab === 'messages' ? 'block' : 'none';
                document.getElementById('chat-section-banned').style.display = tab === 'banned' ? 'block' : 'none';
                document.getElementById('chat-section-words').style.display = tab === 'words' ? 'block' : 'none';
                document.getElementById('chat-tab-msg').className = 'btn ' + (tab === 'messages' ? 'btn-primary' : 'btn-secondary');
                document.getElementById('chat-tab-ban').className = 'btn ' + (tab === 'banned' ? 'btn-primary' : 'btn-secondary');
                document.getElementById('chat-tab-words').className = 'btn ' + (tab === 'words' ? 'btn-primary' : 'btn-secondary');
            }
        };
    </script>
</body>
</html>
